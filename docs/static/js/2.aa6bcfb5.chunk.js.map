{"version":3,"sources":["containers/OpenData/index.js"],"names":["api","BusTimetableAPI","BusstopPoleAPI","BusroutePatternAPI","OpenData","props","_this","Object","_Users_yamagame_Develop_Signage_diagram_editor_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__","this","_Users_yamagame_Develop_Signage_diagram_editor_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_4__","_Users_yamagame_Develop_Signage_diagram_editor_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_5__","call","loadJSON","_ref","_Users_yamagame_Develop_Signage_diagram_editor_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__","_Users_yamagame_Develop_Signage_diagram_editor_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","a","mark","_callee","command","wrap","_context","prev","next","abrupt","Promise","resolve","fetch","concat","state","operator","consumerKey","then","response","json","console","log","catch","ex","stop","_x","apply","arguments","load","_callee2","BusstopPole","BusroutePattern","BusTimetable","route","pole","times","matchBusroute","matchBuspole","poleInfo","busroutes","busRouteTable","_context2","order","map","o","pl","title","s","t","match","sent","forEach","p","tm","pattern","push","r","br","d","note","direction","busroutePattern","q","time","n","i","length","reorder","keys","k","v","busStops","replace","join","setState","onClickHandler","_this2","react__WEBPACK_IMPORTED_MODULE_7___default","createElement","style","overflow","className","href","type","width","marginBottom","value","onChange","e","target","onClick","key","Component","defaultProps"],"mappings":"2NAGMA,UAAM,8CAENC,EAAkB,eAClBC,EAAiB,cACjBC,EAAqB,kBAENC,cACnB,SAAAA,EAAYC,GAAO,IAAAC,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAL,IACjBE,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAH,GAAAQ,KAAAH,KAAMJ,KAQRQ,SATmB,eAAAC,EAAAP,OAAAQ,EAAA,EAAAR,CAAAS,EAAAC,EAAAC,KASR,SAAAC,EAAOC,GAAP,OAAAJ,EAAAC,EAAAI,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAG,OAAA,SACF,IAAIC,QAAS,SAAAC,GAClBC,MAAK,GAAAC,OAAI7B,EAAJ,UAAA6B,OAAgBT,EAAhB,iCAAAS,OAAuDvB,EAAKwB,MAAMC,SAAlE,qBAAAF,OAA8FvB,EAAKwB,MAAME,cAC3GC,KAAK,SAASC,GACb,OAAOA,EAASC,SACfF,KAAK,SAASE,GACfC,QAAQC,IAAI,cAAeF,GAC3BR,EAAQQ,KACPG,MAAM,SAASC,GAChBH,QAAQC,IAAI,iBAAkBE,QAT3B,wBAAAjB,EAAAkB,SAAArB,EAAAV,SATQ,gBAAAgC,GAAA,OAAA3B,EAAA4B,MAAAjC,KAAAkC,YAAA,GAAArC,EAuBnBsC,KAvBmBrC,OAAAQ,EAAA,EAAAR,CAAAS,EAAAC,EAAAC,KAuBZ,SAAA2B,IAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EA6BIC,EAQAC,EAQAC,EA7CJC,EAAAC,EAAA,OAAAxC,EAAAC,EAAAI,KAAA,SAAAoC,GAAA,cAAAA,EAAAlC,KAAAkC,EAAAjC,MAAA,cA6CI8B,EA7CJ,SA6CaI,GAChB,OAAOA,EAAMC,IAAK,SAAAC,GAChB,IAAMC,EAAKX,EAAKU,EAAE,qBAQlB,OANEA,EAAEE,MADAD,EACQA,EAAG,YAEHR,EAAaO,EAAE,qBAE3BA,EAAC,KAAWP,EAAaO,EAAE,4BACpBA,EAAE,oBACFA,KAlBFP,EArCJ,SAqCiBU,GACpB,IAAMC,EAAID,EAAEE,MAAM,2BAClB,OAAID,EACKA,EAAE,GAEJD,GAbAX,EA7BJ,SA6BkBW,GACrB,IAAMC,EAAID,EAAEE,MAAM,wBAClB,OAAID,EACKA,EAAE,GAEJD,GAlCJN,EAAAjC,KAAA,EACqBlB,EAAKO,SAASX,GADnC,cACC4C,EADDW,EAAAS,KAAAT,EAAAjC,KAAA,EAEyBlB,EAAKO,SAASV,GAFvC,cAEC4C,EAFDU,EAAAS,KAAAT,EAAAjC,KAAA,GAGsBlB,EAAKO,SAASZ,GAHpC,QAGC+C,EAHDS,EAAAS,KAKCjB,EAAQF,EAERG,EAAQ,WACZ,IACMW,EAAK,GAIX,OALaf,EAERqB,QAAS,SAAAC,GACZP,EAAGO,EAAE,eAAiBA,IAEjBP,EANK,GASRV,EAAS,WACb,IACMkB,EAAK,GAQX,OATcrB,EAERmB,QAAS,SAAAH,GACb,IAAMM,EAAUN,EAAE,wBACC,MAAfK,EAAGC,KACLD,EAAGC,GAAW,IAEhBD,EAAGC,GAASC,KAAKP,KAEZK,EAVM,GA2CTd,EAAY,GAElBN,EAAMkB,QAAS,SAAAK,GACb,IAAMC,EAAKrB,EAAcoB,EAAE,kBACN,MAAjBjB,EAAUkB,KACZlB,EAAUkB,GAAM,CACdX,MAAOU,EAAE,YACTvB,MAAM,KAGV,IAAMyB,EAAI,CACRC,KAAMH,EAAE,aACRI,UAAWJ,EAAE,kBACbF,QAASE,EAAE,gBACXd,MAAOJ,EAASkB,EAAE,0BAClBvB,MAAOG,EAAcoB,EAAE,mBAEnBK,EAAe,wBAAAhD,OAA2B6C,EAAEzB,MAA7B,KAAApB,OAAsC6C,EAAEJ,QAAxC,KAAAzC,OAAmD6C,EAAEE,WACpEZ,EAAIb,EAAM0B,GAChB,GAAIb,EAAG,KACCb,EAAQa,EAAEL,IAAK,SAAAmB,GAYnB,OAXUA,EAAE,2BAA2BnB,IAAK,SAAAK,GAC1C,IAAMU,EAAIV,EAAE,sBACZ,OAAIU,EAAU,CACZxB,KAAMG,EAAaW,EAAE,qBACrBe,KAAML,GAED,CACLxB,KAAMG,EAAaW,EAAE,qBACrBe,KAAMf,EAAE,yBAwBRN,EAAQgB,EAAEhB,MAChBgB,EAAEvB,MApBF,SAAiBA,EAAOO,GAiBtB,OAhBUP,EAAMQ,IAAK,SAAAoB,GACnB,IAAMD,EAAI,GACNE,GAAK,EAYT,OAXAD,EAAKZ,QAAS,SAACH,EAAGiB,GAChB,KAAOD,EAAItB,EAAMwB,QAAQ,CAEvB,GAAIxB,IADJsB,GACa9B,OAASc,EAAEd,KAAM,CAC5B4B,EAAEP,KAAKP,GACP,MAEAc,EAAEP,KAAK,CAAErB,KAAMc,EAAEd,KAAM6B,KAAM,SAI5BD,IAKDK,CAAQhC,EAAOO,GACrBP,EAAM+B,OAAS,GACjB3B,EAAUkB,GAAIxB,MAAMsB,KAAKG,MAOzBlB,EAAgB,GAEtBjD,OAAO6E,KAAK7B,GAAWY,QAAS,SAAAkB,GAC9B9B,EAAU8B,GAAGpC,MAAMkB,QAAS,SAAAmB,GAC1B9B,EAAa,GAAA3B,OAAI0B,EAAU8B,GAAGvB,MAAjB,KAAAjC,OAA0ByD,EAAEX,OAAU,CACjDb,MAAK,GAAAjC,OAAK0B,EAAU8B,GAAGvB,MAAlB,KAAAjC,OAA2ByD,EAAEX,MAClCY,SAAQ,GAAA1D,OAAKyD,EAAE5B,MAAMC,IAAK,SAAA2B,GAAC,OAAIA,EAAExB,QAAQH,IAAK,SAAA2B,GAAC,OAAIA,EAAEE,QAAQ,MAAM,MAAKC,KAAK,MAC7EtC,MAAK,GAAAtB,OAAKyD,EAAEnC,MAAMQ,IAAK,SAAAK,GAAC,OAAIA,EAAEL,IAAK,SAAAK,GAAC,OAAIA,EAAEe,OAAOU,KAAK,OAAMA,KAAK,YAKvEnF,EAAKoF,SAAS,CACZlC,cAAejD,OAAO6E,KAAK5B,GAAeG,IAAK,SAAA0B,GAAC,OAAI7B,EAAc6B,OAvI/D,yBAAA5B,EAAAjB,SAAAK,EAAApC,SAvBYH,EAmKnBqF,eAAiB,SAACV,GAChB,OAAO,WACL7C,QAAQC,IAAI/B,EAAKwB,MAAM0B,cAAcyB,MAnKvC3E,EAAKwB,MAAQ,CACXE,YAAa,GACbD,SAAU,WACVyB,cAAe,IALAlD,wEAyKV,IAAAsF,EAAAnF,KACP,OACEoF,EAAA5E,EAAA6E,cAAA,OAAKC,MAAO,CAAEC,SAAU,WACtBH,EAAA5E,EAAA6E,cAAA,OAAKG,UAAU,2CACbJ,EAAA5E,EAAA6E,cAAA,KAAGG,UAAU,eAAeC,KAAK,KAAjC,gHACAL,EAAA5E,EAAA6E,cAAA,aAGFD,EAAA5E,EAAA6E,cAAA,SACEK,KAAK,OACLJ,MAAO,CAAEK,MAAO,OAAQC,aAAc,IACtCC,MAAO7F,KAAKqB,MAAME,YAClBuE,SAAU,SAACC,GACTZ,EAAKF,SAAS,CACZ1D,YAAawE,EAAEC,OAAOH,WAI5BT,EAAA5E,EAAA6E,cAAA,UAAQY,QAASjG,KAAKmC,MAAtB,4BAEEnC,KAAKqB,MAAM0B,cAAcG,IAAK,SAACK,EAAGiB,GAChC,OACEY,EAAA5E,EAAA6E,cAAA,KAAGa,IAAK1B,EAAGyB,QAASd,EAAKD,eAAeV,IAAxC,IAA+CjB,EAAEF,MAAjD,eAhMwB8C,aAyMtCxG,EAASyG,aAAe","file":"static/js/2.aa6bcfb5.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport 'whatwg-fetch'\n\nconst api = 'https://api-tokyochallenge.odpt.org/api/v4';\n\nconst BusTimetableAPI = 'BusTimetable';\nconst BusstopPoleAPI = 'BusstopPole';\nconst BusroutePatternAPI = 'BusroutePattern';\n\nexport default class OpenData extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      consumerKey: '',\n      operator: 'KantoBus',\n      busRouteTable: [],\n    }\n  }\n\n  loadJSON = async (command) => {\n    return new Promise( resolve => {\n      fetch(`${api}/odpt:${command}?odpt:operator=odpt.Operator:${this.state.operator}&acl:consumerKey=${this.state.consumerKey}`)\n        .then(function(response) {\n          return response.json()\n        }).then(function(json) {\n          console.log('parsed json', json)\n          resolve(json);\n        }).catch(function(ex) {\n          console.log('parsing failed', ex)\n        })\n    })\n  }\n\n  load = async () => {\n    const BusstopPole = await this.loadJSON(BusstopPoleAPI);\n    const BusroutePattern = await this.loadJSON(BusroutePatternAPI);\n    const BusTimetable = await this.loadJSON(BusTimetableAPI);\n\n    const route = BusroutePattern;\n\n    const pole = (() => {\n      const pole = BusstopPole;\n      const pl = {}\n      pole.forEach( p => {\n        pl[p['owl:sameAs']] = p;\n      })\n      return pl;\n    })();\n\n    const times = (() => {\n      const times = BusTimetable;\n      const tm = {};\n      times.forEach( t => {\n        const pattern = t['odpt:busroutePattern'];\n        if (tm[pattern] == null) {\n          tm[pattern] = [];\n        }\n        tm[pattern].push(t);\n      })\n      return tm;\n    })();\n\n    function matchBusroute(s) {\n      const t = s.match(/^odpt\\.Busroute:(.+)/)\n      if (t) {\n        return t[1];\n      }\n      return s;\n    }\n\n    function matchBuspole(s) {\n      const t = s.match(/^odpt\\.BusstopPole:(.+)/)\n      if (t) {\n        return t[1];\n      }\n      return s;\n    }\n\n    function poleInfo(order) {\n      return order.map( o => {\n        const pl = pole[o['odpt:busstopPole']];\n        if (pl) {\n          o.title = pl['dc:title'];\n        } else {\n          o.title = matchBuspole(o['odpt:busstopPole']);\n        }\n        o['pole'] = matchBuspole(o['odpt:busstopPole']);\n        delete o['odpt:busstopPole'];\n        return o;\n      })\n    }\n\n    const busroutes = {};\n\n    route.forEach( r => {\n      const br = matchBusroute(r['odpt:busroute']);\n      if (busroutes[br] == null) {\n        busroutes[br] = {\n          title: r['dc:title'],\n          route:[],\n        };\n      }\n      const d = {\n        note: r['odpt:note'],\n        direction: r['odpt:direction'],\n        pattern: r['odpt:pattern'],\n        order: poleInfo(r['odpt:busstopPoleOrder']),\n        route: matchBusroute(r['odpt:busroute']),\n      }\n      const busroutePattern = `odpt.BusroutePattern:${d.route}.${d.pattern}.${d.direction}`;\n      const t = times[busroutePattern]\n      if (t) {\n        const times = t.map( q => {\n          const t = q['odpt:busTimetableObject'].map( t => {\n            const d = t['odpt:departureTime'];\n            if (d) return {\n              pole: matchBuspole(t['odpt:busstopPole']),\n              time: d,\n            }\n            return {\n              pole: matchBuspole(t['odpt:busstopPole']),\n              time: t['odpt:arrivalTime'],\n            }\n          })\n          return t;\n        });\n        function reorder(times, order) {\n          const t = times.map( time => {\n            const q = [];\n            let n = -1;\n            time.forEach( (t, i) => {\n              while (n < order.length) {\n                n ++;\n                if (order[n].pole === t.pole) {\n                  q.push(t)\n                  break;\n                } else {\n                  q.push({ pole: t.pole, time: '-' })\n                }\n              }\n            })\n            return q;\n          })\n          return t;\n        }\n        const order = d.order;\n        d.times = reorder(times, order);\n        if (times.length > 0) {\n          busroutes[br].route.push(d)\n        }\n      }\n    })\n\n    //console.log(JSON.stringify(busroutes, null, '  '));\n\n    const busRouteTable = {};\n\n    Object.keys(busroutes).forEach( k => {\n      busroutes[k].route.forEach( v => {\n        busRouteTable[`${busroutes[k].title} ${v.note}`] = {\n          title: `${busroutes[k].title} ${v.note}`,\n          busStops: `${v.order.map( v => v.title ).map( v => v.replace(/\\s/g,'')).join(' ')}`,\n          times: `${v.times.map( t => t.map( t => t.time ).join(' ')).join('\\n')}`,\n        }\n      })\n    })\n\n    this.setState({\n      busRouteTable: Object.keys(busRouteTable).map( k => busRouteTable[k] ),\n    })\n\n  }\n\n  onClickHandler = (i) => {\n    return () => {\n      console.log(this.state.busRouteTable[i]);\n    }\n  }\n\n  render() {\n    return (\n      <div style={{ overflow: 'hidden' }}>\n        <nav className=\"navbar sticky-top navbar-light bg-light\">\n          <a className=\"navbar-brand\" href=\"#\">東京公共交通オープンデータチャレンジ</a>\n          <div>\n          </div>\n        </nav>\n        <input\n          type=\"text\"\n          style={{ width: '100%', marginBottom: 10, }}\n          value={this.state.consumerKey}\n          onChange={(e) => {\n            this.setState({\n              consumerKey: e.target.value,\n            })\n          }}\n        />\n        <button onClick={this.load} >読み込み</button>\n        {\n          this.state.busRouteTable.map( (t, i) => {\n            return (\n              <p key={i} onClick={this.onClickHandler(i)} > {t.title} </p>\n            )\n          })\n        }\n      </div>\n    )\n  }\n}\n\nOpenData.defaultProps = {\n}\n"],"sourceRoot":""}