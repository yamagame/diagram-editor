{"version":3,"sources":["components/DiagramView/utils.js","components/DiagramView/index.js","components/BusStopDialog/index.js","components/DiagramDataDialog/index.js","containers/Diagram/index.js"],"names":["toTime","x","t","parseInt","secd","mint","hour","format","v","concat","slice","makeTimeText","d","update","this","y","text","dx","dy","fontSize","load","_ref","busStops","timeLines","b","split","map","pointData","lineData","forEach","r","idx","pre","q","i","_toXPoint","time","pretime","p","trim","length","oneday","sgn","toXPoint","w","push","s","name","save","_ref2","stops","l","sort","a","index","lines","done","n","check","result","line","up","u","join","insertBusstop","_ref3","pos","splice","deleteBusstop","_ref4","console","log","delPos","delete","reverse","delLine","menuWidth","limit24","textDiagramData","parseDiagramText","diagramData","some","indexOf","DiagramView","props","_this","Object","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","size","width","state","height","loadData","_Utils$load","Utils","lineLoopData","pointLoopData","textData","componentDidUpdate","timeLineWidth","gridScale","busLineHeight","makeLine","deleteDoubleLine","selectPoint","_d","selected","deselectPoint","lastSelect","lineKey","key","initialize","_this$size","xScale","d3","domain","range","yScale","dragHandle","on","org","cursorData","visible","drawCursor","spindex","altKey","sourceEvent","assertThisInitialized","pointLen","lineLen","onChange","updateData","setUndo","drag","clear","ox","oy","shiftKey","invert","dragMarky","lastSelected","marky","bar","doDrag","markyData","updateMarky","x1","y1","x2","y2","convert","p1","p2","ct","pt","zoomMoved","zoomScale","gridZoomBehavior","scaleExtent","filter","transform","k","onChangeParam","params","gridZoom","applyX","clearGrid","grid","base","svgElement","menuZoomBehavior","menuZoom","applyY","menu","selectAll","data","enter","append","attr","translate","scale","resetScreenPosition","_this$size2","min","max","mark","start24","pp","pw","s0","s1","pointMarge","checkRange","findPoint","rp","objectSpread","_this$size3","exit","remove","classed","style","rect","updateText","deepSelect","updateGrid","gridRectangles","menuRectangles","each","color","rotate","_this$size4","h","hourw","fontColor","idd","drawTimeLine","busStop","rectData","_this$size5","menuw","node","stroke","onEditBusStop","busStopData","cursor","onKeyDown","e","keyCode","preventDefault","selectedBusStop","metaKey","readonly","doRedo","doUndo","onKeyUp","onMouseLeave","event","onChangeData","undoBuffer","undoPtr","_this$size6","_Utils$load2","transformX","transformY","nextProps","setState","stopNo","_this2","times","findLinkedTime","o","fp","ep","dir","departure","arrival","g","sec","_this3","react_default","createElement","ref","container","display","marign","padding","overflow","border","tabIndex","focusable","svg","axis","visibility","Component","defaultProps","BusStopEditDialog","onClose","onEdited","Modal","show","onHide","Header","closeButton","Title","Body","Row","Col","md","type","marginBottom","value","target","placeholder","readOnly","margin","borderLeft","textAlign","Footer","Button","onClick","DiagramDataDialog","onChangeText","lib_default","editor","mode","theme","showPrintMargin","editorProps","$blockScrolling","Infinity","AsyncStorage","getItem","defaultValue","localStorage","JSON","parse","setItem","stringify","Diagram","onResize","window","innerWidth","innerHeight","showBusStopDialog","onCloseBusStop","onEditedBusStop","openDiagramDataDialog","showDiagramDataDialog","diagramEditData","diagramView","onEditedDiagramData","onCloseDiagramData","addEventListener","removeEventListener","className","href","marginRight","role","DiagramView_DiagramView","BusStopDialog_BusStopEditDialog","DiagramDataDialog_DiagramDataDialog"],"mappings":"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","file":"static/js/1.f467d019.chunk.js","sourcesContent":["export const oneday = 24*60*60;\n\nexport const abs = v => v > 0 ? v : -v;\nexport const sgn = v => v > 0 ? 1 : -1;\n\nexport const toXPoint = (time, pretime) => {\n  const p = time.trim().split(':');\n  let hour = 0;\n  let mint = 0;\n  let secd = 0;\n  if (p.length > 0) {\n    hour = parseInt(p[0]);\n  }\n  if (p.length > 1) {\n    mint = parseInt(p[1]);\n  }\n  if (p.length > 2) {\n    secd = parseInt(p[2]);\n  }\n  let x = hour*60*60+mint*60+secd;\n  let t = x;\n  if (pretime !== null) {\n    let d = (pretime % oneday) - (x % oneday);\n    if (abs(d) >= oneday/2) {\n      t += sgn(d)*oneday;\n    }\n  }\n  return { t, x };\n}\n\nexport const toTime = (x) => {\n  while (x < 0) x += 24*60*60;\n  while (x >= 24*60*60) x -= 24*60*60;\n  let t = parseInt(x+0.5);\n  const secd = parseInt(t % 60);\n  const mint = parseInt(t / 60) % 60;\n  const hour = parseInt(parseInt(t / 60) / 60);\n  const format = (v) => {\n    return `${('00'+v).slice(-2)}`;\n  }\n  if (secd !== 0) {\n    return `${format(hour)}:${format(mint)}:${format(secd)}`;\n  }\n  return `${format(hour)}:${format(mint)}`;\n}\n\nexport const makeTimeText = (d) => {\n  let t = {\n    update: function() {\n      this.x = d.x;\n      this.y = d.y;\n      this.text = toTime(d.x);\n      this.dx = 6;\n      this.dy = 5;\n      this.fontSize = 0.7;\n    }\n  }\n  t.update();\n  return t;\n}\n\nexport const load = ({ busStops, timeLines, }) => {\n  const b = busStops.split('\\n').map( v => v === '-' ? '' : v );\n  const t = timeLines.split('\\n');\n  const pointData = [];\n  const lineData = [];\n  t.forEach( v => {\n    const t = v.split(' ');\n    const r = [];\n    let idx = 0;\n    let pre = null;\n    t.forEach( (q, i) => {\n      if (q !== '-' && q !== '') {\n        const p = q.split('-');\n        p.forEach( v => {\n          const { t, x } = toXPoint(v, pre);\n          const w = { x: t , y: idx+1 };\n          w.time = makeTimeText(w);\n          pointData.push(w);\n          r.push(w)\n          pre = x;\n        })\n      }\n      idx ++;\n    })\n    let s = null;\n    r.forEach( d => {\n      if (s) {\n        lineData.push({ s, d, });\n      }\n      s = d;\n    })\n  })\n  if (b.length < 2) {\n    while (b.length < 2) b.push('');\n  }\n  return {\n    busStops: b.map( v => { return { name: v } } ),\n    pointData,\n    lineData,\n  }\n}\n\nexport const save = ({ busStops, pointData, lineData }) => {\n  const stops = busStops.map( v => v.name.trim() );\n  const p = pointData.sort( (a, b) => {\n    if (a.x > b.x) return  1;\n    if (a.x < b.x) return -1;\n    return 0;\n  }).map( (d, i) => {\n    d.index = i;\n    d.lines = [];\n    return d;\n  })\n  const l = lineData.map( v => {\n    if (v.s.x > v.d.x) {\n      const d = v.s;\n      v.s = v.d;\n      v.d = d;\n    }\n    v.done = false;\n    v.s.lines.push(v);\n    v.d.lines.push(v);\n    return v;\n  }).sort( (a, b) => {\n    if (a.s.x > b.s.x) return  1;\n    if (a.s.x < b.s.x) return -1;\n    return 0;\n  })\n\n  let n = 0;\n  const check = (l, i) => {\n    if (l.done) return;\n    l.done = true;\n    if (i < 0) {\n      i = n;\n      n ++;\n    }\n    l.index = i;\n    l.s.lines.forEach( p => {\n      check(p, i);\n    })\n    l.d.lines.forEach( p => {\n      check(p, i);\n    })\n  }\n  l.forEach( (p, i) => {\n    check(p, -1);\n  })\n\n  let result = [];\n  l.sort( (a, b) => {\n    if (a.index > b.index) return  1;\n    if (a.index < b.index) return -1;\n    return 0;\n  }).forEach( l => {\n    if (typeof result[l.index] == 'undefined') {\n      result[l.index] = [];\n    }\n    result[l.index].push(l);\n  })\n\n  let timeLines = [];\n  result.forEach( line => {\n    const l = line.sort( (a, b) => {\n      if (a.s.y > b.s.y) return  1;\n      if (a.s.y < b.s.y) return -1;\n      return 0;\n    })\n    let up = false;\n    if (l[0].s.y < l[0].d.y) up = true;\n    let t = [];\n    let q = null;\n    l.forEach( (p, i) => {\n      if (up) {\n        t.push(p.s)\n      } else {\n        t.push(p.d)\n      }\n      q = p;\n    })\n    if (q) {\n      if (up) {\n        t.push(q.d)\n      } else {\n        t.push(q.s)\n      }\n    }\n    const u = [];\n    stops.forEach( v => {\n      u.push([]);\n    })\n    t.forEach( v => {\n      u[v.y-1].push(v);\n    })\n    // u.forEach( t => {\n    //   console.log(t);\n    // })\n    timeLines.push(u.map( p => {\n      if (p.length === 0) return '-';\n      let t = '';\n      p.forEach( v => {\n        if (t !== '') t += '-';\n        t += toTime(v.x)\n      })\n      return t;\n    }).join(' '));\n  })\n\n  // console.log(timeLines);\n\n  return {\n    busStops: stops.map( v=> v === '' ? '-' : v ).join('\\n'),\n    timeLines,\n  }\n}\n\nexport const insertBusstop = ({ busStops, pointData, lineData }, pos) => {\n  busStops.splice(pos, 0, { name: '', });\n  pointData.forEach( v => {\n    if (v.y >= pos+1) {\n      v.y += 1;\n    }\n  })\n}\n\nexport const deleteBusstop = ({ busStops, pointData, lineData }, pos) => {\nconsole.log(busStops[pos].name);\n  if (busStops[pos].name !== '') return;\n  busStops.splice(pos, 1);\n  const delPos = [];\n  pointData.forEach( (v, i) => {\n    if (v.y == pos+1) {\n      v.delete = true;\n      delPos.push(i);\n    } else\n    if (v.y > pos+1) {\n      v.y -= 1;\n    }\n  })\n  delPos.reverse().forEach( v => {\n    pointData.splice(v, 1);\n  })\n  const delLine = [];\n  lineData.forEach( (v, i) => {\n    if (v.s.delete || v.d.delete) {\n      delLine.push(i);\n    }\n  })\n  delLine.reverse().forEach( v => {\n    lineData.splice(v, 1);\n  })\n}\n","import React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport * as Utils from './utils';\n\nconst timeUnit = 1000;\nconst menuWidth = 150;\nconst oneday = Utils.oneday;\n\nconst limit24 = (v) => {\n  if (v < 0) v += oneday;\n  return v % oneday;\n}\n\nconst textDiagramData = (t) => {\n  return `${t.busStops.split('\\n').join(' ')}\\n${t.timeLines.join('\\n')}\\n`;\n}\n\nconst parseDiagramText = (diagramData) => {\n  const t = diagramData.split('\\n');\n  let busStops = null;\n  let timeLines = null;\n  t.some( (s, i) => {\n    if (s.indexOf('/') == 0) return false;\n    if (busStops === null) {\n      busStops = s;\n      return false;\n    }\n    if (timeLines === null) {\n      timeLines = i;\n    }\n    return true;\n  })\n  return {\n    busStops: busStops !== null ? busStops.split(' ').join('\\n') : '',\n    timeLines: timeLines !== null ? t.slice(timeLines).join('\\n') : '',\n  }\n}\n\nexport default class DiagramView extends Component {\n  constructor(props) {\n    super(props);\n    const { diagramData } = props;\n    const {\n      busStops,\n      lineData,\n      pointData,\n    } = Utils.load(parseDiagramText(diagramData));\n    this.state = {\n      width: props.width,\n      height: props.height,\n    }\n    this.markyData = {\n      x: 100, y: 200, width: 200, height: 100, color: 'rgba(0,0,0,0.1)', visible: false,\n    }\n    this.lineData = lineData;\n    this.pointData = pointData;\n    this.busStops = busStops;\n    this.lineLoopData = [];\n    this.pointLoopData = [];\n    this.textData = [];\n    this.cursorData = {\n      x: 0, y: 0, visible: true,\n    }\n    this.gridScale = {\n      x: 25,\n      y: 25,\n      dy: -4,\n    }\n    this.params = { ...props.params };\n    this.undoPtr = 0;\n    this.undoBuffer = [];\n    this.altKey = false;\n  }\n\n  componentDidMount() {\n    this.initialize();\n  }\n  \n  componentWillUnmount() {\n  }\n\n  componentDidUpdate() {\n    const transformX = d3.zoomTransform(this.base.node());\n    const transformY = d3.zoomTransform(this.menu.node());\n    this.xScale.range([transformX.applyX(0), transformX.applyX(this.state.width)]);\n    this.yScale.range([transformY.applyY(0), transformY.applyY(this.state.height)]);\n    this.updateData()\n    this.clearGrid(this.grid);\n    this.clearGrid(this.menu);\n    this.update();\n  }\n\n  componentWillReceiveProps(nextProps) {\n    let state = {}\n    if (this.props.width != nextProps.width) {\n      state.width = nextProps.width;\n    }\n    if (this.props.height != nextProps.height) {\n      state.height = nextProps.height;\n    }\n    if (this.props.diagramData != nextProps.diagramData) {\n      this.loadData(nextProps.diagramData);\n    }\n    this.setState(state);\n  }\n\n  size = () => {\n    return {\n      width: this.state.width,\n      height: this.state.height,\n    }\n  }\n\n  loadData = (diagramData) => {\n    const {\n      busStops,\n      lineData,\n      pointData,\n    } = Utils.load(parseDiagramText(diagramData));\n    this.lineData = lineData;\n    this.pointData = pointData;\n    this.busStops = busStops;\n    this.lineLoopData = [];\n    this.pointLoopData = [];\n    this.textData = [];\n    this.componentDidUpdate();\n  }\n\n  timeLineWidth = () => {\n    return 60*60/this.gridScale.x;\n  }\n\n  busLineHeight = () => {\n    return 1/this.gridScale.y;\n  }\n\n  makeLine = (s, d) => {\n    this.lineData.push({\n      s: s,\n      d: d,\n    })\n    this.deleteDoubleLine();\n  }\n\n  selectPoint = (_d) => {\n    _d.selected = true;\n  }\n\n  deselectPoint = (_d) => {\n    delete _d.selected;\n    delete _d.lastSelect;\n  }\n\n  deleteDoubleLine = () => {\n    const lineKey = {};\n    const lineData = [];\n    this.pointData.forEach( (d, i) => {\n      d.index = i;\n    })\n    this.lineData.forEach( d => {\n      let key = `${d.d.index}-${d.s.index}`;\n      if (d.s.index < d.d.index) {\n        key = `${d.s.index}-${d.d.index}`;\n      }\n      if (typeof lineKey[key] === 'undefined') {\n        lineData.push(d);\n        lineKey[key] = d;\n      }\n    })\n    this.lineData = lineData;\n  }\n\n  initialize = () => {\n    const { width, height } = this.size();\n\n    this.xScale = d3.scaleLinear()\n      .domain([0, width*this.timeLineWidth()])\n      .range([0, width]);\n\n    this.yScale = d3.scaleLinear()\n      .domain([this.gridScale.dy, height*this.busLineHeight()+this.gridScale.dy])\n      .range([0, height]);\n\n    //\n    this.dragHandle = d3.drag()\n      .on('start', (_d, i) => {\n        const d = _d.org;\n        this.cursorData.visible = false;\n        this.drawCursor();\n        let s = null;\n        let spindex = 0;\n        this.pointData.some( (d, i) => {\n          if (d.selected && d.lastSelect) {\n            s = d;\n            spindex = i;\n            return true;\n          }\n          return false;\n        })\n        this.altKey = d3.event.sourceEvent.altKey;\n        if (d3.event.sourceEvent.altKey && s !== null && spindex !== i) {\n          //\n          const b = textDiagramData(Utils.save(this));\n          const pointLen = this.pointData.length;\n          const lineLen = this.lineData.length;\n          this.pointData.forEach( d => {\n            delete d.lastSelect;\n          })\n          d.lastSelect = true;\n          this.selectPoint(d);\n          const ended = (_d, i) => {\n            const d = _d.org;\n            this.makeLine(s, d);\n            this.onChange();\n            this.updateData();\n            this.update();\n            if (this.pointData.length != pointLen || this.lineData.length != lineLen) {\n              this.setUndo(b);\n            }\n          }\n          d3.event.on(\"end\", ended);\n        } else {\n          //\n          const b = textDiagramData(Utils.save(this));\n          let drag = false;\n          let clear = false;\n          if (!d.selected) {\n            clear = true;\n          }\n          this.pointData.forEach( d => {\n            delete d.lastSelect;\n          })\n          d.lastSelect = true;\n          this.selectPoint(d);\n          this.pointData.forEach( d => {\n            if (d.selected) {\n              d.ox = this.xScale(d.x);\n              d.oy = this.yScale(d.y);\n            }\n          })\n          const dragged = (_d) => {\n            const d = _d.org;\n            drag = true;\n            if (!d3.event.sourceEvent.shiftKey && clear) {\n              this.pointData.forEach( d => {\n                this.deselectPoint(d);\n              })\n              this.lineData.forEach( d => {\n                delete d.selected;\n              })\n              this.selectPoint(d);\n            }\n            this.pointData.forEach( d => {\n              if (d.selected) {\n                d.ox += d3.event.dx;\n                d.oy += d3.event.dy;\n                d.x = this.xScale.invert(d.ox);\n                //d.y = this.yScale.invert(d.oy);\n              }\n            })\n            this.update();\n          }\n          const ended = (_d, i) => {\n            const d = _d.org;\n            if (!drag) {\n              if (!d3.event.sourceEvent.shiftKey && clear) {\n                this.pointData.forEach( d => {\n                  this.deselectPoint(d);\n                })\n                this.lineData.forEach( d => {\n                  delete d.selected;\n                })\n                this.selectPoint(d);\n                d.lastSelect = true;\n              }\n            } else {\n              this.setUndo(b);\n            }\n            this.pointData.forEach( d => {\n              delete d.ox;\n              delete d.oy;\n            })\n            this.onChange();\n            this.update();\n          }\n          d3.event.on(\"drag\", dragged).on(\"end\", ended);\n        }\n      })\n\n    this.dragMarky = d3.drag()\n      .on('start', (d, i) => {\n        this.cursorData.visible = false;\n        this.drawCursor();\n        this.altKey = d3.event.sourceEvent.altKey;\n        //\n        if (d3.event.sourceEvent.altKey) {\n\n          const b = textDiagramData(Utils.save(this));\n\n          let lastSelected = null;\n          let spindex = 0;\n          this.pointData.some( (d, i) => {\n            if (d.selected && d.lastSelect) {\n              lastSelected = d;\n              spindex = i;\n              return true;\n            }\n            return false;\n          })\n\n          this.pointData.forEach( d => {\n            delete d.lastSelect;\n          })\n\n          const p = {\n            x: this.cursorData.x,\n            y: this.cursorData.y,\n            selected: true,\n            lastSelect: true,\n          }\n          this.selectPoint(p);\n          this.pointData.push(p)\n\n          if (lastSelected) {\n            this.makeLine(lastSelected, p);\n          }\n\n          this.onChange();\n          this.updateData();\n          this.update();\n          this.cursorData.visible = false;\n          this.drawCursor();\n\n          this.setUndo(b);\n        }\n        //\n        if (d3.event.sourceEvent.shiftKey) {\n          const marky = this.marky;\n          const bar = d3.select(this.bar);\n          let doDrag = false;\n          let x = d3.event.x;\n          let y = d3.event.y;\n          this.markyData.x = x;\n          this.markyData.y = y;\n          this.markyData.width  = 0;\n          this.markyData.height = 0;\n          const dragged = (d) => {\n            if (!doDrag) {\n              x = d3.event.x;\n              y = d3.event.y;\n              this.markyData.x = x;\n              this.markyData.y = y;\n              this.markyData.width  = 0;\n              this.markyData.height = 0;\n              doDrag = true;\n            }\n            x += d3.event.dx;\n            y += d3.event.dy;\n            this.markyData.width  = x-this.markyData.x;\n            this.markyData.height = y-this.markyData.y;\n            this.markyData.visible = true;\n            this.updateMarky();\n          }\n          const ended = () => {\n            this.markyData.visible = false;\n            this.updateMarky();\n\n            let x1 = this.markyData.x;\n            let y1 = this.markyData.y;\n            let x2 = this.markyData.x+this.markyData.width;\n            let y2 = this.markyData.y+this.markyData.height;\n            let t;\n\n            t = x1;\n            if (x2 < x1) {\n              x1 = x2;\n              x2 = t;\n            }\n            t = y1;\n            if (y2 < y1) {\n              y1 = y2;\n              y2 = t;\n            }\n\n            const convert = (p) => {\n              return [this.xScale.invert(p[0]), this.yScale.invert(p[1])];\n            }\n\n            const p1 = convert([x1, y1]);\n            const p2 = convert([x2, y2]);\n\n            this.pointLoopData.forEach( d => {\n              if (d3.event.sourceEvent.shiftKey && d.org.selected) {\n                return true;\n              }\n              const selected = (p1[0] <= d.x && d.x <= p2[0] && p1[1] <= d.y && d.y <= p2[1]);\n              if (selected) {\n                this.selectPoint(d.org);\n              } else {\n                this.deselectPoint(d.org);\n              }\n            })\n            let ct = 0;\n            let pt = null;\n            this.pointData.forEach( d => {\n              if (d.selected) {\n                ct ++;\n                pt = d;\n              }\n            })\n            if (ct === 1) {\n              pt.lastSelect = true;\n            }\n\n            this.update();\n          }\n          d3.event.on(\"drag\", dragged).on(\"end\", ended);\n        }\n      })\n\n    let zoomMoved = 0;\n    let zoomScale = null;\n\n    this.gridZoomBehavior = d3.zoom()\n      .scaleExtent([0.8, 160])\n      .filter(() => {\n        this.altKey = d3.event.altKey;\n        return (!d3.event.shiftKey && !d3.event.altKey);\n      })\n      .on('start', () => {\n        zoomMoved = 0;\n        zoomScale = d3.event.transform.k;\n      })\n      .on('zoom', () => {\n        zoomMoved ++;\n        if (zoomScale !== d3.event.transform.k) {\n          zoomMoved += 10;\n        }\n        const transform = d3.event.transform;\n        if (this.props.onChangeParam) {\n          this.params.gridZoom = transform;\n          this.props.onChangeParam(this.params);\n        }\n        this.xScale.range([transform.applyX(0), transform.applyX(this.state.width)]);\n        this.clearGrid(this.grid);\n        this.updateData();\n        this.update();\n        this.cursorData.visible = false;\n        this.drawCursor();\n      })\n      .on('end', () => {\n        if (zoomMoved < 5) {\n          this.pointData.forEach( v => {\n            this.deselectPoint(v);\n          })\n          this.lineData.forEach( v => {\n            delete v.selected;\n            delete v.lastSelect;\n          })\n          this.update();\n        }\n      })\n    \n    this.base\n      .call(this.gridZoomBehavior)\n      .on('dblclick.zoom', null)\n      .call(this.dragMarky)\n      .on(\"mouseleave\", () => {\n        this.cursorData.visible = false;\n        this.drawCursor();\n      })\n      .on(\"mousemove\", () => {\n        const p = d3.mouse(this.svgElement);\n        this.cursorData.x = this.xScale.invert(p[0]);\n        this.cursorData.y = parseInt(this.yScale.invert(p[1])+0.5);\n        this.cursorData.visible = true;\n        this.drawCursor();\n      })\n\n    this.menuZoomBehavior = d3.zoom()\n      .scaleExtent([0.8, 5])\n      .filter(() => {\n        this.altKey = d3.event.altKey;\n        return (!d3.event.shiftKey && !d3.event.altKey);\n      })\n      .on('start', () => {\n        zoomMoved = 0;\n        zoomScale = d3.event.transform.k;\n      })\n      .on('zoom', () => {\n        zoomMoved ++;\n        if (zoomScale !== d3.event.transform.k) {\n          zoomMoved += 10;\n        }\n        const transform = d3.event.transform;\n        if (this.props.onChangeParam) {\n          this.params.menuZoom = transform;\n          this.props.onChangeParam(this.params);\n        }\n        this.yScale.range([transform.applyY(0), transform.applyY(this.state.height)]);\n        this.clearGrid(this.grid);\n        this.clearGrid(this.menu);\n        this.update();\n        this.cursorData.visible = false;\n        this.drawCursor();\n      })\n      .on('end', () => {\n        if (zoomMoved < 5) {\n          this.update();\n        }\n      })\n\n    this.menu\n      .call(this.menuZoomBehavior)\n      .on('dblclick.zoom', null)\n\n    this.updateData();\n\n    const marky = this.marky;\n    marky\n      .selectAll('rect')\n      .data([this.markyData])\n      .enter()\n      .append('rect')\n      .attr('class', 'marky')\n      .attr('visibility', 'hidden')\n      .attr('stroke', 'none')\n      .attr('stroke-width', 2)\n\n    if (this.params.gridZoom) {\n      const t = this.params.gridZoom;\n      this.base\n        .call(this.gridZoomBehavior.transform, d3.zoomIdentity.translate(t.x, 0).scale(t.k));\n    } else {\n      this.resetScreenPosition();\n    }\n    if (this.params.menuZoom) {\n      const t = this.params.menuZoom;\n      this.menu\n        .call(this.menuZoomBehavior.transform, d3.zoomIdentity.translate(0, t.y).scale(t.k));\n    }\n\n    this.update();\n  }\n\n  updateData = () => {\n    const { width, height } = this.size();\n\n    //\n    {\n      const convert = (p) => {\n        return [this.xScale.invert(p[0]), this.yScale.invert(p[1])];\n      }\n      const p1 = convert([0, 0]);\n      const w = this.xScale.invert(width)-this.xScale.invert(0);\n\n      let min = oneday;\n      let max = 0;\n\n      this.pointData.forEach( (p, i) => {\n        p.i = i;\n        delete p.mark;\n        if (!p.time) {\n          p.time = Utils.makeTimeText(p);\n        }\n        if (min > p.x) min = p.x;\n        if (max < p.x) max = p.x;\n      })\n\n      min = (min < 0) ? (parseInt(min/oneday)-1) : parseInt(min/oneday);\n      max = (max < 0) ? (parseInt(max/oneday)-1) : parseInt(max/oneday);\n\n      //\n      const start24 = (v) => {\n        if (v < 0) v = (parseInt(v / oneday)-1)*oneday;\n        return parseInt(v / oneday)*oneday;\n      }\n      const pp = start24(p1[0])-max*oneday;\n      const pw = (parseInt(w/oneday)+2)*oneday-min*oneday+max*oneday;\n\n      const s0 = p1[0];\n      const s1 = s0+w;\n      const a0 = limit24(s0);\n      const a1 = limit24(s1);\n      const as = start24(s0) === start24(s1);\n\n      this.pointLoopData = [];\n      this.lineLoopData = [];\n      const pointMarge = {};\n\n      const checkRange = (x, i) => {\n        return (x+i >= s0 && x+i <= s1);\n      }\n\n      const findPoint = (idx, p, dx) => {\n        let rp = null;\n        if (typeof pointMarge[idx] === 'undefined') {\n          pointMarge[idx] = {};\n        }\n        rp = pointMarge[idx][p.i];\n        if (rp) return rp;\n        rp = { ...p };\n        rp.dx = dx;\n        rp.x = p.x+rp.dx;\n        rp.org = p;\n        delete rp.time;\n        pointMarge[idx][p.i] = rp;\n        this.pointLoopData.push(rp);\n        return rp;\n      }\n\n      this.lineData.forEach( (p, i) => {\n        for (var i=pp;i<pp+pw;i+=oneday) {\n          if (checkRange(p.s.x, i) || checkRange(p.d.x, i)) {\n            p.s.mark = true;\n            p.d.mark = true;\n            const s = findPoint(i, p.s, i);\n            const d = findPoint(i, p.d, i);\n            const l = { ...p };\n            l.org = p;\n            l.i = i;\n            l.s = s;\n            l.d = d;\n            this.lineLoopData.push(l);\n          }\n        }\n      })\n\n      this.pointData.forEach( p => {\n        if (!p.mark) {\n          for (var i=pp;i<pp+pw;i+=oneday) {\n            if (checkRange(p.x, i)) {\n              findPoint(i, p, i);\n            }\n          }\n        }\n        delete p.mark;\n      })\n    }\n  }\n\n  update = () => {\n    const self = this;\n    const { width, height } = this.size();\n\n    this.textData = [];\n    this.pointLoopData.forEach( (p, i) => {\n      p.x = p.org.x+p.dx;\n      if (p.org.selected) {\n        if (!p.time) {\n          p.time = Utils.makeTimeText(p);\n        }\n        this.textData.push(p.time)\n      }\n    })\n\n    this.line.selectAll('line.link')\n      .data(this.lineLoopData)\n      .exit()\n      .remove()\n\n    this.line.selectAll('line.link')\n      .data(this.lineLoopData)\n      .enter()\n      .append('line')\n      .classed('link', true)\n      .attr('fill', 'none')\n      .style(\"pointer-events\", \"none\")\n      .attr('stroke-width', 1)\n\n    this.line.selectAll('line.selection')\n      .data(this.lineLoopData)\n      .exit()\n      .remove()\n\n    this.line.selectAll('line.selection')\n      .data(this.lineLoopData)\n      .enter()\n      .append('line')\n      .classed('selection', true)\n      .attr('fill', 'none')\n      .attr('stroke', 'rgb(0,0,0,0)')\n      .attr('stroke-width', 6)\n\n    this.rect.selectAll('rect.link')\n      .data(this.pointLoopData)\n      .exit()\n      .remove()\n\n    this.rect.selectAll('rect.link')\n      .data(this.pointLoopData)\n      .enter()\n      .append('rect')\n      .classed('link', true)\n      .attr('fill', 'rgba(0,0,0,0)')\n      .call(this.dragHandle)\n      .on('dblclick',(d, i) => {\n        console.log(`dbl ${i}`);\n      })\n      .on('mouseover', (_d, i) => {\n        const d = _d.org;\n        if (!d.selected) {\n          if (!_d.time) {\n            _d.time = Utils.makeTimeText(_d);\n          }\n          if (_d.time) {\n            if (this.textData.indexOf(_d.time) < 0) {\n              this.textData.push(_d.time)\n            }\n          }\n          this.updateText();\n        }\n      })\n      .on('mouseout', (_d, i) => {\n        const d = _d.org;\n        if (!d.selected) {\n          if (_d.time) {\n            this.textData.splice(this.textData.indexOf(_d.time),1);\n          }\n          this.updateText();\n        }\n      })\n\n    this.line.selectAll('line.link')\n      .attr('x1', d => this.xScale(d.s.x))\n      .attr('y1', d => this.yScale(d.s.y))\n      .attr('x2', d => this.xScale(d.d.x))\n      .attr('y2', d => this.yScale(d.d.y))\n      .attr('stroke', d => d.org.selected ? '#F00' : '#999')\n\n    this.line.selectAll('line.selection')\n      .attr('x1', d => this.xScale(d.s.x))\n      .attr('y1', d => this.yScale(d.s.y))\n      .attr('x2', d => this.xScale(d.d.x))\n      .attr('y2', d => this.yScale(d.d.y))\n      .on('click', (_d, i) => {\n        const d = _d.org;\n        if (!d3.event.shiftKey) {\n          this.pointData.forEach( d => {\n            this.deselectPoint(d);\n          })\n          this.lineData.forEach( d => {\n            delete d.selected;\n          })\n        } else {\n          if (d.selected) {\n            this.lineData.forEach( l => {\n              if (!l.s.lines) l.s.lines = [];\n              if (!l.d.lines) l.d.lines = [];\n              l.s.lines.push(l);\n              l.d.lines.push(l);\n            })\n            const deepSelect = (l) => {\n              if (!l.selected) {\n                l.selected = true;\n                this.selectPoint(l.s);\n                this.selectPoint(l.d);\n                l.s.lines.forEach( l => {\n                  deepSelect(l);\n                })\n                l.d.lines.forEach( l => {\n                  deepSelect(l);\n                })\n              }\n            }\n            delete d.selected;\n            deepSelect(d);\n            this.pointData.forEach( p => {\n              delete p.lines;\n            })\n          }\n        }\n        d.selected = true;\n        this.update();\n      })\n\n    this.rect.selectAll('rect.link')\n      .attr('x', d => this.xScale(d.x)-4)\n      .attr('y', d => this.yScale(d.y)-4)\n      .attr('width', 8)\n      .attr('height', 8)\n      .attr('fill', d => d.org.lastSelect ? '#FF0000' : '#00000000')\n      .attr('stroke', d => d.org.selected ? ( d.org.lastSelect ? '#FF0000' : '#FFA000') : '#999')\n      .attr('stroke-width', 1)\n\n    this.updateGrid(this.grid, this.gridRectangles());\n    this.updateGrid(this.menu, this.menuRectangles());\n\n    this.updateText();\n  }\n\n  updateText = () => {\n    this.text.selectAll('text')\n      .data(this.textData)\n      .exit()\n      .remove()\n\n    this.text.selectAll('text')\n      .data(this.textData)\n      .enter()\n      .append('text')\n      .style(\"pointer-events\", \"none\")\n\n    this.text.selectAll('text')\n      .each( (d, i) => {\n        if (d.update) d.update();\n      })\n      .attr('fill', (d) => d.color ? d.color : 'black')\n      .attr('font-size', d => 18*d.fontSize)\n      .attr('x', d => this.xScale(d.x)+d.dx)\n      .attr('y', d => this.yScale(d.y)+d.dy)\n      .attr('transform',d => d.rotate ? `rotate(${d.rotate},${this.xScale(d.x)},${this.yScale(d.y)})` : '')\n      .text(d => d.text )\n  }\n\n  updateMarky = () => {\n    const marky = this.marky;\n    marky\n      .selectAll('rect')\n      .attr('visibility', d => d.visible ? 'visible' : 'hidden')\n      .attr('fill', (d) => d.color ? d.color : 'none')\n      .attr('x', d => d.width >= 0 ? d.x : d.x+d.width)\n      .attr('y', d => d.height >= 0 ? d.y : d.y+d.height)\n      .attr('width', d => d.width >= 0 ?  d.width : -d.width)\n      .attr('height', d => d.height >= 0 ?  d.height : -d.height)\n  }\n\n  gridRectangles = () => {\n    const { width, height } = this.size();\n    const convert = (p) => {\n      return [this.xScale.invert(p[0]), this.yScale.invert(p[1])];\n    }\n    const p1 = convert([0, 0]);\n    const w = this.xScale.invert(width )-this.xScale.invert(0);\n    const h = this.yScale.invert(height)-this.yScale.invert(0);\n    const hourw = this.xScale(60*60)-this.xScale(0);\n\n    //\n    const r = [];\n    //\n    const l = [];\n    //\n    const t = [];\n\n    r.push({\n      color: '#00000000',\n      x: p1[0],\n      y: p1[1],\n      width: w,\n      height: h,\n    })\n\n    //------------------------------------------------------------------\n\n    const drawTimeLine = (size) => {\n      for (var i=0;i<w+size*4;i+=size) {\n        const x1 = i+p1[0]-(p1[0]%(size*2))-size*2;\n        const y1 = p1[1];\n        let idx = parseInt(x1+(x1 > 0 ? 0.5 : -0.5));\n        let color = null;\n        let text = null;\n        let width = 1;\n        let fontSize = 0.85;\n        let fontColor = '#808080';\n        let idd = idx;\n        if (idx < 0) idx = -(oneday+idx);\n        if ((idx % oneday) == 0) {\n          width = 4;\n          if (idd === 0 || idd === oneday) {\n            color = '#A0A0FF';\n          } else {\n            color = '#E0E0E0';\n          }\n          text = Utils.toTime(x1);\n          fontSize = 1;\n          fontColor = '#404040';\n          if (x1 < 0 || x1 >= 24*60*60) {\n            fontColor = '#A0A0A0';\n          }\n        } else\n        if ((idx % (60*60)) == 0) {\n          width = 2;\n          color = '#A0FFFF';\n          text = Utils.toTime(x1);\n          fontSize = 1;\n          fontColor = '#404040';\n          if (x1 < 0 || x1 >= 24*60*60) {\n            fontColor = '#A0A0A0';\n          }\n        } else\n        if ((idx % (30*60)) == 0) {\n          color = '#A0FFFF';\n          if (hourw/(this.gridScale.x+5) >= 2) {\n            text = Utils.toTime(x1);\n          }\n        } else\n        if ((idx % (15*60)) == 0 && hourw/(this.gridScale.x+5) >= 2) {\n          color = '#E0FFFF';\n          if (hourw/(this.gridScale.x+5) >= 4) {\n            text = Utils.toTime(x1);\n          }\n        } else\n        if ((idx % ( 5*60)) == 0 && hourw/(this.gridScale.x+5) >= 4) {\n          color = '#E0FFFF';\n          if (hourw/(this.gridScale.x+5) >= 12) {\n            text = Utils.toTime(x1);\n          }\n        } else\n        if ((idx % (   60)) == 0 && hourw/(this.gridScale.x+5) >= 12) {\n          color = '#E0FFFF';\n          if (hourw/(this.gridScale.x+5) >= 60) {\n            text = Utils.toTime(x1).slice(-2);\n          }\n        }\n        if (color) {\n          l.push({\n            x1: this.xScale(x1),\n            y1: this.yScale(y1),\n            x2: this.xScale(x1),\n            y2: this.yScale(y1+h),\n            color,\n            width,\n          });\n          if (text) {\n            t.push({\n              x: x1,\n              y: y1,\n              dx: 4,\n              dy: -3,\n              rotate: 90,\n              name: text,\n              color: fontColor,\n              fontSize,\n            })\n          }\n        }\n      }\n    }\n    drawTimeLine(60);\n\n    //------------------------------------------------------------------\n\n    {\n      const size = 1;\n      for (var i=0;i<h+size*4;i+=size) {\n        const x1 = p1[0];\n        const y1 = parseInt(i+p1[1]-(p1[1]%(size*2))-size*2+0.5);\n        if (y1 >= 1 && y1 <= this.busStops.length) {\n          const busStop = this.busStops[y1-1];\n          const q = {\n            x1: this.xScale(x1),\n            y1: this.yScale(y1),\n            x2: this.xScale(x1+w),\n            y2: this.yScale(y1),\n            color: '#80FFFF',\n            width: 1,\n            //stroke: '2,2',\n          }\n          if (busStop.selected) {\n            q.color = 'red';\n          }\n          l.push(q);\n        }\n      }\n    }\n\n    return {\n      rectData: r,\n      lineData: l,\n      textData: t,\n    };\n  }\n\n  menuRectangles = () => {\n    const { width, height } = this.size();\n    const convert = (p) => {\n      return [this.xScale.invert(p[0]), this.yScale.invert(p[1])];\n    }\n    const p1 = convert([0, 0]);\n    const w = this.xScale.invert(width )-this.xScale.invert(0);\n    const h = this.yScale.invert(height)-this.yScale.invert(0);\n    const menuw = this.xScale.invert(menuWidth)-this.xScale.invert(0);\n\n    //\n    const r = [];\n    //\n    const l = [];\n    //\n    const t = [];\n\n    r.push({\n      color: '#F8F8F8D0',\n      x: p1[0],\n      y: p1[1],\n      width: menuw,\n      height: h,\n    })\n\n    l.push({\n      color: '#D0D0D0',\n      x1: menuWidth,\n      y1: 0,\n      x2: menuWidth,\n      y2: height,\n      width: 1,\n    })\n\n    //------------------------------------------------------------------\n\n    {\n      const size = 1;\n      for (var i=0;i<h+size*4;i+=size) {\n        const x1 = p1[0];\n        const y1 = parseInt(i+p1[1]-(p1[1]%(size*2))-size*2+0.5);\n        if (y1 >= 1 && y1 <= this.busStops.length) {\n          const busStop = this.busStops[y1-1];\n          const q = {\n            x1: this.xScale(x1),\n            y1: this.yScale(y1),\n            x2: this.xScale(x1+menuw),\n            y2: this.yScale(y1),\n            color: '#80FFFF',\n            width: 1,\n            //stroke: '2,2',\n          }\n          if (busStop.selected) {\n            q.color = 'red';\n          }\n          l.push(q);\n          const s = {\n            x: x1,\n            y: y1,\n            dx: 4,\n            dy: -4,\n            name: busStop.name,\n            color: '#404040',\n            index: y1,\n            fontSize: 1,\n          }\n          if (busStop.selected) {\n            s.color = 'red';\n          }\n          t.push(s);\n        }\n      }\n    }\n\n    return {\n      rectData: r,\n      lineData: l,\n      textData: t,\n    };\n  }\n\n  clearGrid = (node) => {\n    node\n      .selectAll('line.stops')\n      .remove();\n\n    node\n      .selectAll('text.stops')\n      .remove();\n\n    node\n      .selectAll('rect.stops')\n      .remove();\n  }\n\n  updateGrid = (node, { rectData, lineData, textData, }) => {\n    node\n      .selectAll('rect.stops')\n      .data(rectData)\n      .exit()\n      .remove()\n    node\n      .selectAll('rect.stops')\n      .data(rectData)\n      .enter()\n      .append('rect')\n      .classed('stops', true)\n      //.style(\"pointer-events\", \"none\")\n      .attr('stroke', 'none')\n      .attr('stroke-width', 2)\n      .attr('fill', (d) => d.color ? d.color : 'none')\n      .attr('x', d => this.xScale(d.x))\n      .attr('y', d => this.yScale(d.y))\n      .attr('width', d => this.xScale(d.width)-this.xScale(0))\n      .attr('height', d => this.yScale(d.height)-this.yScale(0))\n    node\n      .selectAll('line.stops')\n      .data(lineData)\n      .exit()\n      .remove()\n    node\n      .selectAll('line.stops')\n      .data(lineData)\n      .enter()\n      .append('line')\n      .classed('stops', true)\n      .attr('fill', 'rgba(0,0,0,0)')\n      .attr('stroke', (d) => d.color ? d.color : 'none')\n      .attr('stroke-width', d => d.width)\n      .attr('stroke-dasharray', (d) => d.stroke ? d.stroke : 'none')\n      .attr('x1', d => d.x1)\n      .attr('y1', d => d.y1)\n      .attr('x2', d => d.x2)\n      .attr('y2', d => d.y2)\n      .on('click', function(d, i) {\n        //console.log('click 1');\n      })\n      .on('mouseover', function(d, i) {\n        //console.log('mouseover');\n      })\n    node\n      .selectAll('text.stops')\n      .data(textData)\n      .exit()\n      .remove()\n    node\n      .selectAll('text.stops')\n      .data(textData)\n      .enter()\n      .append('text')\n      .classed('stops', true)\n      .attr('fill', (d) => d.color ? d.color : 'black')\n      .attr('font-size', d => 13*d.fontSize)\n      .attr('x', d => this.xScale(d.x)+d.dx)\n      .attr('y', d => this.yScale(d.y)+d.dy)\n      .attr('text-anchor', 'start')\n      .attr('transform',d => d.rotate ? `rotate(${d.rotate},${this.xScale(d.x)},${this.yScale(d.y)})` : '')\n      .text(d => d.name == '' ? '' : d.name )\n      .on('dblclick', (d, i) => {\n      })\n      .on('click', (d, i) => {\n        if (typeof d.index !== 'undefined') {\n          const busStop = this.busStops[d.index-1];\n          if (busStop.selected) {\n            const busStop = this.busStops[d.index-1];\n            if (this.props.onEditBusStop) {\n              this.props.onEditBusStop({\n                name: busStop.name,\n                data: this.busStopData(d.index),\n              });\n            }\n          } else {\n            this.busStops.forEach( b => {\n              delete b.selected;\n            })\n            busStop.selected = true;\n            this.clearGrid(this.grid);\n            this.clearGrid(this.menu);\n            this.updateGrid(this.grid, this.gridRectangles());\n            this.updateGrid(this.menu, this.menuRectangles());\n          }\n        }\n      })\n      .on('mouseover', function(d, i) {\n        if (typeof d.index !== 'undefined') {\n          //console.log(`mouseover stop ${d.index}`);\n        }\n      })\n  }\n\n  drawCursor = () => {\n    this.cursor.selectAll('rect').remove();\n    this.cursor.append('rect')\n      .attr('fill', 'none')\n      .attr('x', this.xScale(this.cursorData.x)-4)\n      .attr('y', this.yScale(this.cursorData.y)-4)\n      .attr('visibility', (this.cursorData.visible && this.altKey) ? 'visible' : 'hidden')\n      .attr('width', 8)\n      .attr('height', 8)\n      .attr('stroke-width', 1)\n      .attr('stroke', '#999')\n      .on('click', function(d, i) {\n        //console.log('click ?');\n      })\n  }\n\n  onKeyDown = (e) => {\n    this.altKey = e.altKey;\n    //space key\n    if(e.keyCode === 32) {\n      e.preventDefault();\n      const b = textDiagramData(Utils.save(this));\n      this.pointData.forEach( d => {\n        delete d.lastSelect;\n      })\n      const p = {\n        x: this.cursorData.x,\n        y: this.cursorData.y,\n        lastSelect: true,\n      }\n      p.time = Utils.makeTimeText(p);\n      this.selectPoint(p);\n      this.pointData.push(p)\n      this.onChange();\n      this.updateData();\n      this.update();\n      this.cursorData.visible = false;\n      this.drawCursor();\n      this.setUndo(b);\n    }\n    //delete key\n    if(e.keyCode === 8 || e.keyCode === 46) {\n      e.preventDefault();\n      let done = false;\n      const b = textDiagramData(Utils.save(this));\n      this.lineData.forEach( d => {\n        if (d.s.selected || d.d.selected) {\n          d.selected = true;\n        }\n      })\n      let pointData = [];\n      this.pointData.forEach( d => {\n        if (!d.selected) {\n          pointData.push(d);\n        } else {\n          done = true;\n          if (d.time) {\n            this.textData.splice(this.textData.indexOf(d.time),1);\n          }\n        }\n      })\n      let lineData = [];\n      this.lineData.forEach( d => {\n        if (!d.selected) {\n          lineData.push(d);\n        }\n      })\n      if (done) this.setUndo(b);\n      this.pointData = pointData;\n      this.lineData = lineData;\n      this.onChange();\n      this.updateData();\n      this.update();\n    }\n    //enter key\n    if(e.keyCode === 13) {\n      e.preventDefault();\n      const b = textDiagramData(Utils.save(this));\n      let selectedBusStop = 0;\n      this.busStops.some( (b, i) => {\n        if (!b.selected) return false;\n        selectedBusStop = i+1;\n        return true;\n      })\n      if (selectedBusStop >= 1\n       && selectedBusStop <= this.busStops.length) {\n        if (e.shiftKey) {\n          if (this.busStops.length <= 2 || selectedBusStop < 2) return;\n          Utils.deleteBusstop(this, selectedBusStop-2);\n          this.setUndo(b);\n        } else {\n          Utils.insertBusstop(this, selectedBusStop-1);\n          this.setUndo(b);\n        }\n        this.onChange();\n        this.updateData();\n        this.clearGrid(this.grid);\n        this.clearGrid(this.menu);\n        this.update();\n      }\n    }\n    //left key \n    if(e.keyCode === 37) {\n      e.preventDefault();\n    }\n    //right key \n    if(e.keyCode === 39) {\n      e.preventDefault();\n    }\n    //command+z\n    if(e.metaKey && e.keyCode === 90) {\n      e.preventDefault();\n      if (!this.props.readonly) {\n        if (e.shiftKey) {\n          this.doRedo();\n        } else {\n          this.doUndo();\n        }\n      }\n    }\n  }\n\n  onKeyUp = (e) => {\n    this.altKey = e.altKey;\n  }\n\n  onMouseLeave = (event) => {\n    if (event.shiftKey) {\n      this.marky.width = 0;\n      this.marky.height = 0;\n    }\n  }\n\n  onChange = () => {\n    const b = Utils.save(this);\n    if (this.props.onChangeData) {\n      this.props.onChangeData(b);\n    }\n  }\n\n  setUndo = (b) => {\n    this.undoBuffer = this.undoBuffer.slice(0, this.undoPtr);\n    this.undoBuffer.push(b);\n    this.undoPtr ++;\n  }\n\n  doUndo = () => {\n    if (this.undoPtr > 0) {\n      this.undoPtr--;\n      const b = this.undoBuffer[this.undoPtr];\n      this.loadData(b);\n      if (this.props.onChangeData) {\n        this.props.onChangeData(b);\n      }\n    }\n  }\n\n  doRedo = () => {\n    if (this.undoBuffer.length > this.undoPtr) {\n      const b = this.undoBuffer[this.undoPtr];\n      this.loadData(b);\n      if (this.props.onChangeData) {\n        this.props.onChangeData(b);\n      }\n      this.undoPtr++;\n    }\n  }\n\n  get diagramData() {\n    const t = Utils.save(this);\n    return textDiagramData(t);\n  }\n\n  busStopData(stopNo) {\n    const r = [];\n    const busStop = this.busStops[stopNo-1];\n    const name = busStop.name;\n    this.pointData.forEach( (p, i) => {\n      p.idx = i;\n      delete p.mark;\n      delete p.lines;\n    })\n    this.lineData.forEach( l => {\n      if (typeof l.s.lines === 'undefined') l.s.lines = [];\n      if (typeof l.d.lines === 'undefined') l.d.lines = [];\n      l.s.lines.push(l);\n      l.d.lines.push(l);\n    })\n    this.pointData.forEach( p => {\n      if (p.y === stopNo) {\n        r.push(p);\n      }\n    })\n    const findLinkedTime = (p, t, o, s) => {\n      if (p.mark) return;\n      if (o.y === p.y) s.push(p);\n      t.push(p);\n      p.mark = true;\n      p.lines.forEach( l => {\n        findLinkedTime(l.s, t, o, s);\n        findLinkedTime(l.d, t, o, s);\n      })\n    }\n    const rp = [];\n    const times = r.map( p => {\n      const t = [];\n      const s = [];\n      findLinkedTime(p, t, p, s);\n      if (t.length > 1) {\n        t.sort( (a,b) => {\n          if (a.y > b.y) return  1;\n          if (a.y < b.y) return -1;\n          return 0;\n        })\n        const fp = t[0];\n        const ep = t[t.length-1];\n        s.sort( (a,b) => {\n          if (a.x > b.x) return  1;\n          if (a.x < b.x) return -1;\n          return 0;\n        })\n        let q =  { ...s[s.length-1] };\n        if (fp.x < ep.x) {\n          q.dir = 'down';\n          q.departure = this.busStops[fp.y-1];\n          q.arrival = this.busStops[ep.y-1];\n        } else {\n          q.dir = 'up';\n          q.departure = this.busStops[ep.y-1];\n          q.arrival = this.busStops[fp.y-1];\n        }\n        q.x = limit24(q.x);\n        let g = parseInt(q.x+0.5);\n        q.sec = parseInt(g % 60);\n        q.min = parseInt(g / 60) % 60;\n        q.hour = parseInt(parseInt(g / 60) / 60);\n        return q;\n      }\n      return null;\n    })\n    .filter( p => p !== null )\n    .sort( (a,b) => {\n      if (a.x > b.x) return  1;\n      if (a.x < b.x) return -1;\n      return 0;\n    });\n    this.pointData.forEach( p => {\n      delete p.idx;\n      delete p.mark;\n      delete p.lines;\n    })\n    return {\n      name,\n      times,\n    }\n  }\n\n  resetScreenPosition = () => {\n    const { width, height } = this.size();\n\n    this.xScale\n      .domain([0, width*this.timeLineWidth()])\n      .range([0, width]);\n\n    const w = (width - menuWidth)/(this.gridScale.x*24);\n\n    this.base\n      .call(this.gridZoomBehavior.transform, d3.zoomIdentity.translate(this.gridScale.x*(menuWidth/this.gridScale.x), 0).scale(w));\n\n    this.menu\n      .call(this.menuZoomBehavior.transform, d3.zoomIdentity.translate(0, 0).scale(1));\n  }\n\n  render() {\n    return (\n      <div\n        ref={n => this.container = n}\n        style={{\n          display: 'inline-block',\n          marign: 0,\n          padding: 0,\n          width: this.state.width,\n          overflow: 'hidden',\n          border: 'solid 1px lightgray',\n        }}\n        tabIndex={0}\n        focusable={true}\n        onKeyDown={this.onKeyDown}\n        onKeyUp={this.onKeyUp}\n        onMouseLeave={this.onMouseLeave}\n      >\n        <svg\n          ref={n => {\n            this.svgElement = n;\n            this.svg = d3.select(n)\n          }}\n          width=\"100%\"\n          height={this.state.height}\n          style={{\n            marign: 0,\n          }}\n        >\n          <g ref={n => this.base = d3.select(n)} >\n            <g ref={n => this.axis = d3.select(n)} style={{ visibility: 'hidden' }}/>\n            <g ref={n => this.grid = d3.select(n)} />\n            <g ref={n => this.line = d3.select(n)} />\n            <g ref={n => this.rect = d3.select(n)} />\n            <g ref={n => this.cursor = d3.select(n)} />\n            <g ref={n => this.text = d3.select(n)} />\n            <g ref={n => this.marky = d3.select(n)} />\n          </g>\n          <g ref={n => this.menu = d3.select(n)} />\n        </svg>\n      </div>\n    )\n  }\n}\n\nDiagramView.defaultProps = {\n  params: {},\n  readonly: false,\n}\n","import React, { Component } from 'react';\nimport {\n  Row,\n  Col,\n  Button,\n  Modal,\n} from 'react-bootstrap';\n\nexport default class BusStopEditDialog extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      ...props.busStop,\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.busStop !== nextProps.busStop) {\n      this.setState({\n        ...nextProps.busStop,\n      })\n    }\n  }\n\n  onClose = () => {\n    if (this.props.onClose) {\n      this.props.onClose();\n    }\n  }\n\n  onEdited = () => {\n    if (this.props.onEdited) {\n      this.props.onEdited({\n        name: this.state.name,\n      });\n    }\n  }\n\n  render() {\n    const times = [];\n    for (var i=0;i<24;i++) {\n      times.push([]);\n    }\n    if (this.state.data.times) {\n      this.state.data.times.forEach( t => {\n        times[t.hour].push(t);\n      })\n    }\n    return (\n      <Modal\n        show={this.props.show}\n        size=\"lg\"\n        onHide={this.onClose}\n      >\n        <Modal.Header closeButton>\n          <Modal.Title>\n            \n          </Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <Row>\n            <Col md={12}>\n              <input\n                type=\"text\"\n                style={{ width: '100%', marginBottom: 10, }}\n                value={this.state.name}\n                onChange={(e) => {\n                  this.setState({\n                    name: e.target.value,\n                  })\n                }}\n                placeholder=\"\"\n                readOnly={this.props.readonly?'readonly':null}\n              />\n            </Col>\n          </Row>\n          <Row>\n            <Col md={12}>\n              <table style={{ width: '100%', }}>\n                <thead>\n                  <tr key={i} style={{ border: 'solid 1px lightgray',  }} >\n                    <th width={50}>\n                      <span style={{ margin: 10, }}></span>\n                    </th>\n                    <th style={{ borderLeft: 'solid 1px lightgray', width: '50%', textAlign: 'center', }}>\n                      <span></span>\n                    </th>\n                    <th style={{ borderLeft: 'solid 1px lightgray', width: '50%', textAlign: 'center', }}>\n                      <span></span>\n                    </th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {\n                    times.map( (t, i) => {\n                      return (\n                        <tr key={i} style={{ border: 'solid 1px lightgray',  }} >\n                          <td width={50}>\n                            <span style={{ margin: 10, }}>{ ('00'+i).slice(-2) }</span>\n                          </td>\n                          <td style={{ borderLeft: 'solid 1px lightgray', width: '50%', }}>\n                            <span>{ t.filter( d => d.dir === 'up').map( v => `${v.min}` ).join(', ') }</span>\n                          </td>\n                          <td style={{ borderLeft: 'solid 1px lightgray', width: '50%', }}>\n                            <span>{ t.filter( d => d.dir === 'down').map( v => `${v.min}` ).join(', ') }</span>\n                          </td>\n                        </tr>\n                      )\n                    })\n                  }\n                </tbody>\n              </table>\n            </Col>\n          </Row>\n        </Modal.Body>\n        <Modal.Footer>\n          <Button onClick={this.onEdited}>OK</Button>\n        </Modal.Footer>\n      </Modal>\n    )\n  }\n}\n\nBusStopEditDialog.defaultProps = {\n  show: false,\n  busStop: {\n    name: '',\n    data: {},\n  },\n  readonly: false,\n}\n","import React, { Component } from 'react';\nimport {\n  Row,\n  Col,\n  Button,\n  Modal,\n} from 'react-bootstrap';\nimport AceEditor from 'react-ace';\nimport 'brace/mode/plain_text';\nimport 'brace/theme/chrome';\n\nexport default class DiagramDataDialog extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      text: props.text,\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.text !== nextProps.text) {\n      this.setState({\n        text: (nextProps.text === null) ? '' : nextProps.text,\n      })\n    }\n  }\n\n  onClose = () => {\n    if (this.props.onClose) {\n      this.props.onClose();\n    }\n  }\n\n  onEdited = () => {\n    if (this.props.onEdited) {\n      this.props.onEdited(this.state.text);\n    }\n  }\n\n  onChangeText = (value) => {\n    this.setState({ text: value });\n  }\n\n  render() {\n    return (\n      <Modal\n        show={this.props.show}\n        size=\"lg\"\n        onHide={this.onClose}\n      >\n        <Modal.Header closeButton>\n          <Modal.Title>\n            \n          </Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <Row>\n            <Col md={12}>\n              {\n                <AceEditor\n                  ref={ r => this.editor = r }\n                  style={{\n                    display: 'inline-block',\n                    border: 'solid 1px lightgray',\n                  }}\n                  mode=\"text\"\n                  theme=\"chrome\"\n                  value={this.state.text}\n                  width=\"100%\"\n                  height={`${this.props.height}px`}\n                  onChange={this.onChangeText}\n                  showPrintMargin={false}\n                  fontSize={12}\n                  name=\"digram_data_dialog\"\n                  editorProps={{$blockScrolling: Infinity}}\n                  readOnly={this.props.readonly}\n                />\n              }\n            </Col>\n          </Row>\n        </Modal.Body>\n        <Modal.Footer>\n          <Button onClick={this.onEdited}>OK</Button>\n        </Modal.Footer>\n      </Modal>\n    )\n  }\n}\n\nDiagramDataDialog.defaultProps = {\n  show: false,\n  name: '',\n  height: 100,\n}\n","import React, { Component } from 'react';\nimport DiagramView from '../../components/DiagramView';\nimport BusStopDialog from '../../components/BusStopDialog';\nimport DiagramDataDialog from '../../components/DiagramDataDialog';\n\nconst namespace = 'diagram';\n\nconst AsyncStorage = {\n  getItem: function(key, defaultValue) {\n    const value = localStorage.getItem(`${namespace}-${key}`);\n    return (value !== null) ? JSON.parse(value).data : defaultValue;\n  },\n  setItem: function(key, value) {\n    localStorage.setItem(`${namespace}-${key}`, JSON.stringify({ data: value }));\n  },\n}\n\nexport default class Diagram extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showBusStopDialog: false,\n      busStop: {\n        name: '',\n        data: {},\n      },\n      params: AsyncStorage.getItem('params', {}),\n      width: window.innerWidth,\n      height: window.innerHeight,\n      diagramData: AsyncStorage.getItem('data', ''),\n      diagramEditData: '',\n    }\n  }\n\n  onResize = () => {\n    this.setState({\n      width: window.innerWidth,\n      height: window.innerHeight,\n    }, this.update);\n  }\n\n  componentDidMount() {\n    window.addEventListener('resize', this.onResize, false);\n  }\n  \n  componentWillUnmount() {\n    window.removeEventListener('resize', this.onResize);\n  }\n\n  onEditBusStop = (busStop) => {\n    this.setState({\n      showBusStopDialog: true,\n      busStop,\n    });\n  }\n\n  onCloseBusStop = () => {\n    this.setState({\n      showBusStopDialog: false,\n    })\n  }\n\n  onEditedBusStop = (busStop) => {\n    this.state.busStop.name = busStop.name;\n    this.setState({\n      showBusStopDialog: false,\n    });\n  }\n\n  openDiagramDataDialog = () => {\n    this.setState({\n      showDiagramDataDialog: true,\n      diagramEditData: this.diagramView.diagramData,\n    });\n  }\n\n  onEditedDiagramData = (diagramData) => {\n    this.setState({\n      showDiagramDataDialog: false,\n      diagramData,\n    });\n  }\n\n  onCloseDiagramData = () => {\n    this.setState({\n      showDiagramDataDialog: false,\n    })\n  }\n\n  onChangeData = (data) => {\n    AsyncStorage.setItem('data', this.diagramView.diagramData);\n  }\n\n  onChangeParam = (params) => {\n    AsyncStorage.setItem('params', params);\n  }\n\n  resetScreenPosition = () => {\n    this.diagramView.resetScreenPosition();\n  }\n\n  render() {\n    return (\n      <div style={{ overflow: 'hidden' }}>\n        <nav className=\"navbar sticky-top navbar-light bg-light\">\n          <a className=\"navbar-brand\" href=\"#\"></a>\n          <div>\n            <a\n              href=\"https://docs.google.com/presentation/d/1F0RfbHgcRPHgPSxpe61pBMZ8Yf0WGaXe7XT06Y3AWkk/edit?usp=sharing\"\n              target=\"manual\"\n              className=\"btn btn-sm btn-outline-secondary\"\n              style={{marginRight: 10}}\n              role=\"button\"\n            ></a>\n            <button\n              className=\"btn btn-sm btn-outline-secondary\"\n              style={{marginRight: 10}}\n              type=\"button\"\n              onClick={this.resetScreenPosition}\n            ></button>\n            <button\n              className=\"btn btn-sm btn-outline-secondary\"\n              type=\"button\"\n              onClick={this.openDiagramDataDialog}\n            ></button>\n          </div>\n        </nav>\n        <DiagramView\n          ref={n => this.diagramView = n}\n          onEditBusStop={this.onEditBusStop}\n          onChangeData={this.onChangeData}\n          onChangeParam={this.onChangeParam}\n          diagramData={this.state.diagramData}\n          params={this.state.params}\n          width={this.state.width-2}\n          height={this.state.height-26-38-10}\n        />\n        <BusStopDialog\n          busStop={this.state.busStop}\n          show={this.state.showBusStopDialog}\n          onClose={this.onCloseBusStop}\n          onEdited={this.onEditedBusStop}\n        />\n        <DiagramDataDialog\n          show={this.state.showDiagramDataDialog}\n          text={this.state.diagramEditData}\n          onClose={this.onCloseDiagramData}\n          onEdited={this.onEditedDiagramData}\n          height={this.state.height-240}\n        />\n      </div>\n    )\n  }\n}\n\nDiagram.defaultProps = {\n}\n"],"sourceRoot":""}