(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{104:function(t,e,a){"use strict";a.r(e);var n=a(7),r=a(8),o=a(11),i=a(9),l=a(10),s=a(1),c=a.n(s),u=a(61),d=a(13),h=a(99),f=function(t){for(;t<0;)t+=86400;for(;t>=86400;)t-=86400;var e=parseInt(t+.5),a=parseInt(e%60),n=parseInt(e/60)%60,r=parseInt(parseInt(e/60)/60),o=function(t){return"".concat(("00"+t).slice(-2))};return 0!==a?"".concat(o(r),":").concat(o(n),":").concat(o(a)):"".concat(o(r),":").concat(o(n))},p=function(t){var e={update:function(){this.x=t.x,this.y=t.y,this.text=f(t.x),this.dx=6,this.dy=5,this.fontSize=.7}};return e.update(),e},m=function(t){var e=t.busStops,a=t.timeLines,n=e.split("\n").map(function(t){return"-"===t?"":t}),r=a.split("\n"),o=[],i=[];if(r.forEach(function(t){var e=t.split(" "),a=[],n=0,r=null;e.forEach(function(t,e){"-"!==t&&""!==t&&t.split("-").forEach(function(t){var e=function(t,e){var a=t.trim().split(":"),n=0,r=0,o=0;a.length>0&&(n=parseInt(a[0])),a.length>1&&(r=parseInt(a[1])),a.length>2&&(o=parseInt(a[2]));var i,l=60*n*60+60*r+o,s=l;if(null!==e){var c=e%86400-l%86400;((i=c)>0?i:-i)>=43200&&(s+=86400*function(t){return t>0?1:-1}(c))}return{t:s,x:l}}(t,r),i=e.t,l=e.x,s={x:i,y:n+1};s.time=p(s),o.push(s),a.push(s),r=l});n++});var l=null;a.forEach(function(t){l&&i.push({s:l,d:t}),l=t})}),n.length<2)for(;n.length<2;)n.push("");return{busStops:n.map(function(t){return{name:t}}),pointData:o,lineData:i}},y=function(t){var e=t.busStops,a=t.pointData,n=t.lineData,r=e.map(function(t){return t.name.trim()}),o=(a.sort(function(t,e){return t.x>e.x?1:t.x<e.x?-1:0}).map(function(t,e){return t.index=e,t.lines=[],t}),n.map(function(t){if(t.s.x>t.d.x){var e=t.s;t.s=t.d,t.d=e}return t.done=!1,t.s.lines.push(t),t.d.lines.push(t),t}).sort(function(t,e){return t.s.x>e.s.x?1:t.s.x<e.s.x?-1:0})),i=0;o.forEach(function(t,e){!function t(e,a){e.done||(e.done=!0,a<0&&(a=i,i++),e.index=a,e.s.lines.forEach(function(e){t(e,a)}),e.d.lines.forEach(function(e){t(e,a)}))}(t,-1)});var l=[];o.sort(function(t,e){return t.index>e.index?1:t.index<e.index?-1:0}).forEach(function(t){"undefined"==typeof l[t.index]&&(l[t.index]=[]),l[t.index].push(t)});var s=[];return l.forEach(function(t){var e=t.sort(function(t,e){return t.s.y>e.s.y?1:t.s.y<e.s.y?-1:0}),a=!1;e[0].s.y<e[0].d.y&&(a=!0);var n=[],o=null;e.forEach(function(t,e){a?n.push(t.s):n.push(t.d),o=t}),o&&(a?n.push(o.d):n.push(o.s));var i=[];r.forEach(function(t){i.push([])}),n.forEach(function(t){i[t.y-1].push(t)}),s.push(i.map(function(t){if(0===t.length)return"-";var e="";return t.forEach(function(t){""!==e&&(e+="-"),e+=f(t.x)}),e}).join(" "))}),{busStops:r.map(function(t){return""===t?"-":t}).join("\n"),timeLines:s}},g=function(t,e){var a=t.busStops,n=t.pointData;t.lineData;a.splice(e,0,{name:""}),n.forEach(function(t){t.y>=e+1&&(t.y+=1)})},x=function(t,e){var a=t.busStops,n=t.pointData,r=t.lineData;if(console.log(a[e].name),""===a[e].name){a.splice(e,1);var o=[];n.forEach(function(t,a){t.y==e+1?(t.delete=!0,o.push(a)):t.y>e+1&&(t.y-=1)}),o.reverse().forEach(function(t){n.splice(t,1)});var i=[];r.forEach(function(t,e){(t.s.delete||t.d.delete)&&i.push(e)}),i.reverse().forEach(function(t){r.splice(t,1)})}},v=150,D=86400,b=function(t){return t<0&&(t+=D),t%D},S=function(t){return"".concat(t.busStops.split("\n").join(" "),"\n").concat(t.timeLines.join("\n"),"\n")},E=function(t){var e=t.split("\n"),a=null,n=null;return e.some(function(t,e){return 0!=t.indexOf("/")&&(null===a?(a=t,!1):(null===n&&(n=e),!0))}),{busStops:null!==a?a.split(" ").join("\n"):"",timeLines:null!==n?e.slice(n).join("\n"):""}},k=function(t){function e(t){var a;Object(n.a)(this,e),(a=Object(o.a)(this,Object(i.a)(e).call(this,t))).size=function(){return{width:a.state.width,height:a.state.height}},a.loadData=function(t){var e=m(E(t)),n=e.busStops,r=e.lineData,o=e.pointData;a.lineData=r,a.pointData=o,a.busStops=n,a.lineLoopData=[],a.pointLoopData=[],a.textData=[],a.componentDidUpdate()},a.timeLineWidth=function(){return 3600/a.gridScale.x},a.busLineHeight=function(){return 1/a.gridScale.y},a.makeLine=function(t,e){a.lineData.push({s:t,d:e}),a.deleteDoubleLine()},a.selectPoint=function(t){t.selected=!0},a.deselectPoint=function(t){delete t.selected,delete t.lastSelect},a.deleteDoubleLine=function(){var t={},e=[];a.pointData.forEach(function(t,e){t.index=e}),a.lineData.forEach(function(a){var n="".concat(a.d.index,"-").concat(a.s.index);a.s.index<a.d.index&&(n="".concat(a.s.index,"-").concat(a.d.index)),"undefined"===typeof t[n]&&(e.push(a),t[n]=a)}),a.lineData=e},a.initialize=function(){var t=a.size(),e=t.width,n=t.height;a.xScale=h.d().domain([0,e*a.timeLineWidth()]).range([0,e]),a.yScale=h.d().domain([a.gridScale.dy,n*a.busLineHeight()+a.gridScale.dy]).range([0,n]),a.dragHandle=h.a().on("start",function(t,e){var n=t.org;a.cursorData.visible=!1,a.drawCursor();var r=null,o=0;if(a.pointData.some(function(t,e){return!(!t.selected||!t.lastSelect)&&(r=t,o=e,!0)}),a.altKey=h.b.sourceEvent.altKey,h.b.sourceEvent.altKey&&null!==r&&o!==e){var i=S(y(Object(d.a)(Object(d.a)(a)))),l=a.pointData.length,s=a.lineData.length;a.pointData.forEach(function(t){delete t.lastSelect}),n.lastSelect=!0,a.selectPoint(n);h.b.on("end",function(t,e){var n=t.org;a.makeLine(r,n),a.onChange(),a.updateData(),a.update(),a.pointData.length==l&&a.lineData.length==s||a.setUndo(i)})}else{var c=S(y(Object(d.a)(Object(d.a)(a)))),u=!1,f=!1;n.selected||(f=!0),a.pointData.forEach(function(t){delete t.lastSelect}),n.lastSelect=!0,a.selectPoint(n),a.pointData.forEach(function(t){t.selected&&(t.ox=a.xScale(t.x),t.oy=a.yScale(t.y))});h.b.on("drag",function(t){var e=t.org;u=!0,!h.b.sourceEvent.shiftKey&&f&&(a.pointData.forEach(function(t){a.deselectPoint(t)}),a.lineData.forEach(function(t){delete t.selected}),a.selectPoint(e)),a.pointData.forEach(function(t){t.selected&&(t.ox+=h.b.dx,t.oy+=h.b.dy,t.x=a.xScale.invert(t.ox))}),a.update()}).on("end",function(t,e){var n=t.org;u?a.setUndo(c):!h.b.sourceEvent.shiftKey&&f&&(a.pointData.forEach(function(t){a.deselectPoint(t)}),a.lineData.forEach(function(t){delete t.selected}),a.selectPoint(n),n.lastSelect=!0),a.pointData.forEach(function(t){delete t.ox,delete t.oy}),a.onChange(),a.update()})}}),a.dragMarky=h.a().on("start",function(t,e){if(a.cursorData.visible=!1,a.drawCursor(),a.altKey=h.b.sourceEvent.altKey,h.b.sourceEvent.altKey){var n=S(y(Object(d.a)(Object(d.a)(a)))),r=null;a.pointData.some(function(t,e){return!(!t.selected||!t.lastSelect)&&(r=t,e,!0)}),a.pointData.forEach(function(t){delete t.lastSelect});var o={x:a.cursorData.x,y:a.cursorData.y,selected:!0,lastSelect:!0};a.selectPoint(o),a.pointData.push(o),r&&a.makeLine(r,o),a.onChange(),a.updateData(),a.update(),a.cursorData.visible=!1,a.drawCursor(),a.setUndo(n)}if(h.b.sourceEvent.shiftKey){a.marky,h.e(a.bar);var i=!1,l=h.b.x,s=h.b.y;a.markyData.x=l,a.markyData.y=s,a.markyData.width=0,a.markyData.height=0;h.b.on("drag",function(t){i||(l=h.b.x,s=h.b.y,a.markyData.x=l,a.markyData.y=s,a.markyData.width=0,a.markyData.height=0,i=!0),l+=h.b.dx,s+=h.b.dy,a.markyData.width=l-a.markyData.x,a.markyData.height=s-a.markyData.y,a.markyData.visible=!0,a.updateMarky()}).on("end",function(){a.markyData.visible=!1,a.updateMarky();var t,e=a.markyData.x,n=a.markyData.y,r=a.markyData.x+a.markyData.width,o=a.markyData.y+a.markyData.height;t=e,r<e&&(e=r,r=t),t=n,o<n&&(n=o,o=t);var i=function(t){return[a.xScale.invert(t[0]),a.yScale.invert(t[1])]},l=i([e,n]),s=i([r,o]);a.pointLoopData.forEach(function(t){if(h.b.sourceEvent.shiftKey&&t.org.selected)return!0;l[0]<=t.x&&t.x<=s[0]&&l[1]<=t.y&&t.y<=s[1]?a.selectPoint(t.org):a.deselectPoint(t.org)});var c=0,u=null;a.pointData.forEach(function(t){t.selected&&(c++,u=t)}),1===c&&(u.lastSelect=!0),a.update()})}});var r=0,o=null;if(a.gridZoomBehavior=h.f().scaleExtent([.8,160]).filter(function(){return a.altKey=h.b.altKey,!h.b.shiftKey&&!h.b.altKey}).on("start",function(){r=0,o=h.b.transform.k}).on("zoom",function(){r++,o!==h.b.transform.k&&(r+=10);var t=h.b.transform;a.props.onChangeParam&&(a.params.gridZoom=t,a.props.onChangeParam(a.params)),a.xScale.range([t.applyX(0),t.applyX(a.state.width)]),a.clearGrid(a.grid),a.updateData(),a.update(),a.cursorData.visible=!1,a.drawCursor()}).on("end",function(){r<5&&(a.pointData.forEach(function(t){a.deselectPoint(t)}),a.lineData.forEach(function(t){delete t.selected,delete t.lastSelect}),a.update())}),a.base.call(a.gridZoomBehavior).on("dblclick.zoom",null).call(a.dragMarky).on("mouseleave",function(){a.cursorData.visible=!1,a.drawCursor()}).on("mousemove",function(){var t=h.c(a.svgElement);a.cursorData.x=a.xScale.invert(t[0]),a.cursorData.y=parseInt(a.yScale.invert(t[1])+.5),a.cursorData.visible=!0,a.drawCursor()}),a.menuZoomBehavior=h.f().scaleExtent([.8,5]).filter(function(){return a.altKey=h.b.altKey,!h.b.shiftKey&&!h.b.altKey}).on("start",function(){r=0,o=h.b.transform.k}).on("zoom",function(){r++,o!==h.b.transform.k&&(r+=10);var t=h.b.transform;a.props.onChangeParam&&(a.params.menuZoom=t,a.props.onChangeParam(a.params)),a.yScale.range([t.applyY(0),t.applyY(a.state.height)]),a.clearGrid(a.grid),a.clearGrid(a.menu),a.update(),a.cursorData.visible=!1,a.drawCursor()}).on("end",function(){r<5&&a.update()}),a.menu.call(a.menuZoomBehavior).on("dblclick.zoom",null),a.updateData(),a.marky.selectAll("rect").data([a.markyData]).enter().append("rect").attr("class","marky").attr("visibility","hidden").attr("stroke","none").attr("stroke-width",2),a.params.gridZoom){var i=a.params.gridZoom;a.base.call(a.gridZoomBehavior.transform,h.g.translate(i.x,0).scale(i.k))}else a.resetScreenPosition();if(a.params.menuZoom){var l=a.params.menuZoom;a.menu.call(a.menuZoomBehavior.transform,h.g.translate(0,l.y).scale(l.k))}a.update()},a.updateData=function(){var t=a.size(),e=t.width,n=(t.height,f=[0,0],[a.xScale.invert(f[0]),a.yScale.invert(f[1])]),r=a.xScale.invert(e)-a.xScale.invert(0),o=D,i=0;a.pointData.forEach(function(t,e){t.i=e,delete t.mark,t.time||(t.time=p(t)),o>t.x&&(o=t.x),i<t.x&&(i=t.x)}),o=o<0?parseInt(o/D)-1:parseInt(o/D),i=i<0?parseInt(i/D)-1:parseInt(i/D);var l=function(t){return t<0&&(t=(parseInt(t/D)-1)*D),parseInt(t/D)*D},s=l(n[0])-i*D,c=(parseInt(r/D)+2)*D-o*D+i*D,d=n[0],h=d+r;b(d),b(h),l(d),l(h);a.pointLoopData=[],a.lineLoopData=[];var f,m={},y=function(t,e){return t+e>=d&&t+e<=h},g=function(t,e,n){var r=null;return"undefined"===typeof m[t]&&(m[t]={}),(r=m[t][e.i])?r:((r=Object(u.a)({},e)).dx=n,r.x=e.x+r.dx,r.org=e,delete r.time,m[t][e.i]=r,a.pointLoopData.push(r),r)};a.lineData.forEach(function(t,e){for(e=s;e<s+c;e+=D)if(y(t.s.x,e)||y(t.d.x,e)){t.s.mark=!0,t.d.mark=!0;var n=g(e,t.s,e),r=g(e,t.d,e),o=Object(u.a)({},t);o.org=t,o.i=e,o.s=n,o.d=r,a.lineLoopData.push(o)}}),a.pointData.forEach(function(t){if(!t.mark)for(var e=s;e<s+c;e+=D)y(t.x,e)&&g(e,t,e);delete t.mark})},a.update=function(){Object(d.a)(Object(d.a)(a));var t=a.size();t.width,t.height;a.textData=[],a.pointLoopData.forEach(function(t,e){t.x=t.org.x+t.dx,t.org.selected&&(t.time||(t.time=p(t)),a.textData.push(t.time))}),a.line.selectAll("line.link").data(a.lineLoopData).exit().remove(),a.line.selectAll("line.link").data(a.lineLoopData).enter().append("line").classed("link",!0).attr("fill","none").style("pointer-events","none").attr("stroke-width",1),a.line.selectAll("line.selection").data(a.lineLoopData).exit().remove(),a.line.selectAll("line.selection").data(a.lineLoopData).enter().append("line").classed("selection",!0).attr("fill","none").attr("stroke","rgb(0,0,0,0)").attr("stroke-width",6),a.rect.selectAll("rect.link").data(a.pointLoopData).exit().remove(),a.rect.selectAll("rect.link").data(a.pointLoopData).enter().append("rect").classed("link",!0).attr("fill","rgba(0,0,0,0)").call(a.dragHandle).on("dblclick",function(t,e){console.log("dbl ".concat(e))}).on("mouseover",function(t,e){t.org.selected||(t.time||(t.time=p(t)),t.time&&a.textData.indexOf(t.time)<0&&a.textData.push(t.time),a.updateText())}).on("mouseout",function(t,e){t.org.selected||(t.time&&a.textData.splice(a.textData.indexOf(t.time),1),a.updateText())}),a.line.selectAll("line.link").attr("x1",function(t){return a.xScale(t.s.x)}).attr("y1",function(t){return a.yScale(t.s.y)}).attr("x2",function(t){return a.xScale(t.d.x)}).attr("y2",function(t){return a.yScale(t.d.y)}).attr("stroke",function(t){return t.org.selected?"#F00":"#999"}),a.line.selectAll("line.selection").attr("x1",function(t){return a.xScale(t.s.x)}).attr("y1",function(t){return a.yScale(t.s.y)}).attr("x2",function(t){return a.xScale(t.d.x)}).attr("y2",function(t){return a.yScale(t.d.y)}).on("click",function(t,e){var n=t.org;if(h.b.shiftKey){if(n.selected){a.lineData.forEach(function(t){t.s.lines||(t.s.lines=[]),t.d.lines||(t.d.lines=[]),t.s.lines.push(t),t.d.lines.push(t)});delete n.selected,function t(e){e.selected||(e.selected=!0,a.selectPoint(e.s),a.selectPoint(e.d),e.s.lines.forEach(function(e){t(e)}),e.d.lines.forEach(function(e){t(e)}))}(n),a.pointData.forEach(function(t){delete t.lines})}}else a.pointData.forEach(function(t){a.deselectPoint(t)}),a.lineData.forEach(function(t){delete t.selected});n.selected=!0,a.update()}),a.rect.selectAll("rect.link").attr("x",function(t){return a.xScale(t.x)-4}).attr("y",function(t){return a.yScale(t.y)-4}).attr("width",8).attr("height",8).attr("fill",function(t){return t.org.lastSelect?"#FF0000":"#00000000"}).attr("stroke",function(t){return t.org.selected?t.org.lastSelect?"#FF0000":"#FFA000":"#999"}).attr("stroke-width",1),a.updateGrid(a.grid,a.gridRectangles()),a.updateGrid(a.menu,a.menuRectangles()),a.updateText()},a.updateText=function(){a.text.selectAll("text").data(a.textData).exit().remove(),a.text.selectAll("text").data(a.textData).enter().append("text").style("pointer-events","none"),a.text.selectAll("text").each(function(t,e){t.update&&t.update()}).attr("fill",function(t){return t.color?t.color:"black"}).attr("font-size",function(t){return 18*t.fontSize}).attr("x",function(t){return a.xScale(t.x)+t.dx}).attr("y",function(t){return a.yScale(t.y)+t.dy}).attr("transform",function(t){return t.rotate?"rotate(".concat(t.rotate,",").concat(a.xScale(t.x),",").concat(a.yScale(t.y),")"):""}).text(function(t){return t.text})},a.updateMarky=function(){a.marky.selectAll("rect").attr("visibility",function(t){return t.visible?"visible":"hidden"}).attr("fill",function(t){return t.color?t.color:"none"}).attr("x",function(t){return t.width>=0?t.x:t.x+t.width}).attr("y",function(t){return t.height>=0?t.y:t.y+t.height}).attr("width",function(t){return t.width>=0?t.width:-t.width}).attr("height",function(t){return t.height>=0?t.height:-t.height})},a.gridRectangles=function(){var t,e=a.size(),n=e.width,r=e.height,o=(t=[0,0],[a.xScale.invert(t[0]),a.yScale.invert(t[1])]),i=a.xScale.invert(n)-a.xScale.invert(0),l=a.yScale.invert(r)-a.yScale.invert(0),s=a.xScale(3600)-a.xScale(0),c=[],u=[],d=[];c.push({color:"#00000000",x:o[0],y:o[1],width:i,height:l});!function(t){for(var e=0;e<i+4*t;e+=t){var n=e+o[0]-o[0]%(2*t)-2*t,r=o[1],c=parseInt(n+(n>0?.5:-.5)),h=null,p=null,m=1,y=.85,g="#808080",x=c;c<0&&(c=-(D+c)),c%D==0?(m=4,h=0===x||x===D?"#A0A0FF":"#E0E0E0",p=f(n),y=1,g="#404040",(n<0||n>=86400)&&(g="#A0A0A0")):c%3600==0?(m=2,h="#A0FFFF",p=f(n),y=1,g="#404040",(n<0||n>=86400)&&(g="#A0A0A0")):c%1800==0?(h="#A0FFFF",s/(a.gridScale.x+5)>=2&&(p=f(n))):c%900==0&&s/(a.gridScale.x+5)>=2?(h="#E0FFFF",s/(a.gridScale.x+5)>=4&&(p=f(n))):c%300==0&&s/(a.gridScale.x+5)>=4?(h="#E0FFFF",s/(a.gridScale.x+5)>=12&&(p=f(n))):c%60==0&&s/(a.gridScale.x+5)>=12&&(h="#E0FFFF",s/(a.gridScale.x+5)>=60&&(p=f(n).slice(-2))),h&&(u.push({x1:a.xScale(n),y1:a.yScale(r),x2:a.xScale(n),y2:a.yScale(r+l),color:h,width:m}),p&&d.push({x:n,y:r,dx:4,dy:-3,rotate:90,name:p,color:g,fontSize:y}))}}(60);for(var h=0;h<l+4;h+=1){var p=o[0],m=parseInt(h+o[1]-o[1]%2-2+.5);if(m>=1&&m<=a.busStops.length){var y=a.busStops[m-1],g={x1:a.xScale(p),y1:a.yScale(m),x2:a.xScale(p+i),y2:a.yScale(m),color:"#80FFFF",width:1};y.selected&&(g.color="red"),u.push(g)}}return{rectData:c,lineData:u,textData:d}},a.menuRectangles=function(){var t,e=a.size(),n=e.width,r=e.height,o=(t=[0,0],[a.xScale.invert(t[0]),a.yScale.invert(t[1])]),i=(a.xScale.invert(n),a.xScale.invert(0),a.yScale.invert(r)-a.yScale.invert(0)),l=a.xScale.invert(v)-a.xScale.invert(0),s=[],c=[],u=[];s.push({color:"#F8F8F8D0",x:o[0],y:o[1],width:l,height:i}),c.push({color:"#D0D0D0",x1:v,y1:0,x2:v,y2:r,width:1});for(var d=0;d<i+4;d+=1){var h=o[0],f=parseInt(d+o[1]-o[1]%2-2+.5);if(f>=1&&f<=a.busStops.length){var p=a.busStops[f-1],m={x1:a.xScale(h),y1:a.yScale(f),x2:a.xScale(h+l),y2:a.yScale(f),color:"#80FFFF",width:1};p.selected&&(m.color="red"),c.push(m);var y={x:h,y:f,dx:4,dy:-4,name:p.name,color:"#404040",index:f,fontSize:1};p.selected&&(y.color="red"),u.push(y)}}return{rectData:s,lineData:c,textData:u}},a.clearGrid=function(t){t.selectAll("line.stops").remove(),t.selectAll("text.stops").remove(),t.selectAll("rect.stops").remove()},a.updateGrid=function(t,e){var n=e.rectData,r=e.lineData,o=e.textData;t.selectAll("rect.stops").data(n).exit().remove(),t.selectAll("rect.stops").data(n).enter().append("rect").classed("stops",!0).attr("stroke","none").attr("stroke-width",2).attr("fill",function(t){return t.color?t.color:"none"}).attr("x",function(t){return a.xScale(t.x)}).attr("y",function(t){return a.yScale(t.y)}).attr("width",function(t){return a.xScale(t.width)-a.xScale(0)}).attr("height",function(t){return a.yScale(t.height)-a.yScale(0)}),t.selectAll("line.stops").data(r).exit().remove(),t.selectAll("line.stops").data(r).enter().append("line").classed("stops",!0).attr("fill","rgba(0,0,0,0)").attr("stroke",function(t){return t.color?t.color:"none"}).attr("stroke-width",function(t){return t.width}).attr("stroke-dasharray",function(t){return t.stroke?t.stroke:"none"}).attr("x1",function(t){return t.x1}).attr("y1",function(t){return t.y1}).attr("x2",function(t){return t.x2}).attr("y2",function(t){return t.y2}).on("click",function(t,e){}).on("mouseover",function(t,e){}),t.selectAll("text.stops").data(o).exit().remove(),t.selectAll("text.stops").data(o).enter().append("text").classed("stops",!0).attr("fill",function(t){return t.color?t.color:"black"}).attr("font-size",function(t){return 13*t.fontSize}).attr("x",function(t){return a.xScale(t.x)+t.dx}).attr("y",function(t){return a.yScale(t.y)+t.dy}).attr("text-anchor","start").attr("transform",function(t){return t.rotate?"rotate(".concat(t.rotate,",").concat(a.xScale(t.x),",").concat(a.yScale(t.y),")"):""}).text(function(t){return""==t.name?"\u540d\u79f0\u672a\u8a2d\u5b9a":t.name}).on("dblclick",function(t,e){}).on("click",function(t,e){if("undefined"!==typeof t.index){var n=a.busStops[t.index-1];if(n.selected){var r=a.busStops[t.index-1];a.props.onEditBusStop&&a.props.onEditBusStop({name:r.name,data:a.busStopData(t.index)})}else a.busStops.forEach(function(t){delete t.selected}),n.selected=!0,a.clearGrid(a.grid),a.clearGrid(a.menu),a.updateGrid(a.grid,a.gridRectangles()),a.updateGrid(a.menu,a.menuRectangles())}}).on("mouseover",function(t,e){t.index})},a.drawCursor=function(){a.cursor.selectAll("rect").remove(),a.cursor.append("rect").attr("fill","none").attr("x",a.xScale(a.cursorData.x)-4).attr("y",a.yScale(a.cursorData.y)-4).attr("visibility",a.cursorData.visible&&a.altKey?"visible":"hidden").attr("width",8).attr("height",8).attr("stroke-width",1).attr("stroke","#999").on("click",function(t,e){})},a.onKeyDown=function(t){if(a.altKey=t.altKey,32===t.keyCode){t.preventDefault();var e=S(y(Object(d.a)(Object(d.a)(a))));a.pointData.forEach(function(t){delete t.lastSelect});var n={x:a.cursorData.x,y:a.cursorData.y,lastSelect:!0};n.time=p(n),a.selectPoint(n),a.pointData.push(n),a.onChange(),a.updateData(),a.update(),a.cursorData.visible=!1,a.drawCursor(),a.setUndo(e)}if(8===t.keyCode||46===t.keyCode){t.preventDefault();var r=!1,o=S(y(Object(d.a)(Object(d.a)(a))));a.lineData.forEach(function(t){(t.s.selected||t.d.selected)&&(t.selected=!0)});var i=[];a.pointData.forEach(function(t){t.selected?(r=!0,t.time&&a.textData.splice(a.textData.indexOf(t.time),1)):i.push(t)});var l=[];a.lineData.forEach(function(t){t.selected||l.push(t)}),r&&a.setUndo(o),a.pointData=i,a.lineData=l,a.onChange(),a.updateData(),a.update()}if(13===t.keyCode){t.preventDefault();var s=S(y(Object(d.a)(Object(d.a)(a)))),c=0;if(a.busStops.some(function(t,e){return!!t.selected&&(c=e+1,!0)}),c>=1&&c<=a.busStops.length){if(t.shiftKey){if(a.busStops.length<=2||c<2)return;x(Object(d.a)(Object(d.a)(a)),c-2),a.setUndo(s)}else g(Object(d.a)(Object(d.a)(a)),c-1),a.setUndo(s);a.onChange(),a.updateData(),a.clearGrid(a.grid),a.clearGrid(a.menu),a.update()}}37===t.keyCode&&t.preventDefault(),39===t.keyCode&&t.preventDefault(),t.metaKey&&90===t.keyCode&&(t.preventDefault(),a.props.readonly||(t.shiftKey?a.doRedo():a.doUndo()))},a.onKeyUp=function(t){a.altKey=t.altKey},a.onMouseLeave=function(t){t.shiftKey&&(a.marky.width=0,a.marky.height=0)},a.onChange=function(){var t=y(Object(d.a)(Object(d.a)(a)));a.props.onChangeData&&a.props.onChangeData(t)},a.setUndo=function(t){a.undoBuffer=a.undoBuffer.slice(0,a.undoPtr),a.undoBuffer.push(t),a.undoPtr++},a.doUndo=function(){if(a.undoPtr>0){a.undoPtr--;var t=a.undoBuffer[a.undoPtr];a.loadData(t),a.props.onChangeData&&a.props.onChangeData(t)}},a.doRedo=function(){if(a.undoBuffer.length>a.undoPtr){var t=a.undoBuffer[a.undoPtr];a.loadData(t),a.props.onChangeData&&a.props.onChangeData(t),a.undoPtr++}},a.resetScreenPosition=function(){var t=a.size(),e=t.width;t.height;a.xScale.domain([0,e*a.timeLineWidth()]).range([0,e]);var n=(e-v)/(24*a.gridScale.x);a.base.call(a.gridZoomBehavior.transform,h.g.translate(a.gridScale.x*(v/a.gridScale.x),0).scale(n)),a.menu.call(a.menuZoomBehavior.transform,h.g.translate(0,0).scale(1))};var r=t.diagramData,l=m(E(r)),s=l.busStops,c=l.lineData,k=l.pointData;return a.state={width:t.width,height:t.height},a.markyData={x:100,y:200,width:200,height:100,color:"rgba(0,0,0,0.1)",visible:!1},a.lineData=c,a.pointData=k,a.busStops=s,a.lineLoopData=[],a.pointLoopData=[],a.textData=[],a.cursorData={x:0,y:0,visible:!0},a.gridScale={x:25,y:25,dy:-4},a.params=Object(u.a)({},t.params),a.undoPtr=0,a.undoBuffer=[],a.altKey=!1,a}return Object(l.a)(e,t),Object(r.a)(e,[{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){}},{key:"componentDidUpdate",value:function(){var t=h.h(this.base.node()),e=h.h(this.menu.node());this.xScale.range([t.applyX(0),t.applyX(this.state.width)]),this.yScale.range([e.applyY(0),e.applyY(this.state.height)]),this.updateData(),this.clearGrid(this.grid),this.clearGrid(this.menu),this.update()}},{key:"componentWillReceiveProps",value:function(t){var e={};this.props.width!=t.width&&(e.width=t.width),this.props.height!=t.height&&(e.height=t.height),this.props.diagramData!=t.diagramData&&this.loadData(t.diagramData),this.setState(e)}},{key:"busStopData",value:function(t){var e=this,a=[],n=this.busStops[t-1].name;this.pointData.forEach(function(t,e){t.idx=e,delete t.mark,delete t.lines}),this.lineData.forEach(function(t){"undefined"===typeof t.s.lines&&(t.s.lines=[]),"undefined"===typeof t.d.lines&&(t.d.lines=[]),t.s.lines.push(t),t.d.lines.push(t)}),this.pointData.forEach(function(e){e.y===t&&a.push(e)});var r=a.map(function(t){var a=[],n=[];if(function t(e,a,n,r){e.mark||(n.y===e.y&&r.push(e),a.push(e),e.mark=!0,e.lines.forEach(function(e){t(e.s,a,n,r),t(e.d,a,n,r)}))}(t,a,t,n),a.length>1){a.sort(function(t,e){return t.y>e.y?1:t.y<e.y?-1:0});var r=a[0],o=a[a.length-1];n.sort(function(t,e){return t.x>e.x?1:t.x<e.x?-1:0});var i=Object(u.a)({},n[n.length-1]);r.x<o.x?(i.dir="down",i.departure=e.busStops[r.y-1],i.arrival=e.busStops[o.y-1]):(i.dir="up",i.departure=e.busStops[o.y-1],i.arrival=e.busStops[r.y-1]),i.x=b(i.x);var l=parseInt(i.x+.5);return i.sec=parseInt(l%60),i.min=parseInt(l/60)%60,i.hour=parseInt(parseInt(l/60)/60),i}return null}).filter(function(t){return null!==t}).sort(function(t,e){return t.x>e.x?1:t.x<e.x?-1:0});return this.pointData.forEach(function(t){delete t.idx,delete t.mark,delete t.lines}),{name:n,times:r}}},{key:"render",value:function(){var t=this;return c.a.createElement("div",{ref:function(e){return t.container=e},style:{display:"inline-block",marign:0,padding:0,width:this.state.width,overflow:"hidden",border:"solid 1px lightgray"},tabIndex:0,focusable:!0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onMouseLeave:this.onMouseLeave},c.a.createElement("svg",{ref:function(e){t.svgElement=e,t.svg=h.e(e)},width:"100%",height:this.state.height,style:{marign:0}},c.a.createElement("g",{ref:function(e){return t.base=h.e(e)}},c.a.createElement("g",{ref:function(e){return t.axis=h.e(e)},style:{visibility:"hidden"}}),c.a.createElement("g",{ref:function(e){return t.grid=h.e(e)}}),c.a.createElement("g",{ref:function(e){return t.line=h.e(e)}}),c.a.createElement("g",{ref:function(e){return t.rect=h.e(e)}}),c.a.createElement("g",{ref:function(e){return t.cursor=h.e(e)}}),c.a.createElement("g",{ref:function(e){return t.text=h.e(e)}}),c.a.createElement("g",{ref:function(e){return t.marky=h.e(e)}})),c.a.createElement("g",{ref:function(e){return t.menu=h.e(e)}})))}},{key:"diagramData",get:function(){var t=y(this);return S(t)}}]),e}(s.Component);k.defaultProps={params:{},readonly:!1};var w=a(103),C=a(100),O=a(101),j=a(105),P=function(t){function e(t){var a;return Object(n.a)(this,e),(a=Object(o.a)(this,Object(i.a)(e).call(this,t))).onClose=function(){a.props.onClose&&a.props.onClose()},a.onEdited=function(){a.props.onEdited&&a.props.onEdited({name:a.state.name})},a.state=Object(u.a)({},t.busStop),a}return Object(l.a)(e,t),Object(r.a)(e,[{key:"componentWillReceiveProps",value:function(t){this.props.busStop!==t.busStop&&this.setState(Object(u.a)({},t.busStop))}},{key:"render",value:function(){for(var t=this,e=[],a=0;a<24;a++)e.push([]);return this.state.data.times&&this.state.data.times.forEach(function(t){e[t.hour].push(t)}),c.a.createElement(w.a,{show:this.props.show,size:"lg",onHide:this.onClose},c.a.createElement(w.a.Header,{closeButton:!0},c.a.createElement(w.a.Title,null,"\u6a19\u67f1\u30c7\u30fc\u30bf")),c.a.createElement(w.a.Body,null,c.a.createElement(C.a,null,c.a.createElement(O.a,{md:12},c.a.createElement("input",{type:"text",style:{width:"100%",marginBottom:10},value:this.state.name,onChange:function(e){t.setState({name:e.target.value})},placeholder:"\u6a19\u67f1\u540d",readOnly:this.props.readonly?"readonly":null}))),c.a.createElement(C.a,null,c.a.createElement(O.a,{md:12},c.a.createElement("table",{style:{width:"100%"}},c.a.createElement("thead",null,c.a.createElement("tr",{key:a,style:{border:"solid 1px lightgray"}},c.a.createElement("th",{width:50},c.a.createElement("span",{style:{margin:10}})),c.a.createElement("th",{style:{borderLeft:"solid 1px lightgray",width:"50%",textAlign:"center"}},c.a.createElement("span",null,"\u4e0a\u308a")),c.a.createElement("th",{style:{borderLeft:"solid 1px lightgray",width:"50%",textAlign:"center"}},c.a.createElement("span",null,"\u4e0b\u308a")))),c.a.createElement("tbody",null,e.map(function(t,e){return c.a.createElement("tr",{key:e,style:{border:"solid 1px lightgray"}},c.a.createElement("td",{width:50},c.a.createElement("span",{style:{margin:10}},("00"+e).slice(-2))),c.a.createElement("td",{style:{borderLeft:"solid 1px lightgray",width:"50%"}},c.a.createElement("span",null,t.filter(function(t){return"up"===t.dir}).map(function(t){return"".concat(t.min)}).join(", "))),c.a.createElement("td",{style:{borderLeft:"solid 1px lightgray",width:"50%"}},c.a.createElement("span",null,t.filter(function(t){return"down"===t.dir}).map(function(t){return"".concat(t.min)}).join(", "))))})))))),c.a.createElement(w.a.Footer,null,c.a.createElement(j.a,{onClick:this.onEdited},"OK")))}}]),e}(s.Component);P.defaultProps={show:!1,busStop:{name:"",data:{}},readonly:!1};var F=a(90),L=a.n(F),A=(a(97),a(98),function(t){function e(t){var a;return Object(n.a)(this,e),(a=Object(o.a)(this,Object(i.a)(e).call(this,t))).onClose=function(){a.props.onClose&&a.props.onClose()},a.onEdited=function(){a.props.onEdited&&a.props.onEdited(a.state.text)},a.onChangeText=function(t){a.setState({text:t})},a.state={text:t.text},a}return Object(l.a)(e,t),Object(r.a)(e,[{key:"componentWillReceiveProps",value:function(t){this.props.text!==t.text&&this.setState({text:null===t.text?"":t.text})}},{key:"render",value:function(){var t=this;return c.a.createElement(w.a,{show:this.props.show,size:"lg",onHide:this.onClose},c.a.createElement(w.a.Header,{closeButton:!0},c.a.createElement(w.a.Title,null,"\u30c0\u30a4\u30a2\u30b0\u30e9\u30e0\u30c7\u30fc\u30bf")),c.a.createElement(w.a.Body,null,c.a.createElement(C.a,null,c.a.createElement(O.a,{md:12},c.a.createElement(L.a,{ref:function(e){return t.editor=e},style:{display:"inline-block",border:"solid 1px lightgray"},mode:"text",theme:"chrome",value:this.state.text,width:"100%",height:"".concat(this.props.height,"px"),onChange:this.onChangeText,showPrintMargin:!1,fontSize:12,name:"digram_data_dialog",editorProps:{$blockScrolling:1/0},readOnly:this.props.readonly})))),c.a.createElement(w.a.Footer,null,c.a.createElement(j.a,{onClick:this.onEdited},"OK")))}}]),e}(s.Component));A.defaultProps={show:!1,name:"",height:100},a.d(e,"default",function(){return B});var K={getItem:function(t,e){var a=localStorage.getItem("".concat("diagram","-").concat(t));return null!==a?JSON.parse(a).data:e},setItem:function(t,e){localStorage.setItem("".concat("diagram","-").concat(t),JSON.stringify({data:e}))}},B=function(t){function e(t){var a;return Object(n.a)(this,e),(a=Object(o.a)(this,Object(i.a)(e).call(this,t))).onResize=function(){a.setState({width:window.innerWidth,height:window.innerHeight},a.update)},a.onEditBusStop=function(t){a.setState({showBusStopDialog:!0,busStop:t})},a.onCloseBusStop=function(){a.setState({showBusStopDialog:!1})},a.onEditedBusStop=function(t){a.state.busStop.name=t.name,a.setState({showBusStopDialog:!1})},a.openDiagramDataDialog=function(){a.setState({showDiagramDataDialog:!0,diagramEditData:a.diagramView.diagramData})},a.onEditedDiagramData=function(t){a.setState({showDiagramDataDialog:!1,diagramData:t})},a.onCloseDiagramData=function(){a.setState({showDiagramDataDialog:!1})},a.onChangeData=function(t){K.setItem("data",a.diagramView.diagramData)},a.onChangeParam=function(t){K.setItem("params",t)},a.resetScreenPosition=function(){a.diagramView.resetScreenPosition()},a.state={showBusStopDialog:!1,busStop:{name:"",data:{}},params:K.getItem("params",{}),width:window.innerWidth,height:window.innerHeight,diagramData:K.getItem("data",""),diagramEditData:""},a}return Object(l.a)(e,t),Object(r.a)(e,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onResize,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResize)}},{key:"render",value:function(){var t=this;return c.a.createElement("div",{style:{overflow:"hidden"}},c.a.createElement("nav",{className:"navbar sticky-top navbar-light bg-light"},c.a.createElement("a",{className:"navbar-brand",href:"#"},"\u30c0\u30a4\u30a2\u30b0\u30e9\u30e0\u30a8\u30c7\u30a3\u30bf"),c.a.createElement("div",null,c.a.createElement("a",{href:"https://docs.google.com/presentation/d/1F0RfbHgcRPHgPSxpe61pBMZ8Yf0WGaXe7XT06Y3AWkk/edit?usp=sharing",target:"manual",className:"btn btn-sm btn-outline-secondary",style:{marginRight:10},role:"button"},"\u4f7f\u3044\u65b9"),c.a.createElement("button",{className:"btn btn-sm btn-outline-secondary",style:{marginRight:10},type:"button",onClick:this.resetScreenPosition},"\u521d\u671f\u4f4d\u7f6e"),c.a.createElement("button",{className:"btn btn-sm btn-outline-secondary",type:"button",onClick:this.openDiagramDataDialog},"\u30c7\u30fc\u30bf"))),c.a.createElement(k,{ref:function(e){return t.diagramView=e},onEditBusStop:this.onEditBusStop,onChangeData:this.onChangeData,onChangeParam:this.onChangeParam,diagramData:this.state.diagramData,params:this.state.params,width:this.state.width-2,height:this.state.height-26-38-10}),c.a.createElement(P,{busStop:this.state.busStop,show:this.state.showBusStopDialog,onClose:this.onCloseBusStop,onEdited:this.onEditedBusStop}),c.a.createElement(A,{show:this.state.showDiagramDataDialog,text:this.state.diagramEditData,onClose:this.onCloseDiagramData,onEdited:this.onEditedDiagramData,height:this.state.height-240}))}}]),e}(s.Component);B.defaultProps={}}}]);
//# sourceMappingURL=1.f467d019.chunk.js.map