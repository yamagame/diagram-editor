{"version":3,"sources":["components/DiagramView/utils.js","components/DiagramView/index.js","components/BusStopDialog/index.js","components/DiagramDataDialog/index.js","components/ConfigDialog/index.js","containers/Diagram/index.js"],"names":["toTime","x","t","parseInt","secd","mint","hour","format","v","concat","slice","makeTimeText","d","update","this","y","text","dx","dy","fontSize","load","_ref","busStops","timeLines","b","split","map","pointData","lineData","forEach","r","idx","pre","q","i","_toXPoint","time","pretime","p","trim","length","oneday","sgn","toXPoint","w","push","s","name","save","_ref2","stops","replace","l","sort","a","index","lines","done","n","check","result","line","up","u","join","insertBusstop","_ref3","pos","splice","deleteBusstop","_ref4","console","log","delPos","delete","reverse","delLine","menuWidth","limit24","limitMin","textDiagramData","parseDiagramText","diagramData","some","indexOf","DiagramView","props","_this","Object","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","size","width","state","height","loadData","_Utils$load","Utils","lineLoopData","pointLoopData","textData","componentDidUpdate","timeLineWidth","gridScale","busLineHeight","makeLine","deleteDoubleLine","selectPoint","_d","selected","deselectPoint","lastSelect","lineKey","key","initialize","_this$size","xScale","d3","domain","range","yScale","dragHandle","on","readOnly","org","cursorData","visible","drawCursor","spindex","altKey","sourceEvent","assertThisInitialized","pointLen","lineLen","onChange","updateData","setUndo","drag","clear","ox","oy","shiftKey","invert","dragMarky","lastSelected","marky","bar","doDrag","markyData","updateMarky","x1","y1","x2","y2","convert","p1","p2","ct","pt","zoomMoved","zoomScale","gridZoomBehavior","scaleExtent","filter","transform","k","onChangeParam","params","gridZoom","applyX","clearGrid","grid","base","svgElement","menuZoomBehavior","menuZoom","applyY","menu","selectAll","data","enter","append","attr","translate","scale","resetScreenPosition","_this$size2","min","max","mark","start24","pp","pw","s0","s1","pointMarge","checkRange","findPoint","rp","objectSpread","_this$size3","exit","remove","classed","style","rect","updateText","deepSelect","updateGrid","gridRectangles","menuRectangles","each","color","rotate","_this$size4","h","hourw","fontColor","idd","drawTimeLine","busStop","rectData","_this$size5","menuw","node","stroke","onEditBusStop","busStopData","cursor","onKeyDown","e","keyCode","preventDefault","selectedBusStop","metaKey","doRedo","doUndo","onKeyUp","onMouseLeave","event","onChangeData","undoBuffer","undoPtr","_this$size6","changeBusStop","_Utils$load2","_this$size7","transformX","transformY","nextProps","setState","stopNo","_this2","times","findLinkedTime","o","fp","ep","dir","departure","arrival","g","sec","_this3","react_default","createElement","ref","container","display","marign","padding","overflow","border","tabIndex","focusable","svg","axis","visibility","Component","defaultProps","BusStopEditDialog","onClose","onEdited","Modal","show","onHide","Header","closeButton","Title","Body","Row","Col","md","type","marginBottom","value","target","placeholder","margin","borderLeft","textAlign","Footer","Button","onClick","DiagramDataDialog","onChangeText","lib_default","editor","mode","theme","showPrintMargin","editorProps","$blockScrolling","Infinity","readonly","ConfigDialog","onSelectHandler","operator","consumerKey","href","Dropdown","Toggle","variant","id","title","Menu","operators","Item","onSelect","active","api","BusTimetableAPI","BusstopPoleAPI","BusroutePatternAPI","AsyncStorage","getItem","defaultValue","localStorage","JSON","parse","setItem","stringify","Diagram","onResize","window","innerWidth","innerHeight","showBusStopDialog","onCloseBusStop","onEditedBusStop","diagramView","openDiagramDataDialog","showDiagramDataDialog","diagramEditData","onEditedDiagramData","onCloseDiagramData","openConfigDialog","showConfigDialog","onCloseConfigDialog","onEditedConfigDialog","busRouteTable","loadOpenData","loadJSON","command","Promise","resolve","fetch","then","response","json","catch","ex","asyncToGenerator","regenerator_default","_callee","BusstopPole","BusroutePattern","BusTimetable","route","pole","matchBusroute","matchBuspole","matchCalendar","poleInfo","busroutes","days","routeTable","table","wrap","_context","prev","next","order","pl","match","abrupt","loading","sent","tm","pattern","Weekday","Saturday","Holiday","br","direction","busroutePattern","keys","calendar","note","reorder","toConsumableArray","selectedRoute","stop","onSelectRoute","addEventListener","removeEventListener","className","Nav","marginRight","role","DiagramView_DiagramView","BusStopDialog_BusStopEditDialog","DiagramDataDialog_DiagramDataDialog","ConfigDialog_ConfigDialog"],"mappings":"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","file":"static/js/1.8e570a57.chunk.js","sourcesContent":["export const oneday = 24*60*60;\n\nexport const abs = v => v > 0 ? v : -v;\nexport const sgn = v => v > 0 ? 1 : -1;\n\nexport const limit24 = (v) => {\n  if (v < 0) v += oneday;\n  return v % oneday;\n}\n\nexport const limitMin = (v) => {\n  if (v < 0) {\n    return parseInt((v-60+30)/60)*60\n  }\n  return parseInt((v+30)/60)*60;\n}\n\nexport const toXPoint = (time, pretime) => {\n  const p = time.trim().split(':');\n  let hour = 0;\n  let mint = 0;\n  let secd = 0;\n  if (p.length > 0) {\n    hour = parseInt(p[0]);\n  }\n  if (p.length > 1) {\n    mint = parseInt(p[1]);\n  }\n  if (p.length > 2) {\n    secd = parseInt(p[2]);\n  }\n  let x = hour*60*60+mint*60+secd;\n  let t = x;\n  if (pretime !== null) {\n    let d = (pretime % oneday) - (x % oneday);\n    if (abs(d) >= oneday/2) {\n      t += sgn(d)*oneday;\n    }\n    if (pretime >= oneday) {\n      t += parseInt(pretime/oneday)*oneday;\n    } else\n    if (pretime < 0) {\n      t += parseInt(pretime/oneday)*oneday;\n    }\n  }\n  return { t, x };\n}\n\nexport const toTime = (x) => {\n  while (x < 0) x += 24*60*60;\n  while (x >= 24*60*60) x -= 24*60*60;\n  let t = parseInt(x+0.5);\n  const secd = parseInt(t % 60);\n  const mint = parseInt(t / 60) % 60;\n  const hour = parseInt(parseInt(t / 60) / 60);\n  const format = (v) => {\n    return `${('00'+v).slice(-2)}`;\n  }\n  if (secd !== 0) {\n    return `${format(hour)}:${format(mint)}:${format(secd)}`;\n  }\n  return `${format(hour)}:${format(mint)}`;\n}\n\nexport const makeTimeText = (d) => {\n  let t = {\n    update: function() {\n      this.x = d.x;\n      this.y = d.y;\n      this.text = toTime(d.x);\n      this.dx = 6;\n      this.dy = 5;\n      this.fontSize = 0.7;\n    }\n  }\n  t.update();\n  return t;\n}\n\nexport const load = ({ busStops, timeLines, }) => {\n  const b = busStops.split('\\n').map( v => v === '-' ? '' : v );\n  const t = timeLines.split('\\n');\n  const pointData = [];\n  const lineData = [];\n  t.forEach( v => {\n    const t = v.split(' ');\n    const r = [];\n    let idx = 0;\n    let pre = null;\n    t.forEach( (q, i) => {\n      if (q !== '-' && q !== '') {\n        const p = q.split('-');\n        p.forEach( v => {\n          const { t, x } = toXPoint(v, pre);\n          const w = { x: t , y: idx+1 };\n          w.time = makeTimeText(w);\n          pointData.push(w);\n          r.push(w)\n          pre = t;\n        })\n      }\n      idx ++;\n    })\n    let s = null;\n    r.forEach( d => {\n      if (s) {\n        lineData.push({ s, d, });\n      }\n      s = d;\n    })\n  })\n  if (b.length < 2) {\n    while (b.length < 2) b.push('');\n  }\n  return {\n    busStops: b.map( v => { return { name: v } } ),\n    pointData,\n    lineData,\n  }\n}\n\nexport const save = ({ busStops, pointData, lineData }) => {\n  const stops = busStops.map( v => {\n    return v.name.trim().replace(/\\s/g, '');\n  });\n  const p = pointData.sort( (a, b) => {\n    if (a.x > b.x) return  1;\n    if (a.x < b.x) return -1;\n    return 0;\n  }).map( (d, i) => {\n    d.index = i;\n    d.lines = [];\n    return d;\n  })\n  const l = lineData.map( v => {\n    if (v.s.x > v.d.x) {\n      const d = v.s;\n      v.s = v.d;\n      v.d = d;\n    }\n    v.done = false;\n    v.s.lines.push(v);\n    v.d.lines.push(v);\n    return v;\n  }).sort( (a, b) => {\n    if (a.s.x > b.s.x) return  1;\n    if (a.s.x < b.s.x) return -1;\n    return 0;\n  })\n\n  let n = 0;\n  const check = (l, i) => {\n    if (l.done) return;\n    l.done = true;\n    if (i < 0) {\n      i = n;\n      n ++;\n    }\n    l.index = i;\n    l.s.lines.forEach( p => {\n      check(p, i);\n    })\n    l.d.lines.forEach( p => {\n      check(p, i);\n    })\n  }\n  l.forEach( (p, i) => {\n    check(p, -1);\n  })\n\n  let result = [];\n  l.sort( (a, b) => {\n    if (a.index > b.index) return  1;\n    if (a.index < b.index) return -1;\n    return 0;\n  }).forEach( l => {\n    if (typeof result[l.index] == 'undefined') {\n      result[l.index] = [];\n    }\n    result[l.index].push(l);\n  })\n\n  let timeLines = [];\n  result.forEach( line => {\n    const l = line.sort( (a, b) => {\n      if (a.s.y > b.s.y) return  1;\n      if (a.s.y < b.s.y) return -1;\n      return 0;\n    })\n    let up = false;\n    if (l[0].s.y < l[0].d.y) up = true;\n    let t = [];\n    let q = null;\n    l.forEach( (p, i) => {\n      if (up) {\n        t.push(p.s)\n      } else {\n        t.push(p.d)\n      }\n      q = p;\n    })\n    if (q) {\n      if (up) {\n        t.push(q.d)\n      } else {\n        t.push(q.s)\n      }\n    }\n    const u = [];\n    stops.forEach( v => {\n      u.push([]);\n    })\n    t.forEach( v => {\n      if (v.y > 0 && v.y <= u.length) {\n        u[v.y-1].push(v);\n      }\n    })\n    timeLines.push(u.map( p => {\n      if (p.length === 0) return '-';\n      let t = '';\n      p.forEach( v => {\n        if (t !== '') t += '-';\n        t += toTime(v.x)\n      })\n      return t;\n    }).join(' '));\n  })\n\n  // console.log(timeLines);\n\n  return {\n    busStops: stops.map( v=> v === '' ? '-' : v ).join('\\n'),\n    timeLines,\n  }\n}\n\nexport const insertBusstop = ({ busStops, pointData, lineData }, pos) => {\n  busStops.splice(pos, 0, { name: '', });\n  pointData.forEach( v => {\n    if (v.y >= pos+1) {\n      v.y += 1;\n    }\n  })\n}\n\nexport const deleteBusstop = ({ busStops, pointData, lineData }, pos) => {\nconsole.log(busStops[pos].name);\n  if (busStops[pos].name !== '') return;\n  busStops.splice(pos, 1);\n  const delPos = [];\n  pointData.forEach( (v, i) => {\n    if (v.y == pos+1) {\n      v.delete = true;\n      delPos.push(i);\n    } else\n    if (v.y > pos+1) {\n      v.y -= 1;\n    }\n  })\n  delPos.reverse().forEach( v => {\n    pointData.splice(v, 1);\n  })\n  const delLine = [];\n  lineData.forEach( (v, i) => {\n    if (v.s.delete || v.d.delete) {\n      delLine.push(i);\n    }\n  })\n  delLine.reverse().forEach( v => {\n    lineData.splice(v, 1);\n  })\n}\n","import React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport * as Utils from './utils';\n\nconst timeUnit = 1000;\nconst menuWidth = 150;\nconst oneday = Utils.oneday;\n\nconst limit24 = (v) => {\n  if (v < 0) v += oneday;\n  return v % oneday;\n}\n\nconst limitMin = (v) => {\n  if (v < 0) {\n    return parseInt((v-60+30)/60)*60\n  }\n  return parseInt((v+30)/60)*60;\n}\n\nconst textDiagramData = (t) => {\n  return `${t.busStops.split('\\n').join(' ')}\\n${t.timeLines.join('\\n')}\\n`;\n}\n\nconst parseDiagramText = (diagramData) => {\n  const t = diagramData.split('\\n');\n  let busStops = null;\n  let timeLines = null;\n  t.some( (s, i) => {\n    if (s.indexOf('/') == 0) return false;\n    if (busStops === null) {\n      busStops = s;\n      return false;\n    }\n    if (timeLines === null) {\n      timeLines = i;\n    }\n    return true;\n  })\n  return {\n    busStops: busStops !== null ? busStops.split(' ').join('\\n') : '',\n    timeLines: timeLines !== null ? t.slice(timeLines).join('\\n') : '',\n  }\n}\n\nexport default class DiagramView extends Component {\n  constructor(props) {\n    super(props);\n    const { diagramData } = props;\n    const {\n      busStops,\n      lineData,\n      pointData,\n    } = Utils.load(parseDiagramText(diagramData));\n    this.state = {\n      width: props.width,\n      height: props.height,\n    }\n    this.markyData = {\n      x: 100, y: 200, width: 200, height: 100, color: 'rgba(0,0,0,0.1)', visible: false,\n    }\n    this.lineData = lineData;\n    this.pointData = pointData;\n    this.busStops = busStops;\n    this.lineLoopData = [];\n    this.pointLoopData = [];\n    this.textData = [];\n    this.cursorData = {\n      x: 0, y: 0, visible: true,\n    }\n    this.gridScale = {\n      x: 25,\n      y: 25,\n      dy: -4,\n    }\n    this.params = { ...props.params };\n    this.undoPtr = 0;\n    this.undoBuffer = [];\n    this.altKey = false;\n  }\n\n  componentDidMount() {\n    this.initialize();\n  }\n  \n  componentWillUnmount() {\n  }\n\n  componentDidUpdate() {\n    const { width, height } = this.size();\n    const transformX = d3.zoomTransform(this.base.node());\n    const transformY = d3.zoomTransform(this.menu.node());\n    this.xScale.domain([0, width*this.timeLineWidth()]).range([transformX.applyX(0), transformX.applyX(width)]);\n    this.yScale.domain([this.gridScale.dy, height*this.busLineHeight()+this.gridScale.dy]).range([transformY.applyY(0), transformY.applyY(height)]);\n    this.updateData()\n    this.clearGrid(this.grid);\n    this.clearGrid(this.menu);\n    this.update();\n  }\n\n  componentWillReceiveProps(nextProps) {\n    let state = {}\n    if (this.props.width != nextProps.width) {\n      state.width = nextProps.width;\n    }\n    if (this.props.height != nextProps.height) {\n      state.height = nextProps.height;\n    }\n    if (this.props.diagramData != nextProps.diagramData) {\n      this.loadData(nextProps.diagramData);\n    }\n    this.setState(state);\n  }\n\n  size = () => {\n    return {\n      width: this.state.width,\n      height: this.state.height,\n    }\n  }\n\n  loadData = (diagramData) => {\n    const {\n      busStops,\n      lineData,\n      pointData,\n    } = Utils.load(parseDiagramText(diagramData));\n    this.lineData = lineData;\n    this.pointData = pointData;\n    this.busStops = busStops;\n    this.lineLoopData = [];\n    this.pointLoopData = [];\n    this.textData = [];\n    this.componentDidUpdate();\n  }\n\n  timeLineWidth = () => {\n    return 60*60/this.gridScale.x;\n  }\n\n  busLineHeight = () => {\n    return 1/this.gridScale.y;\n  }\n\n  makeLine = (s, d) => {\n    this.lineData.push({\n      s: s,\n      d: d,\n    })\n    this.deleteDoubleLine();\n  }\n\n  selectPoint = (_d) => {\n    _d.selected = true;\n  }\n\n  deselectPoint = (_d) => {\n    delete _d.selected;\n    delete _d.lastSelect;\n  }\n\n  deleteDoubleLine = () => {\n    const lineKey = {};\n    const lineData = [];\n    this.pointData.forEach( (d, i) => {\n      d.index = i;\n    })\n    this.lineData.forEach( d => {\n      let key = `${d.d.index}-${d.s.index}`;\n      if (d.s.index < d.d.index) {\n        key = `${d.s.index}-${d.d.index}`;\n      }\n      if (typeof lineKey[key] === 'undefined') {\n        lineData.push(d);\n        lineKey[key] = d;\n      }\n    })\n    this.lineData = lineData;\n  }\n\n  initialize = () => {\n    const { width, height } = this.size();\n\n    this.xScale = d3.scaleLinear()\n      .domain([0, width*this.timeLineWidth()])\n      .range([0, width]);\n\n    this.yScale = d3.scaleLinear()\n      .domain([this.gridScale.dy, height*this.busLineHeight()+this.gridScale.dy])\n      .range([0, height]);\n\n    //\n    this.dragHandle = d3.drag()\n      .on('start', (_d, i) => {\n        if (!this.props.readOnly) {\n          const d = _d.org;\n          this.cursorData.visible = false;\n          this.drawCursor();\n          let s = null;\n          let spindex = 0;\n          this.pointData.some( (d, i) => {\n            if (d.selected && d.lastSelect) {\n              s = d;\n              spindex = i;\n              return true;\n            }\n            return false;\n          })\n          this.altKey = d3.event.sourceEvent.altKey;\n          if (d3.event.sourceEvent.altKey && s !== null && spindex !== i) {\n            //\n            const b = textDiagramData(Utils.save(this));\n            const pointLen = this.pointData.length;\n            const lineLen = this.lineData.length;\n            this.pointData.forEach( d => {\n              delete d.lastSelect;\n            })\n            d.lastSelect = true;\n            this.selectPoint(d);\n            const ended = (_d, i) => {\n              const d = _d.org;\n              this.makeLine(s, d);\n              this.onChange();\n              this.updateData();\n              this.update();\n              if (this.pointData.length != pointLen || this.lineData.length != lineLen) {\n                this.setUndo(b);\n              }\n            }\n            d3.event.on(\"end\", ended);\n          } else {\n            //\n            const b = textDiagramData(Utils.save(this));\n            let drag = false;\n            let clear = false;\n            if (!d.selected) {\n              clear = true;\n            }\n            this.pointData.forEach( d => {\n              delete d.lastSelect;\n            })\n            d.lastSelect = true;\n            this.selectPoint(d);\n            this.pointData.forEach( d => {\n              if (d.selected) {\n                d.ox = this.xScale(d.x);\n                d.oy = this.yScale(d.y);\n              }\n            })\n            const dragged = (_d) => {\n              const d = _d.org;\n              drag = true;\n              if (!d3.event.sourceEvent.shiftKey && clear) {\n                this.pointData.forEach( d => {\n                  this.deselectPoint(d);\n                })\n                this.lineData.forEach( d => {\n                  delete d.selected;\n                })\n                this.selectPoint(d);\n              }\n              this.pointData.forEach( d => {\n                if (d.selected) {\n                  d.ox += d3.event.dx;\n                  d.oy += d3.event.dy;\n                  d.x = limitMin(this.xScale.invert(d.ox));\n                  //d.y = this.yScale.invert(d.oy);\n                }\n              })\n              this.update();\n            }\n            const ended = (_d, i) => {\n              const d = _d.org;\n              if (!drag) {\n                if (!d3.event.sourceEvent.shiftKey && clear) {\n                  this.pointData.forEach( d => {\n                    this.deselectPoint(d);\n                  })\n                  this.lineData.forEach( d => {\n                    delete d.selected;\n                  })\n                  this.selectPoint(d);\n                  d.lastSelect = true;\n                }\n              } else {\n                this.setUndo(b);\n              }\n              this.pointData.forEach( d => {\n                delete d.ox;\n                delete d.oy;\n              })\n              this.onChange();\n              this.update();\n            }\n            d3.event.on(\"drag\", dragged).on(\"end\", ended);\n          }\n        }\n      })\n\n    this.dragMarky = d3.drag()\n      .on('start', (d, i) => {\n        this.cursorData.visible = false;\n        this.drawCursor();\n        this.altKey = d3.event.sourceEvent.altKey;\n        //\n        if (d3.event.sourceEvent.altKey) {\n          if (!this.props.readOnly) {\n            const b = textDiagramData(Utils.save(this));\n\n            let lastSelected = null;\n            let spindex = 0;\n            this.pointData.some( (d, i) => {\n              if (d.selected && d.lastSelect) {\n                lastSelected = d;\n                spindex = i;\n                return true;\n              }\n              return false;\n            })\n\n            this.pointData.forEach( d => {\n              delete d.lastSelect;\n            })\n\n            const p = {\n              x: this.cursorData.x,\n              y: this.cursorData.y,\n              selected: true,\n              lastSelect: true,\n            }\n            this.selectPoint(p);\n            this.pointData.push(p)\n\n            if (lastSelected) {\n              this.makeLine(lastSelected, p);\n            }\n\n            this.onChange();\n            this.updateData();\n            this.update();\n            this.cursorData.visible = false;\n            this.drawCursor();\n\n            this.setUndo(b);\n          }\n        }\n        //\n        if (d3.event.sourceEvent.shiftKey) {\n          const marky = this.marky;\n          const bar = d3.select(this.bar);\n          let doDrag = false;\n          let x = d3.event.x;\n          let y = d3.event.y;\n          this.markyData.x = x;\n          this.markyData.y = y;\n          this.markyData.width  = 0;\n          this.markyData.height = 0;\n          const dragged = (d) => {\n            if (!doDrag) {\n              x = d3.event.x;\n              y = d3.event.y;\n              this.markyData.x = x;\n              this.markyData.y = y;\n              this.markyData.width  = 0;\n              this.markyData.height = 0;\n              doDrag = true;\n            }\n            x += d3.event.dx;\n            y += d3.event.dy;\n            this.markyData.width  = x-this.markyData.x;\n            this.markyData.height = y-this.markyData.y;\n            this.markyData.visible = true;\n            this.updateMarky();\n          }\n          const ended = () => {\n            this.markyData.visible = false;\n            this.updateMarky();\n\n            let x1 = this.markyData.x;\n            let y1 = this.markyData.y;\n            let x2 = this.markyData.x+this.markyData.width;\n            let y2 = this.markyData.y+this.markyData.height;\n            let t;\n\n            t = x1;\n            if (x2 < x1) {\n              x1 = x2;\n              x2 = t;\n            }\n            t = y1;\n            if (y2 < y1) {\n              y1 = y2;\n              y2 = t;\n            }\n\n            const convert = (p) => {\n              return [this.xScale.invert(p[0]), this.yScale.invert(p[1])];\n            }\n\n            const p1 = convert([x1, y1]);\n            const p2 = convert([x2, y2]);\n\n            this.pointLoopData.forEach( d => {\n              if (d3.event.sourceEvent.shiftKey && d.org.selected) {\n                return true;\n              }\n              const selected = (p1[0] <= d.x && d.x <= p2[0] && p1[1] <= d.y && d.y <= p2[1]);\n              if (selected) {\n                this.selectPoint(d.org);\n              } else {\n                this.deselectPoint(d.org);\n              }\n            })\n            let ct = 0;\n            let pt = null;\n            this.pointData.forEach( d => {\n              if (d.selected) {\n                ct ++;\n                pt = d;\n              }\n            })\n            if (ct === 1) {\n              pt.lastSelect = true;\n            }\n\n            this.update();\n          }\n          d3.event.on(\"drag\", dragged).on(\"end\", ended);\n        }\n      })\n\n    let zoomMoved = 0;\n    let zoomScale = null;\n\n    this.gridZoomBehavior = d3.zoom()\n      .scaleExtent([0.8, 160])\n      .filter(() => {\n        this.altKey = d3.event.altKey;\n        return (!d3.event.shiftKey && !d3.event.altKey);\n      })\n      .on('start', () => {\n        zoomMoved = 0;\n        zoomScale = d3.event.transform.k;\n      })\n      .on('zoom', () => {\n        zoomMoved ++;\n        if (zoomScale !== d3.event.transform.k) {\n          zoomMoved += 10;\n        }\n        const transform = d3.event.transform;\n        if (this.props.onChangeParam) {\n          this.params.gridZoom = transform;\n          this.props.onChangeParam(this.params);\n        }\n        this.xScale.range([transform.applyX(0), transform.applyX(this.state.width)]);\n        this.clearGrid(this.grid);\n        this.updateData();\n        this.update();\n        this.cursorData.visible = false;\n        this.drawCursor();\n      })\n      .on('end', () => {\n        if (zoomMoved < 5) {\n          this.pointData.forEach( v => {\n            this.deselectPoint(v);\n          })\n          this.lineData.forEach( v => {\n            delete v.selected;\n            delete v.lastSelect;\n          })\n          this.update();\n        }\n      })\n    \n    this.base\n      .call(this.gridZoomBehavior)\n      .on('dblclick.zoom', null)\n      .call(this.dragMarky)\n      .on(\"mouseleave\", () => {\n        this.cursorData.visible = false;\n        this.drawCursor();\n      })\n      .on(\"mousemove\", () => {\n        const p = d3.mouse(this.svgElement);\n        this.cursorData.x = limitMin(this.xScale.invert(p[0]));\n        this.cursorData.y = parseInt(this.yScale.invert(p[1])+0.5);\n        this.cursorData.visible = true;\n        this.drawCursor();\n      })\n\n    this.menuZoomBehavior = d3.zoom()\n      .scaleExtent([0.8, 5])\n      .filter(() => {\n        this.altKey = d3.event.altKey;\n        return (!d3.event.shiftKey && !d3.event.altKey);\n      })\n      .on('start', () => {\n        zoomMoved = 0;\n        zoomScale = d3.event.transform.k;\n      })\n      .on('zoom', () => {\n        zoomMoved ++;\n        if (zoomScale !== d3.event.transform.k) {\n          zoomMoved += 10;\n        }\n        const transform = d3.event.transform;\n        if (this.props.onChangeParam) {\n          this.params.menuZoom = transform;\n          this.props.onChangeParam(this.params);\n        }\n        this.yScale.range([transform.applyY(0), transform.applyY(this.state.height)]);\n        this.clearGrid(this.grid);\n        this.clearGrid(this.menu);\n        this.update();\n        this.cursorData.visible = false;\n        this.drawCursor();\n      })\n      .on('end', () => {\n        if (zoomMoved < 5) {\n          this.update();\n        }\n      })\n\n    this.menu\n      .call(this.menuZoomBehavior)\n      .on('dblclick.zoom', null)\n\n    this.updateData();\n\n    const marky = this.marky;\n    marky\n      .selectAll('rect')\n      .data([this.markyData])\n      .enter()\n      .append('rect')\n      .attr('class', 'marky')\n      .attr('visibility', 'hidden')\n      .attr('stroke', 'none')\n      .attr('stroke-width', 2)\n\n    if (this.params.gridZoom) {\n      const t = this.params.gridZoom;\n      this.base\n        .call(this.gridZoomBehavior.transform, d3.zoomIdentity.translate(t.x, 0).scale(t.k));\n    } else {\n      this.resetScreenPosition();\n    }\n    if (this.params.menuZoom) {\n      const t = this.params.menuZoom;\n      this.menu\n        .call(this.menuZoomBehavior.transform, d3.zoomIdentity.translate(0, t.y).scale(t.k));\n    }\n\n    this.update();\n  }\n\n  updateData = () => {\n    const { width, height } = this.size();\n\n    //\n    {\n      const convert = (p) => {\n        return [this.xScale.invert(p[0]), this.yScale.invert(p[1])];\n      }\n      const p1 = convert([0, 0]);\n      const w = this.xScale.invert(width)-this.xScale.invert(0);\n\n      let min = oneday;\n      let max = 0;\n\n      this.pointData.forEach( (p, i) => {\n        p.i = i;\n        delete p.mark;\n        if (!p.time) {\n          p.time = Utils.makeTimeText(p);\n        }\n        if (min > p.x) min = p.x;\n        if (max < p.x) max = p.x;\n      })\n\n      min = (min < 0) ? (parseInt(min/oneday)-1) : parseInt(min/oneday);\n      max = (max < 0) ? (parseInt(max/oneday)-1) : parseInt(max/oneday);\n\n      //\n      const start24 = (v) => {\n        if (v < 0) v = (parseInt(v / oneday)-1)*oneday;\n        return parseInt(v / oneday)*oneday;\n      }\n      const pp = start24(p1[0])-max*oneday;\n      const pw = (parseInt(w/oneday)+2)*oneday-min*oneday+max*oneday;\n\n      const s0 = p1[0];\n      const s1 = s0+w;\n      const a0 = limit24(s0);\n      const a1 = limit24(s1);\n      const as = start24(s0) === start24(s1);\n\n      this.pointLoopData = [];\n      this.lineLoopData = [];\n      const pointMarge = {};\n\n      const checkRange = (x, i) => {\n        return (x+i >= s0 && x+i <= s1);\n      }\n\n      const findPoint = (idx, p, dx) => {\n        let rp = null;\n        if (typeof pointMarge[idx] === 'undefined') {\n          pointMarge[idx] = {};\n        }\n        rp = pointMarge[idx][p.i];\n        if (rp) return rp;\n        rp = { ...p };\n        rp.dx = dx;\n        rp.x = p.x+rp.dx;\n        rp.org = p;\n        delete rp.time;\n        pointMarge[idx][p.i] = rp;\n        this.pointLoopData.push(rp);\n        return rp;\n      }\n\n      this.lineData.forEach( (p, i) => {\n        for (var i=pp;i<pp+pw;i+=oneday) {\n          if (checkRange(p.s.x, i) || checkRange(p.d.x, i)) {\n            p.s.mark = true;\n            p.d.mark = true;\n            const s = findPoint(i, p.s, i);\n            const d = findPoint(i, p.d, i);\n            const l = { ...p };\n            l.org = p;\n            l.i = i;\n            l.s = s;\n            l.d = d;\n            this.lineLoopData.push(l);\n          }\n        }\n      })\n\n      this.pointData.forEach( p => {\n        if (!p.mark) {\n          for (var i=pp;i<pp+pw;i+=oneday) {\n            if (checkRange(p.x, i)) {\n              findPoint(i, p, i);\n            }\n          }\n        }\n        delete p.mark;\n      })\n    }\n  }\n\n  update = () => {\n    const self = this;\n    const { width, height } = this.size();\n\n    this.textData = [];\n    this.pointLoopData.forEach( (p, i) => {\n      p.x = p.org.x+p.dx;\n      if (p.org.selected) {\n        if (!p.time) {\n          p.time = Utils.makeTimeText(p);\n        }\n        this.textData.push(p.time)\n      }\n    })\n\n    this.line.selectAll('line.link')\n      .data(this.lineLoopData)\n      .exit()\n      .remove()\n\n    this.line.selectAll('line.link')\n      .data(this.lineLoopData)\n      .enter()\n      .append('line')\n      .classed('link', true)\n      .attr('fill', 'none')\n      .style(\"pointer-events\", \"none\")\n      .attr('stroke-width', 1)\n\n    this.line.selectAll('line.selection')\n      .data(this.lineLoopData)\n      .exit()\n      .remove()\n\n    this.line.selectAll('line.selection')\n      .data(this.lineLoopData)\n      .enter()\n      .append('line')\n      .classed('selection', true)\n      .attr('fill', 'none')\n      .attr('stroke', 'rgb(0,0,0,0)')\n      .attr('stroke-width', 6)\n\n    this.rect.selectAll('rect.link')\n      .data(this.pointLoopData)\n      .exit()\n      .remove()\n\n    this.rect.selectAll('rect.link')\n      .data(this.pointLoopData)\n      .enter()\n      .append('rect')\n      .classed('link', true)\n      .attr('fill', 'rgba(0,0,0,0)')\n      .call(this.dragHandle)\n      .on('dblclick',(d, i) => {\n        console.log(`dbl ${i}`);\n      })\n      .on('mouseover', (_d, i) => {\n        const d = _d.org;\n        if (!d.selected) {\n          if (!_d.time) {\n            _d.time = Utils.makeTimeText(_d);\n          }\n          if (_d.time) {\n            if (this.textData.indexOf(_d.time) < 0) {\n              this.textData.push(_d.time)\n            }\n          }\n          this.updateText();\n        }\n      })\n      .on('mouseout', (_d, i) => {\n        const d = _d.org;\n        if (!d.selected) {\n          if (_d.time) {\n            this.textData.splice(this.textData.indexOf(_d.time),1);\n          }\n          this.updateText();\n        }\n      })\n\n    this.line.selectAll('line.link')\n      .attr('x1', d => this.xScale(d.s.x))\n      .attr('y1', d => this.yScale(d.s.y))\n      .attr('x2', d => this.xScale(d.d.x))\n      .attr('y2', d => this.yScale(d.d.y))\n      .attr('stroke', d => d.org.selected ? '#F00' : '#999')\n\n    this.line.selectAll('line.selection')\n      .attr('x1', d => this.xScale(d.s.x))\n      .attr('y1', d => this.yScale(d.s.y))\n      .attr('x2', d => this.xScale(d.d.x))\n      .attr('y2', d => this.yScale(d.d.y))\n      .on('click', (_d, i) => {\n        const d = _d.org;\n        if (!d3.event.shiftKey) {\n          this.pointData.forEach( d => {\n            this.deselectPoint(d);\n          })\n          this.lineData.forEach( d => {\n            delete d.selected;\n          })\n        } else {\n          if (d.selected) {\n            this.lineData.forEach( l => {\n              if (!l.s.lines) l.s.lines = [];\n              if (!l.d.lines) l.d.lines = [];\n              l.s.lines.push(l);\n              l.d.lines.push(l);\n            })\n            const deepSelect = (l) => {\n              if (!l.selected) {\n                l.selected = true;\n                this.selectPoint(l.s);\n                this.selectPoint(l.d);\n                l.s.lines.forEach( l => {\n                  deepSelect(l);\n                })\n                l.d.lines.forEach( l => {\n                  deepSelect(l);\n                })\n              }\n            }\n            delete d.selected;\n            deepSelect(d);\n            this.pointData.forEach( p => {\n              delete p.lines;\n            })\n          }\n        }\n        d.selected = true;\n        this.update();\n      })\n\n    this.rect.selectAll('rect.link')\n      .attr('x', d => this.xScale(d.x)-4)\n      .attr('y', d => this.yScale(d.y)-4)\n      .attr('width', 8)\n      .attr('height', 8)\n      .attr('fill', d => d.org.lastSelect ? '#FF0000' : '#00000000')\n      .attr('stroke', d => d.org.selected ? ( d.org.lastSelect ? '#FF0000' : '#FFA000') : '#999')\n      .attr('stroke-width', 1)\n\n    this.updateGrid(this.grid, this.gridRectangles());\n    this.updateGrid(this.menu, this.menuRectangles());\n\n    this.updateText();\n  }\n\n  updateText = () => {\n    this.text.selectAll('text')\n      .data(this.textData)\n      .exit()\n      .remove()\n\n    this.text.selectAll('text')\n      .data(this.textData)\n      .enter()\n      .append('text')\n      .style(\"pointer-events\", \"none\")\n\n    this.text.selectAll('text')\n      .each( (d, i) => {\n        if (d.update) d.update();\n      })\n      .attr('fill', (d) => d.color ? d.color : 'black')\n      .attr('font-size', d => 18*d.fontSize)\n      .attr('x', d => this.xScale(d.x)+d.dx)\n      .attr('y', d => this.yScale(d.y)+d.dy)\n      .attr('transform',d => d.rotate ? `rotate(${d.rotate},${this.xScale(d.x)},${this.yScale(d.y)})` : '')\n      .text(d => d.text )\n  }\n\n  updateMarky = () => {\n    const marky = this.marky;\n    marky\n      .selectAll('rect')\n      .attr('visibility', d => d.visible ? 'visible' : 'hidden')\n      .attr('fill', (d) => d.color ? d.color : 'none')\n      .attr('x', d => d.width >= 0 ? d.x : d.x+d.width)\n      .attr('y', d => d.height >= 0 ? d.y : d.y+d.height)\n      .attr('width', d => d.width >= 0 ?  d.width : -d.width)\n      .attr('height', d => d.height >= 0 ?  d.height : -d.height)\n  }\n\n  gridRectangles = () => {\n    const { width, height } = this.size();\n    const convert = (p) => {\n      return [this.xScale.invert(p[0]), this.yScale.invert(p[1])];\n    }\n    const p1 = convert([0, 0]);\n    const w = this.xScale.invert(width )-this.xScale.invert(0);\n    const h = this.yScale.invert(height)-this.yScale.invert(0);\n    const hourw = this.xScale(60*60)-this.xScale(0);\n\n    //\n    const r = [];\n    //\n    const l = [];\n    //\n    const t = [];\n\n    r.push({\n      color: '#00000000',\n      x: p1[0],\n      y: p1[1],\n      width: w,\n      height: h,\n    })\n\n    //------------------------------------------------------------------\n\n    const drawTimeLine = (size) => {\n      for (var i=0;i<w+size*4;i+=size) {\n        const x1 = i+p1[0]-(p1[0]%(size*2))-size*2;\n        const y1 = p1[1];\n        let idx = parseInt(x1+(x1 > 0 ? 0.5 : -0.5));\n        let color = null;\n        let text = null;\n        let width = 1;\n        let fontSize = 0.85;\n        let fontColor = '#808080';\n        let idd = idx;\n        if (idx < 0) idx = -(oneday+idx);\n        if ((idx % oneday) == 0) {\n          width = 4;\n          if (idd === 0 || idd === oneday) {\n            color = '#A0A0FF';\n          } else {\n            color = '#E0E0E0';\n          }\n          text = Utils.toTime(x1);\n          fontSize = 1;\n          fontColor = '#404040';\n          if (x1 < 0 || x1 >= 24*60*60) {\n            fontColor = '#A0A0A0';\n          }\n        } else\n        if ((idx % (60*60)) == 0) {\n          width = 2;\n          color = '#A0FFFF';\n          text = Utils.toTime(x1);\n          fontSize = 1;\n          fontColor = '#404040';\n          if (x1 < 0 || x1 >= 24*60*60) {\n            fontColor = '#A0A0A0';\n          }\n        } else\n        if ((idx % (30*60)) == 0) {\n          color = '#A0FFFF';\n          if (hourw/(this.gridScale.x+5) >= 2) {\n            text = Utils.toTime(x1);\n          }\n        } else\n        if ((idx % (15*60)) == 0 && hourw/(this.gridScale.x+5) >= 2) {\n          color = '#E0FFFF';\n          if (hourw/(this.gridScale.x+5) >= 4) {\n            text = Utils.toTime(x1);\n          }\n        } else\n        if ((idx % ( 5*60)) == 0 && hourw/(this.gridScale.x+5) >= 4) {\n          color = '#E0FFFF';\n          if (hourw/(this.gridScale.x+5) >= 12) {\n            text = Utils.toTime(x1);\n          }\n        } else\n        if ((idx % (   60)) == 0 && hourw/(this.gridScale.x+5) >= 12) {\n          color = '#E0FFFF';\n          if (hourw/(this.gridScale.x+5) >= 60) {\n            text = Utils.toTime(x1).slice(-2);\n          }\n        }\n        if (color) {\n          l.push({\n            x1: this.xScale(x1),\n            y1: this.yScale(y1),\n            x2: this.xScale(x1),\n            y2: this.yScale(y1+h),\n            color,\n            width,\n          });\n          if (text) {\n            t.push({\n              x: x1,\n              y: y1,\n              dx: 4,\n              dy: -3,\n              rotate: 90,\n              name: text,\n              color: fontColor,\n              fontSize,\n            })\n          }\n        }\n      }\n    }\n    drawTimeLine(60);\n\n    //------------------------------------------------------------------\n\n    {\n      const size = 1;\n      for (var i=0;i<h+size*4;i+=size) {\n        const x1 = p1[0];\n        const y1 = parseInt(i+p1[1]-(p1[1]%(size*2))-size*2+0.5);\n        if (y1 >= 1 && y1 <= this.busStops.length) {\n          const busStop = this.busStops[y1-1];\n          const q = {\n            x1: this.xScale(x1),\n            y1: this.yScale(y1),\n            x2: this.xScale(x1+w),\n            y2: this.yScale(y1),\n            color: '#80FFFF',\n            width: 1,\n            //stroke: '2,2',\n          }\n          if (busStop.selected) {\n            q.color = 'red';\n          }\n          l.push(q);\n        }\n      }\n    }\n\n    return {\n      rectData: r,\n      lineData: l,\n      textData: t,\n    };\n  }\n\n  menuRectangles = () => {\n    const { width, height } = this.size();\n    const convert = (p) => {\n      return [this.xScale.invert(p[0]), this.yScale.invert(p[1])];\n    }\n    const p1 = convert([0, 0]);\n    const w = this.xScale.invert(width )-this.xScale.invert(0);\n    const h = this.yScale.invert(height)-this.yScale.invert(0);\n    const menuw = this.xScale.invert(menuWidth)-this.xScale.invert(0);\n\n    //\n    const r = [];\n    //\n    const l = [];\n    //\n    const t = [];\n\n    r.push({\n      color: '#F8F8F8D0',\n      x: p1[0],\n      y: p1[1],\n      width: menuw,\n      height: h,\n    })\n\n    l.push({\n      color: '#D0D0D0',\n      x1: menuWidth,\n      y1: 0,\n      x2: menuWidth,\n      y2: height,\n      width: 1,\n    })\n\n    //------------------------------------------------------------------\n\n    {\n      const size = 1;\n      for (var i=0;i<h+size*4;i+=size) {\n        const x1 = p1[0];\n        const y1 = parseInt(i+p1[1]-(p1[1]%(size*2))-size*2+0.5);\n        if (y1 >= 1 && y1 <= this.busStops.length) {\n          const busStop = this.busStops[y1-1];\n          const q = {\n            x1: this.xScale(x1),\n            y1: this.yScale(y1),\n            x2: this.xScale(x1+menuw),\n            y2: this.yScale(y1),\n            color: '#80FFFF',\n            width: 1,\n            //stroke: '2,2',\n          }\n          if (busStop.selected) {\n            q.color = 'red';\n          }\n          l.push(q);\n          const s = {\n            x: x1,\n            y: y1,\n            dx: 4,\n            dy: -4,\n            name: busStop.name,\n            color: '#404040',\n            index: y1,\n            fontSize: 1,\n          }\n          if (busStop.selected) {\n            s.color = 'red';\n          }\n          t.push(s);\n        }\n      }\n    }\n\n    return {\n      rectData: r,\n      lineData: l,\n      textData: t,\n    };\n  }\n\n  clearGrid = (node) => {\n    node\n      .selectAll('line.stops')\n      .remove();\n\n    node\n      .selectAll('text.stops')\n      .remove();\n\n    node\n      .selectAll('rect.stops')\n      .remove();\n  }\n\n  updateGrid = (node, { rectData, lineData, textData, }) => {\n    node\n      .selectAll('rect.stops')\n      .data(rectData)\n      .exit()\n      .remove()\n    node\n      .selectAll('rect.stops')\n      .data(rectData)\n      .enter()\n      .append('rect')\n      .classed('stops', true)\n      //.style(\"pointer-events\", \"none\")\n      .attr('stroke', 'none')\n      .attr('stroke-width', 2)\n      .attr('fill', (d) => d.color ? d.color : 'none')\n      .attr('x', d => this.xScale(d.x))\n      .attr('y', d => this.yScale(d.y))\n      .attr('width', d => this.xScale(d.width)-this.xScale(0))\n      .attr('height', d => this.yScale(d.height)-this.yScale(0))\n    node\n      .selectAll('line.stops')\n      .data(lineData)\n      .exit()\n      .remove()\n    node\n      .selectAll('line.stops')\n      .data(lineData)\n      .enter()\n      .append('line')\n      .classed('stops', true)\n      .attr('fill', 'rgba(0,0,0,0)')\n      .attr('stroke', (d) => d.color ? d.color : 'none')\n      .attr('stroke-width', d => d.width)\n      .attr('stroke-dasharray', (d) => d.stroke ? d.stroke : 'none')\n      .attr('x1', d => d.x1)\n      .attr('y1', d => d.y1)\n      .attr('x2', d => d.x2)\n      .attr('y2', d => d.y2)\n      .on('click', function(d, i) {\n        //console.log('click 1');\n      })\n      .on('mouseover', function(d, i) {\n        //console.log('mouseover');\n      })\n    node\n      .selectAll('text.stops')\n      .data(textData)\n      .exit()\n      .remove()\n    node\n      .selectAll('text.stops')\n      .data(textData)\n      .enter()\n      .append('text')\n      .classed('stops', true)\n      .attr('fill', (d) => d.color ? d.color : 'black')\n      .attr('font-size', d => 13*d.fontSize)\n      .attr('x', d => this.xScale(d.x)+d.dx)\n      .attr('y', d => this.yScale(d.y)+d.dy)\n      .attr('text-anchor', 'start')\n      .attr('transform',d => d.rotate ? `rotate(${d.rotate},${this.xScale(d.x)},${this.yScale(d.y)})` : '')\n      .text(d => d.name == '' ? '' : d.name )\n      .on('dblclick', (d, i) => {\n      })\n      .on('click', (d, i) => {\n        if (typeof d.index !== 'undefined') {\n          const busStop = this.busStops[d.index-1];\n          if (busStop.selected) {\n            const busStop = this.busStops[d.index-1];\n            if (this.props.onEditBusStop) {\n              this.props.onEditBusStop({\n                name: busStop.name,\n                data: this.busStopData(d.index),\n                index: d.index,\n              });\n            }\n          } else {\n            this.busStops.forEach( b => {\n              delete b.selected;\n            })\n            busStop.selected = true;\n            this.clearGrid(this.grid);\n            this.clearGrid(this.menu);\n            this.updateGrid(this.grid, this.gridRectangles());\n            this.updateGrid(this.menu, this.menuRectangles());\n          }\n        }\n      })\n      .on('mouseover', function(d, i) {\n        if (typeof d.index !== 'undefined') {\n          //console.log(`mouseover stop ${d.index}`);\n        }\n      })\n  }\n\n  drawCursor = () => {\n    if (!this.props.readOnly) {\n      this.cursor.selectAll('rect').remove();\n      this.cursor.append('rect')\n        .attr('fill', 'none')\n        .attr('x', this.xScale(this.cursorData.x)-4)\n        .attr('y', this.yScale(this.cursorData.y)-4)\n        .attr('visibility', (this.cursorData.visible && this.altKey) ? 'visible' : 'hidden')\n        .attr('width', 8)\n        .attr('height', 8)\n        .attr('stroke-width', 1)\n        .attr('stroke', '#999')\n        .on('click', function(d, i) {\n          //console.log('click ?');\n        })\n    }\n  }\n\n  onKeyDown = (e) => {\n    this.altKey = e.altKey;\n    // //space key\n    // if(e.keyCode === 32) {\n    //   e.preventDefault();\n    //   if (!this.props.readOnly) {\n    //     const b = textDiagramData(Utils.save(this));\n    //     this.pointData.forEach( d => {\n    //       delete d.lastSelect;\n    //     })\n    //     const p = {\n    //       x: this.cursorData.x,\n    //       y: this.cursorData.y,\n    //       lastSelect: true,\n    //     }\n    //     p.time = Utils.makeTimeText(p);\n    //     this.selectPoint(p);\n    //     this.pointData.push(p)\n    //     this.onChange();\n    //     this.updateData();\n    //     this.update();\n    //     this.cursorData.visible = false;\n    //     this.drawCursor();\n    //     this.setUndo(b);\n    //   }\n    // }\n    //delete key\n    if(e.keyCode === 8 || e.keyCode === 46) {\n      e.preventDefault();\n      if (!this.props.readOnly) {\n        let done = false;\n        const b = textDiagramData(Utils.save(this));\n        this.lineData.forEach( d => {\n          if (d.s.selected || d.d.selected) {\n            d.selected = true;\n          }\n        })\n        let pointData = [];\n        this.pointData.forEach( d => {\n          if (!d.selected) {\n            pointData.push(d);\n          } else {\n            done = true;\n            if (d.time) {\n              this.textData.splice(this.textData.indexOf(d.time),1);\n            }\n          }\n        })\n        let lineData = [];\n        this.lineData.forEach( d => {\n          if (!d.selected) {\n            lineData.push(d);\n          }\n        })\n        if (done) this.setUndo(b);\n        this.pointData = pointData;\n        this.lineData = lineData;\n        this.onChange();\n        this.updateData();\n        this.update();\n      }\n    }\n    //enter key\n    if(e.keyCode === 13) {\n      e.preventDefault();\n      if (!this.props.readOnly) {\n        const b = textDiagramData(Utils.save(this));\n        let selectedBusStop = 0;\n        this.busStops.some( (b, i) => {\n          if (!b.selected) return false;\n          selectedBusStop = i+1;\n          return true;\n        })\n        if (selectedBusStop >= 1\n        && selectedBusStop <= this.busStops.length) {\n          if (e.shiftKey) {\n            if (this.busStops.length <= 2 || selectedBusStop < 2) return;\n            Utils.deleteBusstop(this, selectedBusStop-2);\n            this.setUndo(b);\n          } else {\n            Utils.insertBusstop(this, selectedBusStop-1);\n            this.setUndo(b);\n          }\n          this.onChange();\n          this.updateData();\n          this.clearGrid(this.grid);\n          this.clearGrid(this.menu);\n          this.update();\n        }\n      }\n    }\n    //left key \n    if(e.keyCode === 37) {\n      e.preventDefault();\n    }\n    //right key \n    if(e.keyCode === 39) {\n      e.preventDefault();\n    }\n    //command+z\n    if(e.metaKey && e.keyCode === 90) {\n      e.preventDefault();\n      if (!this.props.readOnly) {\n        if (e.shiftKey) {\n          this.doRedo();\n        } else {\n          this.doUndo();\n        }\n      }\n    }\n  }\n\n  onKeyUp = (e) => {\n    if (!this.props.readOnly) {\n      this.altKey = e.altKey;\n    }\n  }\n\n  onMouseLeave = (event) => {\n    if (event.shiftKey) {\n      this.marky.width = 0;\n      this.marky.height = 0;\n    }\n  }\n\n  onChange = () => {\n    const b = Utils.save(this);\n    if (this.props.onChangeData) {\n      this.props.onChangeData(b);\n    }\n  }\n\n  setUndo = (b) => {\n    this.undoBuffer = this.undoBuffer.slice(0, this.undoPtr);\n    this.undoBuffer.push(b);\n    this.undoPtr ++;\n  }\n\n  doUndo = () => {\n    if (this.undoPtr > 0) {\n      this.undoPtr--;\n      const b = this.undoBuffer[this.undoPtr];\n      this.loadData(b);\n      if (this.props.onChangeData) {\n        this.props.onChangeData(b);\n      }\n    }\n  }\n\n  doRedo = () => {\n    if (this.undoBuffer.length > this.undoPtr) {\n      const b = this.undoBuffer[this.undoPtr];\n      this.loadData(b);\n      if (this.props.onChangeData) {\n        this.props.onChangeData(b);\n      }\n      this.undoPtr++;\n    }\n  }\n\n  get diagramData() {\n    const t = Utils.save(this);\n    return textDiagramData(t);\n  }\n\n  busStopData(stopNo) {\n    const r = [];\n    const busStop = this.busStops[stopNo-1];\n    const name = busStop.name;\n    this.pointData.forEach( (p, i) => {\n      p.idx = i;\n      delete p.mark;\n      delete p.lines;\n    })\n    this.lineData.forEach( l => {\n      if (typeof l.s.lines === 'undefined') l.s.lines = [];\n      if (typeof l.d.lines === 'undefined') l.d.lines = [];\n      l.s.lines.push(l);\n      l.d.lines.push(l);\n    })\n    this.pointData.forEach( p => {\n      if (p.y === stopNo) {\n        r.push(p);\n      }\n    })\n    const findLinkedTime = (p, t, o, s) => {\n      if (p.mark) return;\n      if (o.y === p.y) s.push(p);\n      t.push(p);\n      p.mark = true;\n      p.lines.forEach( l => {\n        findLinkedTime(l.s, t, o, s);\n        findLinkedTime(l.d, t, o, s);\n      })\n    }\n    const rp = [];\n    const times = r.map( p => {\n      const t = [];\n      const s = [];\n      findLinkedTime(p, t, p, s);\n      if (t.length > 1) {\n        t.sort( (a,b) => {\n          if (a.y > b.y) return  1;\n          if (a.y < b.y) return -1;\n          return 0;\n        })\n        const fp = t[0];\n        const ep = t[t.length-1];\n        s.sort( (a,b) => {\n          if (a.x > b.x) return  1;\n          if (a.x < b.x) return -1;\n          return 0;\n        })\n        let q =  { ...s[s.length-1] };\n        if (fp.x < ep.x) {\n          q.dir = 'down';\n          q.departure = this.busStops[fp.y-1];\n          q.arrival = this.busStops[ep.y-1];\n        } else {\n          q.dir = 'up';\n          q.departure = this.busStops[ep.y-1];\n          q.arrival = this.busStops[fp.y-1];\n        }\n        q.x = limit24(q.x);\n        let g = parseInt(q.x+0.5);\n        q.sec = parseInt(g % 60);\n        q.min = parseInt(g / 60) % 60;\n        q.hour = parseInt(parseInt(g / 60) / 60);\n        return q;\n      }\n      return null;\n    })\n    .filter( p => p !== null )\n    .sort( (a,b) => {\n      if (a.x > b.x) return  1;\n      if (a.x < b.x) return -1;\n      return 0;\n    });\n    this.pointData.forEach( p => {\n      delete p.idx;\n      delete p.mark;\n      delete p.lines;\n    })\n    return {\n      name,\n      times,\n    }\n  }\n\n  resetScreenPosition = () => {\n    const { width, height } = this.size();\n\n    this.xScale\n      .domain([0, width*this.timeLineWidth()])\n      .range([0, width]);\n\n    const w = (width - menuWidth)/(this.gridScale.x*24);\n\n    this.base\n      .call(this.gridZoomBehavior.transform, d3.zoomIdentity.translate(this.gridScale.x*(menuWidth/this.gridScale.x), 0).scale(w));\n\n    this.menu\n      .call(this.menuZoomBehavior.transform, d3.zoomIdentity.translate(0, 0).scale(1));\n  }\n\n  changeBusStop = (busStop) => {\n    if (!this.props.readOnly) {\n      const i = busStop.index-1;\n      if (i >= 0 && i < this.busStops.length) {\n        const name = busStop.name.trim().replace(/\\s/g, '');\n        if (this.busStops[i].name !== name) {\n          const b = textDiagramData(Utils.save(this));\n          this.busStops[i].name = name;\n          this.onChange();\n          this.setUndo(b);\n        }\n      }\n    }\n  }\n\n  render() {\n    return (\n      <div\n        ref={n => this.container = n}\n        style={{\n          display: 'inline-block',\n          marign: 0,\n          padding: 0,\n          width: this.state.width,\n          overflow: 'hidden',\n          border: 'solid 1px lightgray',\n        }}\n        tabIndex={this.props.tabIndex}\n        focusable={true}\n        onKeyDown={this.onKeyDown}\n        onKeyUp={this.onKeyUp}\n        onMouseLeave={this.onMouseLeave}\n      >\n        <svg\n          ref={n => {\n            this.svgElement = n;\n            this.svg = d3.select(n)\n          }}\n          width=\"100%\"\n          height={this.state.height}\n          style={{\n            marign: 0,\n          }}\n        >\n          <g ref={n => this.base = d3.select(n)} >\n            <g ref={n => this.axis = d3.select(n)} style={{ visibility: 'hidden' }}/>\n            <g ref={n => this.grid = d3.select(n)} />\n            <g ref={n => this.line = d3.select(n)} />\n            <g ref={n => this.rect = d3.select(n)} />\n            <g ref={n => this.cursor = d3.select(n)} />\n            <g ref={n => this.text = d3.select(n)} />\n            <g ref={n => this.marky = d3.select(n)} />\n          </g>\n          <g ref={n => this.menu = d3.select(n)} />\n        </svg>\n      </div>\n    )\n  }\n}\n\nDiagramView.defaultProps = {\n  params: {},\n  readOnly: false,\n  tabIndex: 0,\n}\n","import React, { Component } from 'react';\nimport {\n  Row,\n  Col,\n  Button,\n  Modal,\n} from 'react-bootstrap';\n\nexport default class BusStopEditDialog extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      ...props.busStop,\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.busStop !== nextProps.busStop) {\n      this.setState({\n        ...nextProps.busStop,\n      })\n    }\n  }\n\n  onClose = () => {\n    if (this.props.onClose) {\n      this.props.onClose();\n    }\n  }\n\n  onEdited = () => {\n    if (this.props.onEdited) {\n      this.props.onEdited({\n        name: this.state.name,\n      });\n    }\n  }\n\n  render() {\n    const times = [];\n    for (var i=0;i<24;i++) {\n      times.push([]);\n    }\n    if (this.state.data.times) {\n      this.state.data.times.forEach( t => {\n        times[t.hour].push(t);\n      })\n    }\n    return (\n      <Modal\n        show={this.props.show}\n        size=\"lg\"\n        onHide={this.onClose}\n      >\n        <Modal.Header closeButton>\n          <Modal.Title>\n            \n          </Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <Row>\n            <Col md={12}>\n              <input\n                type=\"text\"\n                style={{ width: '100%', marginBottom: 10, }}\n                value={this.state.name}\n                onChange={(e) => {\n                  this.setState({\n                    name: e.target.value,\n                  })\n                }}\n                placeholder=\"\"\n                readOnly={this.props.readOnly?'readonly':null}\n              />\n            </Col>\n          </Row>\n          <Row>\n            <Col md={12}>\n              <table style={{ width: '100%', fontSize: 12, }}>\n                <thead>\n                  <tr key={i} style={{ border: 'solid 1px lightgray',  }} >\n                    <th width={50}>\n                      <span style={{ margin: 10, }}></span>\n                    </th>\n                    <th style={{ borderLeft: 'solid 1px lightgray', width: '50%', textAlign: 'center', }}>\n                      <span></span>\n                    </th>\n                    <th style={{ borderLeft: 'solid 1px lightgray', width: '50%', textAlign: 'center', }}>\n                      <span></span>\n                    </th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {\n                    times.map( (t, i) => {\n                      return (\n                        <tr key={i} style={{ border: 'solid 1px lightgray',  }} >\n                          <td width={50}>\n                            <span style={{ margin: 10, }}>{ ('00'+i).slice(-2) }</span>\n                          </td>\n                          <td style={{ borderLeft: 'solid 1px lightgray', width: '50%', }}>\n                            <span>{ t.filter( d => d.dir === 'up').map( v => `${v.min}` ).join(', ') }</span>\n                          </td>\n                          <td style={{ borderLeft: 'solid 1px lightgray', width: '50%', }}>\n                            <span>{ t.filter( d => d.dir === 'down').map( v => `${v.min}` ).join(', ') }</span>\n                          </td>\n                        </tr>\n                      )\n                    })\n                  }\n                </tbody>\n              </table>\n            </Col>\n          </Row>\n        </Modal.Body>\n        <Modal.Footer>\n          <Button onClick={this.onEdited}>OK</Button>\n        </Modal.Footer>\n      </Modal>\n    )\n  }\n}\n\nBusStopEditDialog.defaultProps = {\n  show: false,\n  busStop: {\n    name: '',\n    data: {},\n  },\n  readOnly: false,\n}\n","import React, { Component } from 'react';\nimport {\n  Row,\n  Col,\n  Button,\n  Modal,\n} from 'react-bootstrap';\nimport AceEditor from 'react-ace';\nimport 'brace/mode/plain_text';\nimport 'brace/theme/chrome';\n\nexport default class DiagramDataDialog extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      text: props.text,\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.text !== nextProps.text) {\n      this.setState({\n        text: (nextProps.text === null) ? '' : nextProps.text,\n      })\n    }\n  }\n\n  onClose = () => {\n    if (this.props.onClose) {\n      this.props.onClose();\n    }\n  }\n\n  onEdited = () => {\n    if (this.props.onEdited) {\n      this.props.onEdited(this.state.text);\n    }\n  }\n\n  onChangeText = (value) => {\n    this.setState({ text: value });\n  }\n\n  render() {\n    return (\n      <Modal\n        show={this.props.show}\n        size=\"lg\"\n        onHide={this.onClose}\n      >\n        <Modal.Header closeButton>\n          <Modal.Title>\n            \n          </Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <Row>\n            <Col md={12}>\n              {\n                <AceEditor\n                  ref={ r => this.editor = r }\n                  style={{\n                    display: 'inline-block',\n                    border: 'solid 1px lightgray',\n                  }}\n                  mode=\"text\"\n                  theme=\"chrome\"\n                  value={this.state.text}\n                  width=\"100%\"\n                  height={`${this.props.height}px`}\n                  onChange={this.onChangeText}\n                  showPrintMargin={false}\n                  fontSize={12}\n                  name=\"digram_data_dialog\"\n                  editorProps={{$blockScrolling: Infinity}}\n                  readOnly={this.props.readonly}\n                />\n              }\n            </Col>\n          </Row>\n        </Modal.Body>\n        <Modal.Footer>\n          <Button onClick={this.onEdited}>OK</Button>\n        </Modal.Footer>\n      </Modal>\n    )\n  }\n}\n\nDiagramDataDialog.defaultProps = {\n  show: false,\n  name: '',\n  height: 100,\n}\n","import React, { Component } from 'react';\nimport {\n  Row,\n  Col,\n  Button,\n  Modal,\n  Dropdown,\n} from 'react-bootstrap';\n\nexport default class ConfigDialog extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      consumerKey: props.consumerKey,\n      operator: props.operator,\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.consumerKey !== nextProps.consumerKey) {\n      this.setState({\n        consumerKey: nextProps.consumerKey,\n      })\n    }\n    if (this.props.operator !== nextProps.operator) {\n      this.setState({\n        operator: nextProps.operator,\n      })\n    }\n  }\n\n  onClose = () => {\n    if (this.props.onClose) {\n      this.props.onClose();\n    }\n  }\n\n  onEdited = () => {\n    if (this.props.onEdited) {\n      this.props.onEdited({\n        ...this.state,\n      });\n    }\n  }\n\n  onSelectHandler = (operator) => {\n    return () => {\n      this.setState({\n        operator,\n      })\n    }\n  }\n\n  render() {\n    return (\n      <Modal\n        show={this.props.show}\n        size=\"lg\"\n        onHide={this.onClose}\n      >\n        <Modal.Header closeButton>\n          <Modal.Title>\n            \n          </Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <Row>\n            <Col md={12}>\n              <div>\n              <p><a href=\"https://tokyochallenge.odpt.org/\" target=\"open-data-challenge\"></a><br/>\n                OK</p>\n              </div>\n            </Col>\n            <Col md={12}>\n              <input\n                type=\"text\"\n                style={{ width: '100%', marginBottom: 10, }}\n                value={this.state.consumerKey}\n                onChange={(e) => {\n                  this.setState({\n                    consumerKey: e.target.value,\n                  })\n                }}\n                placeholder=\"\"\n              />\n            </Col>\n            <Col md={12}>\n            <div style={{ marginBottom: 20, }}>\n              {\n                <Dropdown>\n                  <Dropdown.Toggle size=\"sm\" variant=\"outline-secondary\" id=\"dropdown-basic\">\n                    { this.state.operator.title ? this.state.operator.title : '' }\n                  </Dropdown.Toggle>\n                  <Dropdown.Menu>\n                    {\n                      this.props.operators.map( (r, i) => {\n                        return <Dropdown.Item key={i} onSelect={this.onSelectHandler(r)} active={ this.state.operator.title === r.title } >{r.title}</Dropdown.Item>\n                      })\n                    }\n                  </Dropdown.Menu>\n                </Dropdown>\n              }\n            </div>\n            </Col>\n            <Col md={12}>\n              <div style={{ color: 'red' }}>\n                <p><br/></p>\n              </div>\n            </Col>\n          </Row>\n        </Modal.Body>\n        <Modal.Footer>\n          <Button onClick={this.onEdited}>OK</Button>\n        </Modal.Footer>\n      </Modal>\n    )\n  }\n}\n\nConfigDialog.defaultProps = {\n  consumerKey: '',\n  operator: {},\n  operators: [],\n}\n","import React, { Component } from 'react';\nimport DiagramView from '../../components/DiagramView';\nimport BusStopDialog from '../../components/BusStopDialog';\nimport DiagramDataDialog from '../../components/DiagramDataDialog';\nimport ConfigDialog from '../../components/ConfigDialog';\nimport {\n  Nav,\n} from 'react-bootstrap';\nimport 'whatwg-fetch'\n\nconst namespace = 'diagram';\n\nconst api = 'https://api-tokyochallenge.odpt.org/api/v4';\n\nconst BusTimetableAPI = 'BusTimetable';\nconst BusstopPoleAPI = 'BusstopPole';\nconst BusroutePatternAPI = 'BusroutePattern';\n\nconst AsyncStorage = {\n  getItem: function(key, defaultValue) {\n    const value = localStorage.getItem(`${namespace}-${key}`);\n    return (value !== null) ? JSON.parse(value).data : defaultValue;\n  },\n  setItem: function(key, value) {\n    localStorage.setItem(`${namespace}-${key}`, JSON.stringify({ data: value }));\n  },\n}\n\nexport default class Diagram extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showBusStopDialog: false,\n      showDiagramDataDialog: false,\n      showConfigDialog: false,\n      busStop: {\n        name: '',\n        data: {},\n      },\n      params: AsyncStorage.getItem('params', {}),\n      width: window.innerWidth,\n      height: window.innerHeight,\n      diagramData: AsyncStorage.getItem('data', ''),\n      diagramEditData: '',\n      busRouteTable: AsyncStorage.getItem('busRouteTable', {}),\n      consumerKey: AsyncStorage.getItem('consumerKey', ''),\n      operator: AsyncStorage.getItem('operator', { title: '', key: '', }),\n      loading: '',\n      selectedRoute: AsyncStorage.getItem('selectedRoute', 0),\n    }\n  }\n\n  onResize = () => {\n    this.setState({\n      width: window.innerWidth,\n      height: window.innerHeight,\n    }, this.update);\n  }\n\n  componentDidMount() {\n    window.addEventListener('resize', this.onResize, false);\n    this.loadOpenData();\n  }\n  \n  componentWillUnmount() {\n    window.removeEventListener('resize', this.onResize);\n  }\n\n  onEditBusStop = (busStop) => {\n    this.setState({\n      showBusStopDialog: true,\n      busStop,\n    });\n  }\n\n  onCloseBusStop = () => {\n    this.setState({\n      showBusStopDialog: false,\n    })\n  }\n\n  onEditedBusStop = (busStop) => {\n    this.diagramView.changeBusStop({\n      ...this.state.busStop,\n      name: busStop.name,\n    })\n    this.setState({\n      showBusStopDialog: false,\n    });\n  }\n\n  openDiagramDataDialog = () => {\n    this.setState({\n      showDiagramDataDialog: true,\n      diagramEditData: this.diagramView.diagramData,\n    });\n  }\n\n  onEditedDiagramData = (diagramData) => {\n    this.setState({\n      showDiagramDataDialog: false,\n      diagramData,\n    }, () => {\n      AsyncStorage.setItem('data', diagramData)\n    });\n  }\n\n  onCloseDiagramData = () => {\n    this.setState({\n      showDiagramDataDialog: false,\n    })\n  }\n\n  onChangeData = (data) => {\n    AsyncStorage.setItem('data', this.diagramView.diagramData);\n  }\n\n  onChangeParam = (params) => {\n    AsyncStorage.setItem('params', params);\n  }\n\n  resetScreenPosition = () => {\n    this.diagramView.resetScreenPosition();\n  }\n\n  openConfigDialog = () => {\n    this.setState({\n      showConfigDialog: true,\n    })\n  }\n\n  onCloseConfigDialog = () => {\n    this.setState({\n      showConfigDialog: false,\n    })\n  }\n\n  onEditedConfigDialog = ({ consumerKey, operator, }) => {\n    AsyncStorage.setItem('consumerKey', consumerKey);\n    AsyncStorage.setItem('operator', operator);\n    const busRouteTable = { ...this.state.operator.key };\n    if (this.state.operator.key) {\n      delete busRouteTable[this.state.operator.key];\n    }\n    this.setState({\n      showConfigDialog: false,\n      consumerKey,\n      operator,\n      busRouteTable,\n    }, this.loadOpenData)\n  }\n\n  loadJSON = (command) => {\n    return new Promise( resolve => {\n      fetch(`${api}/odpt:${command}?odpt:operator=odpt.Operator:${this.state.operator.key}&acl:consumerKey=${this.state.consumerKey}`)\n        .then(function(response) {\n          return response.json()\n        }).then(function(json) {\n          resolve(json);\n        }).catch(function(ex) {\n          console.log('parsing failed', ex)\n        })\n    })\n  }\n\n  loadOpenData = async () => {\n    if (this.state.consumerKey === '') return;\n    if (this.state.operator.key === '') return;\n\n    if (this.state.busRouteTable[this.state.operator.key]) return;\n\n    this.setState({ loading: '...' });\n\n    const BusstopPole = await this.loadJSON(BusstopPoleAPI);\n    const BusroutePattern = await this.loadJSON(BusroutePatternAPI);\n    const BusTimetable = await this.loadJSON(BusTimetableAPI);\n\n    const route = BusroutePattern;\n\n    const pole = (() => {\n      const pole = BusstopPole;\n      const pl = {}\n      pole.forEach( p => {\n        pl[p['owl:sameAs']] = p;\n      })\n      return pl;\n    })();\n\n    const times = (() => {\n      const times = BusTimetable;\n      const tm = {};\n      times.forEach( t => {\n        const pattern = t['odpt:busroutePattern'];\n        if (tm[pattern] == null) {\n          tm[pattern] = {};\n        }\n        if (tm[pattern][t['odpt:calendar']] == null) {\n          tm[pattern][t['odpt:calendar']] = [];\n        }\n        tm[pattern][t['odpt:calendar']].push(t);\n      })\n      return tm;\n    })();\n\n    function matchBusroute(s) {\n      const t = s.match(/^odpt\\.Busroute:(.+)/)\n      if (t) {\n        return t[1];\n      }\n      return s;\n    }\n\n    function matchBuspole(s) {\n      const t = s.match(/^odpt\\.BusstopPole:(.+)/)\n      if (t) {\n        return t[1];\n      }\n      return s;\n    }\n\n    function matchCalendar(s) {\n      const t = s.match(/^odpt\\.Calendar:(.+)/)\n      if (t) {\n        return t[1];\n      }\n      return s;\n    }\n\n    function poleInfo(order) {\n      return order.map( v => {\n        const o = { ...v }\n        const pl = pole[o['odpt:busstopPole']];\n        if (pl && typeof pl['dc:title'] !== 'undefined') {\n          if (typeof pl['odpt:busstopPoleNumber'] !== 'undefined') {\n            o.title = `${pl['dc:title']}(${pl['odpt:busstopPoleNumber']})`;\n          } else {\n            o.title = pl['dc:title'];\n          }\n        } else {\n          o.title = matchBuspole(o['odpt:busstopPole']);\n        }\n        o['pole'] = matchBuspole(o['odpt:busstopPole']);\n        delete o['odpt:busstopPole'];\n        return o;\n      })\n    }\n\n    const busroutes = {};\n\n    const days = {\n      Weekday: '',\n      Saturday: '',\n      Holiday: '',\n    }\n\n    route.forEach( r => {\n      const br = matchBusroute(r['odpt:busroute']);\n      const d = {\n        direction: r['odpt:direction'],\n        pattern: r['odpt:pattern'],\n        route: matchBusroute(r['odpt:busroute']),\n      }\n      const busroutePattern = `odpt.BusroutePattern:${d.route}.${d.pattern}.${d.direction}`;\n      const t = times[busroutePattern];\n      if (t) {\n        Object.keys(t).forEach( calendar => {\n          console.log(br, calendar);\n          if (t[calendar]) {\n            if (busroutes[`${br}-${calendar}`] == null) {\n              busroutes[`${br}-${calendar}`] = {\n                title: `${r['dc:title']}:${days[matchCalendar(calendar)]}:${r['odpt:direction']}`,\n                route:[],\n              };\n            }\n            const d = {\n              note: r['odpt:note'],\n              direction: r['odpt:direction'],\n              pattern: r['odpt:pattern'],\n              order: poleInfo(r['odpt:busstopPoleOrder']),\n              route: matchBusroute(r['odpt:busroute']),\n              calendar,\n            }\n            let times = t[calendar].map( q => {\n              const t = q['odpt:busTimetableObject'].map( t => {\n                const d = t['odpt:departureTime'];\n                if (d) return {\n                  pole: matchBuspole(t['odpt:busstopPole']),\n                  time: d,\n                }\n                return {\n                  pole: matchBuspole(t['odpt:busstopPole']),\n                  time: t['odpt:arrivalTime'],\n                }\n              })\n              return t;\n            });\n            function reorder(times, order) {\n              const t = times.map( time => {\n                const q = [];\n                let n = -1;\n                time.forEach( (t, i) => {\n                  while (n < order.length) {\n                    n ++;\n                    if (order[n].pole === t.pole) {\n                      q.push(t)\n                      break;\n                    } else {\n                      q.push({ pole: t.pole, time: '-' })\n                    }\n                  }\n                })\n                return q;\n              })\n              return t;\n            }\n            const order = d.order;\n            d.times = reorder(times, order);\n            if (d.direction === '2') {\n              d.order = [ ...d.order ].reverse();\n              d.times = [ ...d.times ].reverse();\n            } else {\n              d.order = [ ...d.order ]\n              d.times = [ ...d.times ]\n            }\n            if (times.length > 0) {\n              busroutes[`${br}-${calendar}`].route.push(d)\n            }\n          }\n        });\n      }\n    })\n\n    //console.log(JSON.stringify(busroutes, null, '  '));\n\n    const routeTable = {};\n\n    Object.keys(busroutes).forEach( k => {\n      busroutes[k].route.forEach( v => {\n        routeTable[`${busroutes[k].title} ${v.note}`] = {\n          title: `${busroutes[k].title} ${v.note ? v.note : ''}`,\n          busStops: `${v.order.map( v => v.title ).map( v => v.replace(/\\s/g,'')).join(' ')}`,\n          times: `${v.times.map( t => t.map( t => t.time ).join(' ')).join('\\n')}`,\n        }\n      })\n    })\n\n    const table = { ...this.state.busRouteTable }\n    table[this.state.operator.key] = Object.keys(routeTable).map( k => routeTable[k] );\n\n    const busRouteTable = table[this.state.operator.key];\n    const diagramData = (busRouteTable.length <= 0) ? '' : `${busRouteTable[0].busStops}\\n${busRouteTable[0].times}`;\n\n    this.setState({\n      selectedRoute: 0,\n      busRouteTable: table,\n      loading: '',\n      diagramData,\n    }, () => {\n      AsyncStorage.setItem('busRouteTable', this.state.busRouteTable);\n      AsyncStorage.setItem('data', this.state.diagramData)\n      AsyncStorage.setItem('selectedRoute', this.state.selectedRoute)\n    })\n\n  }\n\n  onSelectRoute = (e) => {\n    const i = e.target.value;\n    const busRouteTable = this.state.busRouteTable[this.state.operator.key];\n    this.setState({\n      selectedRoute: i,\n      diagramData: `${busRouteTable[i].busStops}\\n${busRouteTable[i].times}`,\n    }, () => {\n      AsyncStorage.setItem('data', this.state.diagramData)\n      AsyncStorage.setItem('selectedRoute', this.state.selectedRoute)\n    })\n  }\n\n  render() {\n    return (\n      <div style={{ overflow: 'hidden' }}>\n        <nav className=\"navbar sticky-top navbar-light bg-light\">\n          <a className=\"navbar-brand\" href=\"#\"></a>\n          {\n            this.state.loading ? <Nav className=\"mr-auto\"><span style={{ color: 'red', }}> { this.state.loading } </span></Nav> : null\n          }\n          {\n            (this.state.busRouteTable[this.state.operator.key] && this.state.busRouteTable[this.state.operator.key].length > 0) ? <Nav className=\"mr-auto\">\n            <select defaultValue={this.state.selectedRoute} onChange={ this.onSelectRoute }>\n              {\n                this.state.busRouteTable[this.state.operator.key].map( (r, i) => {\n                  return <option key={i} value={i} >{r.title}</option>\n                })\n              }\n            </select></Nav> : null\n          }\n          <div>\n            <a\n              href=\"https://docs.google.com/presentation/d/1F0RfbHgcRPHgPSxpe61pBMZ8Yf0WGaXe7XT06Y3AWkk/edit?usp=sharing\"\n              target=\"manual\"\n              className=\"btn btn-sm btn-outline-secondary\"\n              style={{marginRight: 10}}\n              role=\"button\"\n            ></a>\n            {/* <button\n              className=\"btn btn-sm btn-outline-secondary\"\n              style={{marginRight: 10}}\n              type=\"button\"\n              onClick={this.openConfigDialog}\n            ></button> */}\n            <button\n              className=\"btn btn-sm btn-outline-secondary\"\n              style={{marginRight: 10}}\n              type=\"button\"\n              onClick={this.resetScreenPosition}\n            ></button>\n            <button\n              className=\"btn btn-sm btn-outline-secondary\"\n              type=\"button\"\n              onClick={this.openDiagramDataDialog}\n            ></button>\n          </div>\n        </nav>\n        <DiagramView\n          ref={n => this.diagramView = n}\n          onEditBusStop={this.onEditBusStop}\n          onChangeData={this.onChangeData}\n          onChangeParam={this.onChangeParam}\n          diagramData={this.state.diagramData}\n          params={this.state.params}\n          width={this.state.width-2}\n          height={this.state.height-26-38-10}\n        />\n        <BusStopDialog\n          busStop={this.state.busStop}\n          show={this.state.showBusStopDialog}\n          onClose={this.onCloseBusStop}\n          onEdited={this.onEditedBusStop}\n        />\n        <DiagramDataDialog\n          show={this.state.showDiagramDataDialog}\n          text={this.state.diagramEditData}\n          onClose={this.onCloseDiagramData}\n          onEdited={this.onEditedDiagramData}\n          height={this.state.height-240}\n        />\n        <ConfigDialog\n          show={this.state.showConfigDialog}\n          consumerKey={this.state.consumerKey}\n          operator={this.state.operator}\n          operators={[\n            { title: '', key: 'KeioBus', },\n            { title: 'JR', key: 'JRBusKanto', },\n            { title: '', key: 'KantoBus', },\n            { title: '', key: 'OdakyuBus', },\n            { title: '', key: 'NishiTokyoBus', },\n            { title: '', key: 'SeibuBus', },\n            { title: '', key: 'TobuBus', },\n            { title: '',  key: 'TokyuBus', },\n          ]}\n          onClose={this.onCloseConfigDialog}\n          onEdited={this.onEditedConfigDialog}\n        />\n      </div>\n    )\n  }\n}\n\nDiagram.defaultProps = {\n}\n"],"sourceRoot":""}