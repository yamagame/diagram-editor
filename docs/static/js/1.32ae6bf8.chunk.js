(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{141:function(t,e,a){"use strict";a.r(e);var n=a(135),r=a(80),o=a.n(r),i=a(83),s=a(45),l=a(7),c=a(8),u=a(10),d=a(9),p=a(11),h=a(1),f=a.n(h),m=a(13),g=a(134),y=function(t){for(;t<0;)t+=86400;for(;t>=86400;)t-=86400;var e=parseInt(t+.5),a=parseInt(e%60),n=parseInt(e/60)%60,r=parseInt(parseInt(e/60)/60),o=function(t){return"".concat(("00"+t).slice(-2))};return 0!==a?"".concat(o(r),":").concat(o(n),":").concat(o(a)):"".concat(o(r),":").concat(o(n))},b=function(t){var e={update:function(){this.x=t.x,this.y=t.y,this.text=y(t.x),this.dx=6,this.dy=5,this.fontSize=.7}};return e.update(),e},x=function(t){var e=t.busStops,a=t.timeLines,n=e.split("\n").map(function(t){return"-"===t?"":t}),r=a.split("\n"),o=[],i=[];if(r.forEach(function(t){var e=t.split(" "),a=[],n=0,r=null;e.forEach(function(t,e){"-"!==t&&""!==t&&t.split("-").forEach(function(t){var e=function(t,e){var a=t.trim().split(":"),n=0,r=0,o=0;a.length>0&&(n=parseInt(a[0])),a.length>1&&(r=parseInt(a[1])),a.length>2&&(o=parseInt(a[2]));var i,s=60*n*60+60*r+o,l=s;if(null!==e){var c=e%86400-s%86400;((i=c)>0?i:-i)>=43200&&(l+=86400*function(t){return t>0?1:-1}(c)),e>=86400?l+=86400*parseInt(e/86400):e<0&&(l+=86400*parseInt(e/86400))}return{t:l,x:s}}(t,r),i=e.t,s=(e.x,{x:i,y:n+1});s.time=b(s),o.push(s),a.push(s),r=i});n++});var s=null;a.forEach(function(t){s&&i.push({s:s,d:t}),s=t})}),n.length<2)for(;n.length<2;)n.push("");return{busStops:n.map(function(t){return{name:t}}),pointData:o,lineData:i}},v=function(t){var e=t.busStops,a=t.pointData,n=t.lineData,r=e.map(function(t){return t.name.trim().replace(/\s/g,"")}),o=(a.sort(function(t,e){return t.x>e.x?1:t.x<e.x?-1:0}).map(function(t,e){return t.index=e,t.lines=[],t}),n.map(function(t){if(t.s.x>t.d.x){var e=t.s;t.s=t.d,t.d=e}return t.done=!1,t.s.lines.push(t),t.d.lines.push(t),t}).sort(function(t,e){return t.s.x>e.s.x?1:t.s.x<e.s.x?-1:0})),i=0;o.forEach(function(t,e){!function t(e,a){e.done||(e.done=!0,a<0&&(a=i,i++),e.index=a,e.s.lines.forEach(function(e){t(e,a)}),e.d.lines.forEach(function(e){t(e,a)}))}(t,-1)});var s=[];o.sort(function(t,e){return t.index>e.index?1:t.index<e.index?-1:0}).forEach(function(t){"undefined"==typeof s[t.index]&&(s[t.index]=[]),s[t.index].push(t)});var l=[];return s.forEach(function(t){var e=t.sort(function(t,e){return t.s.y>e.s.y?1:t.s.y<e.s.y?-1:0}),a=!1;e[0].s.y<e[0].d.y&&(a=!0);var n=[],o=null;e.forEach(function(t,e){a?n.push(t.s):n.push(t.d),o=t}),o&&(a?n.push(o.d):n.push(o.s));var i=[];r.forEach(function(t){i.push([])}),n.forEach(function(t){t.y>0&&t.y<=i.length&&i[t.y-1].push(t)}),l.push(i.map(function(t){if(0===t.length)return"-";var e="";return t.forEach(function(t){""!==e&&(e+="-"),e+=y(t.x)}),e}).join(" "))}),{busStops:r.map(function(t){return""===t?"-":t}).join("\n"),timeLines:l}},D=function(t,e){var a=t.busStops,n=t.pointData;t.lineData;a.splice(e,0,{name:""}),n.forEach(function(t){t.y>=e+1&&(t.y+=1)})},S=function(t,e){var a=t.busStops,n=t.pointData,r=t.lineData;if(console.log(a[e].name),""===a[e].name){a.splice(e,1);var o=[];n.forEach(function(t,a){t.y==e+1?(t.delete=!0,o.push(a)):t.y>e+1&&(t.y-=1)}),o.reverse().forEach(function(t){n.splice(t,1)});var i=[];r.forEach(function(t,e){(t.s.delete||t.d.delete)&&i.push(e)}),i.reverse().forEach(function(t){r.splice(t,1)})}},E=150,k=86400,w=function(t){return t<0&&(t+=k),t%k},C=function(t){return t<0?60*parseInt((t-60+30)/60):60*parseInt((t+30)/60)},O=function(t){return"".concat(t.busStops.split("\n").join(" "),"\n").concat(t.timeLines.join("\n"),"\n")},P=function(t){var e=t.split("\n"),a=null,n=null;return e.some(function(t,e){return 0!=t.indexOf("/")&&(null===a?(a=t,!1):(null===n&&(n=e),!0))}),{busStops:null!==a?a.split(" ").join("\n"):"",timeLines:null!==n?e.slice(n).join("\n"):""}},j=function(t){function e(t){var a;Object(l.a)(this,e),(a=Object(u.a)(this,Object(d.a)(e).call(this,t))).size=function(){return{width:a.state.width,height:a.state.height}},a.loadData=function(t){var e=x(P(t)),n=e.busStops,r=e.lineData,o=e.pointData;a.lineData=r,a.pointData=o,a.busStops=n,a.lineLoopData=[],a.pointLoopData=[],a.textData=[],a.componentDidUpdate()},a.timeLineWidth=function(){return 3600/a.gridScale.x},a.busLineHeight=function(){return 1/a.gridScale.y},a.makeLine=function(t,e){a.lineData.push({s:t,d:e}),a.deleteDoubleLine()},a.selectPoint=function(t){t.selected=!0},a.deselectPoint=function(t){delete t.selected,delete t.lastSelect},a.deleteDoubleLine=function(){var t={},e=[];a.pointData.forEach(function(t,e){t.index=e}),a.lineData.forEach(function(a){var n="".concat(a.d.index,"-").concat(a.s.index);a.s.index<a.d.index&&(n="".concat(a.s.index,"-").concat(a.d.index)),"undefined"===typeof t[n]&&(e.push(a),t[n]=a)}),a.lineData=e},a.initialize=function(){var t=a.size(),e=t.width,n=t.height;a.xScale=g.d().domain([0,e*a.timeLineWidth()]).range([0,e]),a.yScale=g.d().domain([a.gridScale.dy,n*a.busLineHeight()+a.gridScale.dy]).range([0,n]),a.dragHandle=g.a().on("start",function(t,e){if(!a.props.readOnly){var n=t.org;a.cursorData.visible=!1,a.drawCursor();var r=null,o=0;if(a.pointData.some(function(t,e){return!(!t.selected||!t.lastSelect)&&(r=t,o=e,!0)}),a.altKey=g.b.sourceEvent.altKey,g.b.sourceEvent.altKey&&null!==r&&o!==e){var i=O(v(Object(m.a)(Object(m.a)(a)))),s=a.pointData.length,l=a.lineData.length;a.pointData.forEach(function(t){delete t.lastSelect}),n.lastSelect=!0,a.selectPoint(n);g.b.on("end",function(t,e){var n=t.org;a.makeLine(r,n),a.onChange(),a.updateData(),a.update(),a.pointData.length==s&&a.lineData.length==l||a.setUndo(i)})}else{var c=O(v(Object(m.a)(Object(m.a)(a)))),u=!1,d=!1;n.selected||(d=!0),a.pointData.forEach(function(t){delete t.lastSelect}),n.lastSelect=!0,a.selectPoint(n),a.pointData.forEach(function(t){t.selected&&(t.ox=a.xScale(t.x),t.oy=a.yScale(t.y))});g.b.on("drag",function(t){var e=t.org;u=!0,!g.b.sourceEvent.shiftKey&&d&&(a.pointData.forEach(function(t){a.deselectPoint(t)}),a.lineData.forEach(function(t){delete t.selected}),a.selectPoint(e)),a.pointData.forEach(function(t){t.selected&&(t.ox+=g.b.dx,t.oy+=g.b.dy,t.x=C(a.xScale.invert(t.ox)))}),a.update()}).on("end",function(t,e){var n=t.org;u?a.setUndo(c):!g.b.sourceEvent.shiftKey&&d&&(a.pointData.forEach(function(t){a.deselectPoint(t)}),a.lineData.forEach(function(t){delete t.selected}),a.selectPoint(n),n.lastSelect=!0),a.pointData.forEach(function(t){delete t.ox,delete t.oy}),a.onChange(),a.update()})}}}),a.dragMarky=g.a().on("start",function(t,e){if(a.cursorData.visible=!1,a.drawCursor(),a.altKey=g.b.sourceEvent.altKey,g.b.sourceEvent.altKey&&!a.props.readOnly){var n=O(v(Object(m.a)(Object(m.a)(a)))),r=null;a.pointData.some(function(t,e){return!(!t.selected||!t.lastSelect)&&(r=t,e,!0)}),a.pointData.forEach(function(t){delete t.lastSelect});var o={x:a.cursorData.x,y:a.cursorData.y,selected:!0,lastSelect:!0};a.selectPoint(o),a.pointData.push(o),r&&a.makeLine(r,o),a.onChange(),a.updateData(),a.update(),a.cursorData.visible=!1,a.drawCursor(),a.setUndo(n)}if(g.b.sourceEvent.shiftKey){a.marky,g.e(a.bar);var i=!1,s=g.b.x,l=g.b.y;a.markyData.x=s,a.markyData.y=l,a.markyData.width=0,a.markyData.height=0;g.b.on("drag",function(t){i||(s=g.b.x,l=g.b.y,a.markyData.x=s,a.markyData.y=l,a.markyData.width=0,a.markyData.height=0,i=!0),s+=g.b.dx,l+=g.b.dy,a.markyData.width=s-a.markyData.x,a.markyData.height=l-a.markyData.y,a.markyData.visible=!0,a.updateMarky()}).on("end",function(){a.markyData.visible=!1,a.updateMarky();var t,e=a.markyData.x,n=a.markyData.y,r=a.markyData.x+a.markyData.width,o=a.markyData.y+a.markyData.height;t=e,r<e&&(e=r,r=t),t=n,o<n&&(n=o,o=t);var i=function(t){return[a.xScale.invert(t[0]),a.yScale.invert(t[1])]},s=i([e,n]),l=i([r,o]);a.pointLoopData.forEach(function(t){if(g.b.sourceEvent.shiftKey&&t.org.selected)return!0;s[0]<=t.x&&t.x<=l[0]&&s[1]<=t.y&&t.y<=l[1]?a.selectPoint(t.org):a.deselectPoint(t.org)});var c=0,u=null;a.pointData.forEach(function(t){t.selected&&(c++,u=t)}),1===c&&(u.lastSelect=!0),a.update()})}});var r=0,o=null;if(a.gridZoomBehavior=g.f().scaleExtent([.8,160]).filter(function(){return a.altKey=g.b.altKey,!g.b.shiftKey&&!g.b.altKey}).on("start",function(){r=0,o=g.b.transform.k}).on("zoom",function(){r++,o!==g.b.transform.k&&(r+=10);var t=g.b.transform;a.props.onChangeParam&&(a.params.gridZoom=t,a.props.onChangeParam(a.params)),a.xScale.range([t.applyX(0),t.applyX(a.state.width)]),a.clearGrid(a.grid),a.updateData(),a.update(),a.cursorData.visible=!1,a.drawCursor()}).on("end",function(){r<5&&(a.pointData.forEach(function(t){a.deselectPoint(t)}),a.lineData.forEach(function(t){delete t.selected,delete t.lastSelect}),a.update())}),a.base.call(a.gridZoomBehavior).on("dblclick.zoom",null).call(a.dragMarky).on("mouseleave",function(){a.cursorData.visible=!1,a.drawCursor()}).on("mousemove",function(){var t=g.c(a.svgElement);a.cursorData.x=C(a.xScale.invert(t[0])),a.cursorData.y=parseInt(a.yScale.invert(t[1])+.5),a.cursorData.visible=!0,a.drawCursor()}),a.menuZoomBehavior=g.f().scaleExtent([.8,5]).filter(function(){return a.altKey=g.b.altKey,!g.b.shiftKey&&!g.b.altKey}).on("start",function(){r=0,o=g.b.transform.k}).on("zoom",function(){r++,o!==g.b.transform.k&&(r+=10);var t=g.b.transform;a.props.onChangeParam&&(a.params.menuZoom=t,a.props.onChangeParam(a.params)),a.yScale.range([t.applyY(0),t.applyY(a.state.height)]),a.clearGrid(a.grid),a.clearGrid(a.menu),a.update(),a.cursorData.visible=!1,a.drawCursor()}).on("end",function(){r<5&&a.update()}),a.menu.call(a.menuZoomBehavior).on("dblclick.zoom",null),a.updateData(),a.marky.selectAll("rect").data([a.markyData]).enter().append("rect").attr("class","marky").attr("visibility","hidden").attr("stroke","none").attr("stroke-width",2),a.params.gridZoom){var i=a.params.gridZoom;a.base.call(a.gridZoomBehavior.transform,g.g.translate(i.x,0).scale(i.k))}else a.resetScreenPosition();if(a.params.menuZoom){var s=a.params.menuZoom;a.menu.call(a.menuZoomBehavior.transform,g.g.translate(0,s.y).scale(s.k))}a.update()},a.updateData=function(){var t=a.size(),e=t.width,n=(t.height,h=[0,0],[a.xScale.invert(h[0]),a.yScale.invert(h[1])]),r=a.xScale.invert(e)-a.xScale.invert(0),o=k,i=0;a.pointData.forEach(function(t,e){t.i=e,delete t.mark,t.time||(t.time=b(t)),o>t.x&&(o=t.x),i<t.x&&(i=t.x)}),o=o<0?parseInt(o/k)-1:parseInt(o/k),i=i<0?parseInt(i/k)-1:parseInt(i/k);var l=function(t){return t<0&&(t=(parseInt(t/k)-1)*k),parseInt(t/k)*k},c=l(n[0])-i*k,u=(parseInt(r/k)+2)*k-o*k+i*k,d=n[0],p=d+r;w(d),w(p),l(d),l(p);a.pointLoopData=[],a.lineLoopData=[];var h,f={},m=function(t,e){return t+e>=d&&t+e<=p},g=function(t,e,n){var r=null;return"undefined"===typeof f[t]&&(f[t]={}),(r=f[t][e.i])?r:((r=Object(s.a)({},e)).dx=n,r.x=e.x+r.dx,r.org=e,delete r.time,f[t][e.i]=r,a.pointLoopData.push(r),r)};a.lineData.forEach(function(t,e){for(e=c;e<c+u;e+=k)if(m(t.s.x,e)||m(t.d.x,e)){t.s.mark=!0,t.d.mark=!0;var n=g(e,t.s,e),r=g(e,t.d,e),o=Object(s.a)({},t);o.org=t,o.i=e,o.s=n,o.d=r,a.lineLoopData.push(o)}}),a.pointData.forEach(function(t){if(!t.mark)for(var e=c;e<c+u;e+=k)m(t.x,e)&&g(e,t,e);delete t.mark})},a.update=function(){Object(m.a)(Object(m.a)(a));var t=a.size();t.width,t.height;a.textData=[],a.pointLoopData.forEach(function(t,e){t.x=t.org.x+t.dx,t.org.selected&&(t.time||(t.time=b(t)),a.textData.push(t.time))}),a.line.selectAll("line.link").data(a.lineLoopData).exit().remove(),a.line.selectAll("line.link").data(a.lineLoopData).enter().append("line").classed("link",!0).attr("fill","none").style("pointer-events","none").attr("stroke-width",1),a.line.selectAll("line.selection").data(a.lineLoopData).exit().remove(),a.line.selectAll("line.selection").data(a.lineLoopData).enter().append("line").classed("selection",!0).attr("fill","none").attr("stroke","rgb(0,0,0,0)").attr("stroke-width",6),a.rect.selectAll("rect.link").data(a.pointLoopData).exit().remove(),a.rect.selectAll("rect.link").data(a.pointLoopData).enter().append("rect").classed("link",!0).attr("fill","rgba(0,0,0,0)").call(a.dragHandle).on("dblclick",function(t,e){console.log("dbl ".concat(e))}).on("mouseover",function(t,e){t.org.selected||(t.time||(t.time=b(t)),t.time&&a.textData.indexOf(t.time)<0&&a.textData.push(t.time),a.updateText())}).on("mouseout",function(t,e){t.org.selected||(t.time&&a.textData.splice(a.textData.indexOf(t.time),1),a.updateText())}),a.line.selectAll("line.link").attr("x1",function(t){return a.xScale(t.s.x)}).attr("y1",function(t){return a.yScale(t.s.y)}).attr("x2",function(t){return a.xScale(t.d.x)}).attr("y2",function(t){return a.yScale(t.d.y)}).attr("stroke",function(t){return t.org.selected?"#F00":"#999"}),a.line.selectAll("line.selection").attr("x1",function(t){return a.xScale(t.s.x)}).attr("y1",function(t){return a.yScale(t.s.y)}).attr("x2",function(t){return a.xScale(t.d.x)}).attr("y2",function(t){return a.yScale(t.d.y)}).on("click",function(t,e){var n=t.org;if(g.b.shiftKey){if(n.selected){a.lineData.forEach(function(t){t.s.lines||(t.s.lines=[]),t.d.lines||(t.d.lines=[]),t.s.lines.push(t),t.d.lines.push(t)});delete n.selected,function t(e){e.selected||(e.selected=!0,a.selectPoint(e.s),a.selectPoint(e.d),e.s.lines.forEach(function(e){t(e)}),e.d.lines.forEach(function(e){t(e)}))}(n),a.pointData.forEach(function(t){delete t.lines})}}else a.pointData.forEach(function(t){a.deselectPoint(t)}),a.lineData.forEach(function(t){delete t.selected});n.selected=!0,a.update()}),a.rect.selectAll("rect.link").attr("x",function(t){return a.xScale(t.x)-4}).attr("y",function(t){return a.yScale(t.y)-4}).attr("width",8).attr("height",8).attr("fill",function(t){return t.org.lastSelect?"#FF0000":"#00000000"}).attr("stroke",function(t){return t.org.selected?t.org.lastSelect?"#FF0000":"#FFA000":"#999"}).attr("stroke-width",1),a.updateGrid(a.grid,a.gridRectangles()),a.updateGrid(a.menu,a.menuRectangles()),a.updateText()},a.updateText=function(){a.text.selectAll("text").data(a.textData).exit().remove(),a.text.selectAll("text").data(a.textData).enter().append("text").style("pointer-events","none"),a.text.selectAll("text").each(function(t,e){t.update&&t.update()}).attr("fill",function(t){return t.color?t.color:"black"}).attr("font-size",function(t){return 18*t.fontSize}).attr("x",function(t){return a.xScale(t.x)+t.dx}).attr("y",function(t){return a.yScale(t.y)+t.dy}).attr("transform",function(t){return t.rotate?"rotate(".concat(t.rotate,",").concat(a.xScale(t.x),",").concat(a.yScale(t.y),")"):""}).text(function(t){return t.text})},a.updateMarky=function(){a.marky.selectAll("rect").attr("visibility",function(t){return t.visible?"visible":"hidden"}).attr("fill",function(t){return t.color?t.color:"none"}).attr("x",function(t){return t.width>=0?t.x:t.x+t.width}).attr("y",function(t){return t.height>=0?t.y:t.y+t.height}).attr("width",function(t){return t.width>=0?t.width:-t.width}).attr("height",function(t){return t.height>=0?t.height:-t.height})},a.gridRectangles=function(){var t,e=a.size(),n=e.width,r=e.height,o=(t=[0,0],[a.xScale.invert(t[0]),a.yScale.invert(t[1])]),i=a.xScale.invert(n)-a.xScale.invert(0),s=a.yScale.invert(r)-a.yScale.invert(0),l=a.xScale(3600)-a.xScale(0),c=[],u=[],d=[];c.push({color:"#00000000",x:o[0],y:o[1],width:i,height:s});!function(t){for(var e=0;e<i+4*t;e+=t){var n=e+o[0]-o[0]%(2*t)-2*t,r=o[1],c=parseInt(n+(n>0?.5:-.5)),p=null,h=null,f=1,m=.85,g="#808080",b=c;c<0&&(c=-(k+c)),c%k==0?(f=4,p=0===b||b===k?"#A0A0FF":"#E0E0E0",h=y(n),m=1,g="#404040",(n<0||n>=86400)&&(g="#A0A0A0")):c%3600==0?(f=2,p="#A0FFFF",h=y(n),m=1,g="#404040",(n<0||n>=86400)&&(g="#A0A0A0")):c%1800==0?(p="#A0FFFF",l/(a.gridScale.x+5)>=2&&(h=y(n))):c%900==0&&l/(a.gridScale.x+5)>=2?(p="#E0FFFF",l/(a.gridScale.x+5)>=4&&(h=y(n))):c%300==0&&l/(a.gridScale.x+5)>=4?(p="#E0FFFF",l/(a.gridScale.x+5)>=12&&(h=y(n))):c%60==0&&l/(a.gridScale.x+5)>=12&&(p="#E0FFFF",l/(a.gridScale.x+5)>=60&&(h=y(n).slice(-2))),p&&(u.push({x1:a.xScale(n),y1:a.yScale(r),x2:a.xScale(n),y2:a.yScale(r+s),color:p,width:f}),h&&d.push({x:n,y:r,dx:4,dy:-3,rotate:90,name:h,color:g,fontSize:m}))}}(60);for(var p=0;p<s+4;p+=1){var h=o[0],f=parseInt(p+o[1]-o[1]%2-2+.5);if(f>=1&&f<=a.busStops.length){var m=a.busStops[f-1],g={x1:a.xScale(h),y1:a.yScale(f),x2:a.xScale(h+i),y2:a.yScale(f),color:"#80FFFF",width:1};m.selected&&(g.color="red"),u.push(g)}}return{rectData:c,lineData:u,textData:d}},a.menuRectangles=function(){var t,e=a.size(),n=e.width,r=e.height,o=(t=[0,0],[a.xScale.invert(t[0]),a.yScale.invert(t[1])]),i=(a.xScale.invert(n),a.xScale.invert(0),a.yScale.invert(r)-a.yScale.invert(0)),s=a.xScale.invert(E)-a.xScale.invert(0),l=[],c=[],u=[];l.push({color:"#F8F8F8D0",x:o[0],y:o[1],width:s,height:i}),c.push({color:"#D0D0D0",x1:E,y1:0,x2:E,y2:r,width:1});for(var d=0;d<i+4;d+=1){var p=o[0],h=parseInt(d+o[1]-o[1]%2-2+.5);if(h>=1&&h<=a.busStops.length){var f=a.busStops[h-1],m={x1:a.xScale(p),y1:a.yScale(h),x2:a.xScale(p+s),y2:a.yScale(h),color:"#80FFFF",width:1};f.selected&&(m.color="red"),c.push(m);var g={x:p,y:h,dx:4,dy:-4,name:f.name,color:"#404040",index:h,fontSize:1};f.selected&&(g.color="red"),u.push(g)}}return{rectData:l,lineData:c,textData:u}},a.clearGrid=function(t){t.selectAll("line.stops").remove(),t.selectAll("text.stops").remove(),t.selectAll("rect.stops").remove()},a.updateGrid=function(t,e){var n=e.rectData,r=e.lineData,o=e.textData;t.selectAll("rect.stops").data(n).exit().remove(),t.selectAll("rect.stops").data(n).enter().append("rect").classed("stops",!0).attr("stroke","none").attr("stroke-width",2).attr("fill",function(t){return t.color?t.color:"none"}).attr("x",function(t){return a.xScale(t.x)}).attr("y",function(t){return a.yScale(t.y)}).attr("width",function(t){return a.xScale(t.width)-a.xScale(0)}).attr("height",function(t){return a.yScale(t.height)-a.yScale(0)}),t.selectAll("line.stops").data(r).exit().remove(),t.selectAll("line.stops").data(r).enter().append("line").classed("stops",!0).attr("fill","rgba(0,0,0,0)").attr("stroke",function(t){return t.color?t.color:"none"}).attr("stroke-width",function(t){return t.width}).attr("stroke-dasharray",function(t){return t.stroke?t.stroke:"none"}).attr("x1",function(t){return t.x1}).attr("y1",function(t){return t.y1}).attr("x2",function(t){return t.x2}).attr("y2",function(t){return t.y2}).on("click",function(t,e){}).on("mouseover",function(t,e){}),t.selectAll("text.stops").data(o).exit().remove(),t.selectAll("text.stops").data(o).enter().append("text").classed("stops",!0).attr("fill",function(t){return t.color?t.color:"black"}).attr("font-size",function(t){return 13*t.fontSize}).attr("x",function(t){return a.xScale(t.x)+t.dx}).attr("y",function(t){return a.yScale(t.y)+t.dy}).attr("text-anchor","start").attr("transform",function(t){return t.rotate?"rotate(".concat(t.rotate,",").concat(a.xScale(t.x),",").concat(a.yScale(t.y),")"):""}).text(function(t){return""==t.name?"\u540d\u79f0\u672a\u8a2d\u5b9a":t.name}).on("dblclick",function(t,e){}).on("click",function(t,e){if("undefined"!==typeof t.index){var n=a.busStops[t.index-1];if(n.selected){var r=a.busStops[t.index-1];a.props.onEditBusStop&&a.props.onEditBusStop({name:r.name,data:a.busStopData(t.index),index:t.index})}else a.busStops.forEach(function(t){delete t.selected}),n.selected=!0,a.clearGrid(a.grid),a.clearGrid(a.menu),a.updateGrid(a.grid,a.gridRectangles()),a.updateGrid(a.menu,a.menuRectangles())}}).on("mouseover",function(t,e){t.index})},a.drawCursor=function(){a.props.readOnly||(a.cursor.selectAll("rect").remove(),a.cursor.append("rect").attr("fill","none").attr("x",a.xScale(a.cursorData.x)-4).attr("y",a.yScale(a.cursorData.y)-4).attr("visibility",a.cursorData.visible&&a.altKey?"visible":"hidden").attr("width",8).attr("height",8).attr("stroke-width",1).attr("stroke","#999").on("click",function(t,e){}))},a.onKeyDown=function(t){if(a.altKey=t.altKey,(8===t.keyCode||46===t.keyCode)&&(t.preventDefault(),!a.props.readOnly)){var e=!1,n=O(v(Object(m.a)(Object(m.a)(a))));a.lineData.forEach(function(t){(t.s.selected||t.d.selected)&&(t.selected=!0)});var r=[];a.pointData.forEach(function(t){t.selected?(e=!0,t.time&&a.textData.splice(a.textData.indexOf(t.time),1)):r.push(t)});var o=[];a.lineData.forEach(function(t){t.selected||o.push(t)}),e&&a.setUndo(n),a.pointData=r,a.lineData=o,a.onChange(),a.updateData(),a.update()}if(13===t.keyCode&&(t.preventDefault(),!a.props.readOnly)){var i=O(v(Object(m.a)(Object(m.a)(a)))),s=0;if(a.busStops.some(function(t,e){return!!t.selected&&(s=e+1,!0)}),s>=1&&s<=a.busStops.length){if(t.shiftKey){if(a.busStops.length<=2||s<2)return;S(Object(m.a)(Object(m.a)(a)),s-2),a.setUndo(i)}else D(Object(m.a)(Object(m.a)(a)),s-1),a.setUndo(i);a.onChange(),a.updateData(),a.clearGrid(a.grid),a.clearGrid(a.menu),a.update()}}37===t.keyCode&&t.preventDefault(),39===t.keyCode&&t.preventDefault(),t.metaKey&&90===t.keyCode&&(t.preventDefault(),a.props.readOnly||(t.shiftKey?a.doRedo():a.doUndo()))},a.onKeyUp=function(t){a.props.readOnly||(a.altKey=t.altKey)},a.onMouseLeave=function(t){t.shiftKey&&(a.marky.width=0,a.marky.height=0)},a.onChange=function(){var t=v(Object(m.a)(Object(m.a)(a)));a.props.onChangeData&&a.props.onChangeData(t)},a.setUndo=function(t){a.undoBuffer=a.undoBuffer.slice(0,a.undoPtr),a.undoBuffer.push(t),a.undoPtr++},a.doUndo=function(){if(a.undoPtr>0){a.undoPtr--;var t=a.undoBuffer[a.undoPtr];a.loadData(t),a.props.onChangeData&&a.props.onChangeData(t)}},a.doRedo=function(){if(a.undoBuffer.length>a.undoPtr){var t=a.undoBuffer[a.undoPtr];a.loadData(t),a.props.onChangeData&&a.props.onChangeData(t),a.undoPtr++}},a.resetScreenPosition=function(){var t=a.size(),e=t.width;t.height;a.xScale.domain([0,e*a.timeLineWidth()]).range([0,e]);var n=(e-E)/(24*a.gridScale.x);a.base.call(a.gridZoomBehavior.transform,g.g.translate(a.gridScale.x*(E/a.gridScale.x),0).scale(n)),a.menu.call(a.menuZoomBehavior.transform,g.g.translate(0,0).scale(1))},a.changeBusStop=function(t){if(!a.props.readOnly){var e=t.index-1;if(e>=0&&e<a.busStops.length){var n=t.name.trim().replace(/\s/g,"");if(a.busStops[e].name!==n){var r=O(v(Object(m.a)(Object(m.a)(a))));a.busStops[e].name=n,a.onChange(),a.setUndo(r)}}}};var n=t.diagramData,r=x(P(n)),o=r.busStops,i=r.lineData,c=r.pointData;return a.state={width:t.width,height:t.height},a.markyData={x:100,y:200,width:200,height:100,color:"rgba(0,0,0,0.1)",visible:!1},a.lineData=i,a.pointData=c,a.busStops=o,a.lineLoopData=[],a.pointLoopData=[],a.textData=[],a.cursorData={x:0,y:0,visible:!0},a.gridScale={x:25,y:25,dy:-4},a.params=Object(s.a)({},t.params),a.undoPtr=0,a.undoBuffer=[],a.altKey=!1,a}return Object(p.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){}},{key:"componentDidUpdate",value:function(){var t=this.size(),e=t.width,a=t.height,n=g.h(this.base.node()),r=g.h(this.menu.node());this.xScale.domain([0,e*this.timeLineWidth()]).range([n.applyX(0),n.applyX(e)]),this.yScale.domain([this.gridScale.dy,a*this.busLineHeight()+this.gridScale.dy]).range([r.applyY(0),r.applyY(a)]),this.updateData(),this.clearGrid(this.grid),this.clearGrid(this.menu),this.update()}},{key:"componentWillReceiveProps",value:function(t){var e={};this.props.width!=t.width&&(e.width=t.width),this.props.height!=t.height&&(e.height=t.height),this.props.diagramData!=t.diagramData&&this.loadData(t.diagramData),this.setState(e)}},{key:"busStopData",value:function(t){var e=this,a=[],n=this.busStops[t-1].name;this.pointData.forEach(function(t,e){t.idx=e,delete t.mark,delete t.lines}),this.lineData.forEach(function(t){"undefined"===typeof t.s.lines&&(t.s.lines=[]),"undefined"===typeof t.d.lines&&(t.d.lines=[]),t.s.lines.push(t),t.d.lines.push(t)}),this.pointData.forEach(function(e){e.y===t&&a.push(e)});var r=a.map(function(t){var a=[],n=[];if(function t(e,a,n,r){e.mark||(n.y===e.y&&r.push(e),a.push(e),e.mark=!0,e.lines.forEach(function(e){t(e.s,a,n,r),t(e.d,a,n,r)}))}(t,a,t,n),a.length>1){a.sort(function(t,e){return t.y>e.y?1:t.y<e.y?-1:0});var r=a[0],o=a[a.length-1];n.sort(function(t,e){return t.x>e.x?1:t.x<e.x?-1:0});var i=Object(s.a)({},n[n.length-1]);r.x<o.x?(i.dir="down",i.departure=e.busStops[r.y-1],i.arrival=e.busStops[o.y-1]):(i.dir="up",i.departure=e.busStops[o.y-1],i.arrival=e.busStops[r.y-1]),i.x=w(i.x);var l=parseInt(i.x+.5);return i.sec=parseInt(l%60),i.min=parseInt(l/60)%60,i.hour=parseInt(parseInt(l/60)/60),i}return null}).filter(function(t){return null!==t}).sort(function(t,e){return t.x>e.x?1:t.x<e.x?-1:0});return this.pointData.forEach(function(t){delete t.idx,delete t.mark,delete t.lines}),{name:n,times:r}}},{key:"render",value:function(){var t=this;return f.a.createElement("div",{ref:function(e){return t.container=e},style:{display:"inline-block",marign:0,padding:0,width:this.state.width,overflow:"hidden",border:"solid 1px lightgray"},tabIndex:this.props.tabIndex,focusable:!0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onMouseLeave:this.onMouseLeave},f.a.createElement("svg",{ref:function(e){t.svgElement=e,t.svg=g.e(e)},width:"100%",height:this.state.height,style:{marign:0}},f.a.createElement("g",{ref:function(e){return t.base=g.e(e)}},f.a.createElement("g",{ref:function(e){return t.axis=g.e(e)},style:{visibility:"hidden"}}),f.a.createElement("g",{ref:function(e){return t.grid=g.e(e)}}),f.a.createElement("g",{ref:function(e){return t.line=g.e(e)}}),f.a.createElement("g",{ref:function(e){return t.rect=g.e(e)}}),f.a.createElement("g",{ref:function(e){return t.cursor=g.e(e)}}),f.a.createElement("g",{ref:function(e){return t.text=g.e(e)}}),f.a.createElement("g",{ref:function(e){return t.marky=g.e(e)}})),f.a.createElement("g",{ref:function(e){return t.menu=g.e(e)}})))}},{key:"diagramData",get:function(){var t=v(this);return O(t)}}]),e}(h.Component);j.defaultProps={params:{},readOnly:!1,tabIndex:0};var I=a(139),K=a(136),B=a(137),F=a(108),L=function(t){function e(t){var a;return Object(l.a)(this,e),(a=Object(u.a)(this,Object(d.a)(e).call(this,t))).onClose=function(){a.props.onClose&&a.props.onClose()},a.onEdited=function(){a.props.onEdited&&a.props.onEdited({name:a.state.name})},a.state=Object(s.a)({},t.busStop),a}return Object(p.a)(e,t),Object(c.a)(e,[{key:"componentWillReceiveProps",value:function(t){this.props.busStop!==t.busStop&&this.setState(Object(s.a)({},t.busStop))}},{key:"render",value:function(){for(var t=this,e=[],a=0;a<24;a++)e.push([]);return this.state.data.times&&this.state.data.times.forEach(function(t){e[t.hour].push(t)}),f.a.createElement(I.a,{show:this.props.show,size:"lg",onHide:this.onClose},f.a.createElement(I.a.Header,{closeButton:!0},f.a.createElement(I.a.Title,null,"\u6a19\u67f1\u30c7\u30fc\u30bf")),f.a.createElement(I.a.Body,null,f.a.createElement(K.a,null,f.a.createElement(B.a,{md:12},f.a.createElement("input",{type:"text",style:{width:"100%",marginBottom:10},value:this.state.name,onChange:function(e){t.setState({name:e.target.value})},placeholder:"\u6a19\u67f1\u540d",readOnly:this.props.readOnly?"readonly":null}))),f.a.createElement(K.a,null,f.a.createElement(B.a,{md:12},f.a.createElement("table",{style:{width:"100%",fontSize:12}},f.a.createElement("thead",null,f.a.createElement("tr",{key:a,style:{border:"solid 1px lightgray"}},f.a.createElement("th",{width:50},f.a.createElement("span",{style:{margin:10}})),f.a.createElement("th",{style:{borderLeft:"solid 1px lightgray",width:"50%",textAlign:"center"}},f.a.createElement("span",null,"\u4e0a\u308a")),f.a.createElement("th",{style:{borderLeft:"solid 1px lightgray",width:"50%",textAlign:"center"}},f.a.createElement("span",null,"\u4e0b\u308a")))),f.a.createElement("tbody",null,e.map(function(t,e){return f.a.createElement("tr",{key:e,style:{border:"solid 1px lightgray"}},f.a.createElement("td",{width:50},f.a.createElement("span",{style:{margin:10}},("00"+e).slice(-2))),f.a.createElement("td",{style:{borderLeft:"solid 1px lightgray",width:"50%"}},f.a.createElement("span",null,t.filter(function(t){return"up"===t.dir}).map(function(t){return"".concat(t.min)}).join(", "))),f.a.createElement("td",{style:{borderLeft:"solid 1px lightgray",width:"50%"}},f.a.createElement("span",null,t.filter(function(t){return"down"===t.dir}).map(function(t){return"".concat(t.min)}).join(", "))))})))))),f.a.createElement(I.a.Footer,null,f.a.createElement(F.a,{onClick:this.onEdited},"OK")))}}]),e}(h.Component);L.defaultProps={show:!1,busStop:{name:"",data:{}},readOnly:!1};var T=a(109),A=a.n(T),R=(a(116),a(117),function(t){function e(t){var a;return Object(l.a)(this,e),(a=Object(u.a)(this,Object(d.a)(e).call(this,t))).onClose=function(){a.props.onClose&&a.props.onClose()},a.onEdited=function(){a.props.onEdited&&a.props.onEdited(a.state.text)},a.onChangeText=function(t){a.setState({text:t})},a.state={text:t.text},a}return Object(p.a)(e,t),Object(c.a)(e,[{key:"componentWillReceiveProps",value:function(t){this.props.text!==t.text&&this.setState({text:null===t.text?"":t.text})}},{key:"render",value:function(){var t=this;return f.a.createElement(I.a,{show:this.props.show,size:"lg",onHide:this.onClose},f.a.createElement(I.a.Header,{closeButton:!0},f.a.createElement(I.a.Title,null,"\u30c0\u30a4\u30a2\u30b0\u30e9\u30e0\u30c7\u30fc\u30bf")),f.a.createElement(I.a.Body,null,f.a.createElement(K.a,null,f.a.createElement(B.a,{md:12},f.a.createElement(A.a,{ref:function(e){return t.editor=e},style:{display:"inline-block",border:"solid 1px lightgray"},mode:"text",theme:"chrome",value:this.state.text,width:"100%",height:"".concat(this.props.height,"px"),onChange:this.onChangeText,showPrintMargin:!1,fontSize:12,name:"digram_data_dialog",editorProps:{$blockScrolling:1/0},readOnly:this.props.readonly})))),f.a.createElement(I.a.Footer,null,f.a.createElement(F.a,{onClick:this.onEdited},"OK")))}}]),e}(h.Component));R.defaultProps={show:!1,name:"",height:100};var z=a(142),H=function(t){function e(t){var a;return Object(l.a)(this,e),(a=Object(u.a)(this,Object(d.a)(e).call(this,t))).onClose=function(){a.props.onClose&&a.props.onClose()},a.onEdited=function(){a.props.onEdited&&a.props.onEdited(Object(s.a)({},a.state))},a.onSelectHandler=function(t){return function(){a.setState({operator:t})}},a.state={consumerKey:t.consumerKey,operator:t.operator},a}return Object(p.a)(e,t),Object(c.a)(e,[{key:"componentWillReceiveProps",value:function(t){this.props.consumerKey!==t.consumerKey&&this.setState({consumerKey:t.consumerKey}),this.props.operator!==t.operator&&this.setState({operator:t.operator})}},{key:"render",value:function(){var t=this;return f.a.createElement(I.a,{show:this.props.show,size:"lg",onHide:this.onClose},f.a.createElement(I.a.Header,{closeButton:!0},f.a.createElement(I.a.Title,null,"\u30aa\u30fc\u30d7\u30f3\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f")),f.a.createElement(I.a.Body,null,f.a.createElement(K.a,null,f.a.createElement(B.a,{md:12},f.a.createElement("div",null,f.a.createElement("p",null,f.a.createElement("a",{href:"https://tokyochallenge.odpt.org/",target:"open-data-challenge"},"\u6771\u4eac\u516c\u5171\u4ea4\u901a\u30aa\u30fc\u30d7\u30f3\u30c7\u30fc\u30bf\u30c1\u30e3\u30ec\u30f3\u30b8"),"\u306e\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f\u304c\u3067\u304d\u307e\u3059\u3002",f.a.createElement("br",null),"\u30b3\u30f3\u30b7\u30e5\u30fc\u30de\u30ad\u30fc\u3092\u5165\u529b\u3057\u3066\u3001\u30d0\u30b9\u4e8b\u696d\u8005\u3092\u9078\u629e\u5f8c\u3001OK\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002"))),f.a.createElement(B.a,{md:12},f.a.createElement("input",{type:"text",style:{width:"100%",marginBottom:10},value:this.state.consumerKey,onChange:function(e){t.setState({consumerKey:e.target.value})},placeholder:"\u30b3\u30f3\u30b7\u30e5\u30fc\u30de\u30ad\u30fc\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"})),f.a.createElement(B.a,{md:12},f.a.createElement("div",{style:{marginBottom:20}},f.a.createElement(z.a,null,f.a.createElement(z.a.Toggle,{size:"sm",variant:"outline-secondary",id:"dropdown-basic"},this.state.operator.title?this.state.operator.title:"\u30d0\u30b9\u4e8b\u696d\u8005\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"),f.a.createElement(z.a.Menu,null,this.props.operators.map(function(e,a){return f.a.createElement(z.a.Item,{key:a,onSelect:t.onSelectHandler(e),active:t.state.operator.title===e.title},e.title)}))))),f.a.createElement(B.a,{md:12},f.a.createElement("div",{style:{color:"red"}},f.a.createElement("p",null,"\u672c\u30a2\u30d7\u30ea\u3067\u306f\u3001\u500b\u4eba\u60c5\u5831\u3084\u7de8\u96c6\u3057\u305f\u30c7\u30fc\u30bf\u306e\u53ce\u96c6\u306f\u884c\u3063\u3066\u304a\u308a\u307e\u305b\u3093\u3002",f.a.createElement("br",null),"\u30c7\u30fc\u30bf\u306f\u30d6\u30e9\u30a6\u30b6\u306e\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002"))))),f.a.createElement(I.a.Footer,null,f.a.createElement(F.a,{onClick:this.onEdited},"OK")))}}]),e}(h.Component);H.defaultProps={consumerKey:"",operator:{},operators:[]};var N=a(140);a(132);a.d(e,"default",function(){return Y});var U="https://api-tokyochallenge.odpt.org/api/v4",W="BusTimetable",G="BusstopPole",Z="BusroutePattern",M=[{title:"\u5e73\u65e5:Weekday",key:"odpt.Calendar:Weekday"},{title:"\u571f\u66dc:Saturday",key:"odpt.Calendar:Saturday"},{title:"\u4f11\u65e5:Holiday",key:"odpt.Calendar:Holiday"}],J={getItem:function(t,e){var a=localStorage.getItem("".concat("diagram","-").concat(t));return null!==a?JSON.parse(a).data:e},setItem:function(t,e){localStorage.setItem("".concat("diagram","-").concat(t),JSON.stringify({data:e}))}};function V(t){var e=t.match(/^odpt\.BusstopPole:(.+)/);return e?e[1]:t}function X(t){var e=t.match(/^odpt\.Calendar:(.+)/);return e?e[1]:t}var Y=function(t){function e(t){var a;return Object(l.a)(this,e),(a=Object(u.a)(this,Object(d.a)(e).call(this,t))).onResize=function(){a.setState({width:window.innerWidth,height:window.innerHeight},a.update)},a.onEditBusStop=function(t){a.setState({showBusStopDialog:!0,busStop:t})},a.onCloseBusStop=function(){a.setState({showBusStopDialog:!1})},a.onEditedBusStop=function(t){a.diagramView.changeBusStop(Object(s.a)({},a.state.busStop,{name:t.name})),a.setState({showBusStopDialog:!1})},a.openDiagramDataDialog=function(){a.setState({showDiagramDataDialog:!0,diagramEditData:a.diagramView.diagramData})},a.onEditedDiagramData=function(t){a.setState({showDiagramDataDialog:!1,diagramData:t},function(){J.setItem("diagramData",t)})},a.onCloseDiagramData=function(){a.setState({showDiagramDataDialog:!1})},a.onChangeData=function(t){J.setItem("diagramData",a.diagramView.diagramData)},a.onChangeParam=function(t){J.setItem("params",t)},a.resetScreenPosition=function(){a.diagramView.resetScreenPosition()},a.openConfigDialog=function(){a.setState({showConfigDialog:!0})},a.onCloseConfigDialog=function(){a.setState({showConfigDialog:!1})},a.onEditedConfigDialog=function(t){var e=t.consumerKey,n=t.operator;J.setItem("consumerKey",e),J.setItem("operator",n);var r=Object(s.a)({},a.state.operator.key);a.state.operator.key&&delete r[a.state.operator.key],a.setState({busstopPole:[],busroutePattern:[],busTimetable:[],showConfigDialog:!1,consumerKey:e,operator:n,busRouteTable:r,diagramData:""},function(){J.setItem("busstopPole",a.state.busstopPole),J.setItem("busroutePattern",a.state.busroutePattern),J.setItem("busTimetable",a.state.busTimetable),J.setItem("diagramData",a.state.diagramData),J.setItem("selectedRoute",a.state.selectedRoute),a.loadOpenData()})},a.loadJSON=function(){var t=Object(i.a)(o.a.mark(function t(e){var n,r=arguments;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},t.abrupt("return",new Promise(function(t){var r=Object(s.a)({},n);r["odpt:operator"]="odpt.Operator:".concat(a.state.operator.key),r["acl:consumerKey"]=a.state.consumerKey;var o=Object.keys(r).map(function(t){return"".concat(t,"=").concat(r[t])}).join("&");fetch("".concat(U,"/odpt:").concat(e,"?").concat(o)).then(function(t){return t.json()}).then(function(e){t(e)}).catch(function(t){console.log("parsing failed",t)})}));case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),a.loadOpenData=Object(i.a)(o.a.mark(function t(){var e,n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(""!==a.state.consumerKey){t.next=2;break}return t.abrupt("return");case 2:if(""!==a.state.operator.key){t.next=4;break}return t.abrupt("return");case 4:if(!(a.state.busstopPole.length>0)){t.next=6;break}return t.abrupt("return");case 6:return a.setState({loading:"\u8aad\u307f\u8fbc\u307f\u4e2d..."}),t.next=9,a.loadJSON(G);case 9:return e=t.sent,t.next=12,a.loadJSON(Z);case 12:n=t.sent,{},{},{Weekday:"\u5e73\u65e5",Saturday:"\u571f\u66dc",Holiday:"\u4f11\u65e5"},n=n.map(function(t){return"undefined"===typeof t["odpt:note"]?t.title="".concat(t["dc:title"]):t.title="".concat(t["dc:title"],":").concat(t["odpt:note"]),t}).sort(function(t,e){return t.title>e.title?-1:t.title<e.title?1:0}),a.setState({busstopPole:e,busroutePattern:n,busTimetable:[],selectedRoute:0,loading:"",diagramData:""},Object(i.a)(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.loadTimetable();case 2:J.setItem("busstopPole",a.state.busstopPole),J.setItem("busroutePattern",a.state.busroutePattern),J.setItem("busTimetable",a.state.busTimetable),J.setItem("diagramData",a.state.diagramData),J.setItem("selectedRoute",a.state.selectedRoute);case 7:case"end":return t.stop()}},t,this)})));case 18:case"end":return t.stop()}},t,this)})),a.loadTimetable=Object(i.a)(o.a.mark(function t(){var e,r,i,s,l,c,u,d,p,h,f,m;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(p=function(t,e){return t.map(function(t){var a=[],n=-1;return t["odpt:busTimetableObject"].forEach(function(t,r){for(;n<e.length;){if(e[++n]["odpt:busstopPole"]===t["odpt:busstopPole"]){a.push(t);break}a.push({"odpt:busstopPole":e[n]["odpt:busstopPole"],"odpt:departureTime":"-"})}}),a})},e=a.state.busroutePattern[a.state.selectedRoute],!(a.state.busTimetable.length<=0)){t.next=12;break}return a.setState({loading:"\u8aad\u307f\u8fbc\u307f\u4e2d..."}),(i={})["odpt:busroutePattern"]=e["owl:sameAs"],t.next=8,a.loadJSON(W,i);case 8:r=t.sent,a.setState({loading:""}),t.next=13;break;case 12:r=Object(n.a)(a.state.busTimetable);case 13:s={},l=[].concat(M),r.forEach(function(t){var e=t["odpt:calendar"],a=X(e);M.some(function(t){return t.key===e})||s[t["odpt:calendar"]]||(s[t["odpt:calendar"]]=a,l.push({title:a,key:t["odpt:calendar"]}))}),c=l.length>a.state.selectedCalendar?a.state.selectedCalendar:0,u=r.filter(function(t){return t["odpt:calendar"]===l[c].key}),d=e["odpt:busstopPoleOrder"],u=p(u,d),"2"===e["odpt:direction"]?(d=Object(n.a)(d).reverse(),u=Object(n.a)(u.map(function(t){return Object(n.a)(t).reverse()}))):(d=Object(n.a)(d),u=Object(n.a)(u.map(function(t){return Object(n.a)(t)}))),a.setState({busTimetable:r},function(){J.setItem("busTimetable",a.state.busTimetable)}),h={},a.state.busstopPole.forEach(function(t){h[t["owl:sameAs"]]=t}),f=d.map(function(t){return function(t){var e=h[t];return e&&"undefined"!==typeof e["dc:title"]?"undefined"!==typeof e["odpt:busstopPoleNumber"]?"".concat(e["dc:title"],"(").concat(e["odpt:busstopPoleNumber"],")"):e["dc:title"]:V(t)}(t["odpt:busstopPole"])}).join(" "),m="".concat(u.map(function(t){return t.map(function(t){return t["odpt:departureTime"]?t["odpt:departureTime"]:t["odpt:arrivalTime"]?t["odpt:arrivalTime"]:"-"}).join(" ")}).join("\n")),a.setState({diagramData:"".concat(f,"\n").concat(m),calendarData:l},function(){J.setItem("diagramData",a.state.diagramData),J.setItem("calendarData",a.state.calendarData)});case 27:case"end":return t.stop()}},t,this)})),a.onSelectRoute=function(t){var e=t.target.value;a.setState({selectedRoute:e,busTimetable:[]},function(){a.loadTimetable(),J.setItem("selectedRoute",a.state.selectedRoute)})},a.onSelectCalendar=function(t){var e=t.target.value;a.setState({selectedCalendar:e},function(){a.loadTimetable(),J.setItem("selectedCalendar",a.state.selectedCalendar)})},a.state={showBusStopDialog:!1,showDiagramDataDialog:!1,showConfigDialog:!1,busStop:{name:"",data:{}},params:J.getItem("params",{}),width:window.innerWidth,height:window.innerHeight,diagramData:J.getItem("diagramData",""),diagramEditData:"",busstopPole:J.getItem("busstopPole",[]),busroutePattern:J.getItem("busroutePattern",[]),busTimetable:J.getItem("busTimetable",[]),busRouteTable:J.getItem("busRouteTable",[]),consumerKey:J.getItem("consumerKey",""),operator:J.getItem("operator",{title:"",key:""}),loading:"",selectedRoute:J.getItem("selectedRoute",0),selectedCalendar:J.getItem("selectedCalendar",0),calendarData:J.getItem("calendarData",M)},a}return Object(p.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onResize,!1),this.loadOpenData()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResize)}},{key:"render",value:function(){var t=this;return f.a.createElement("div",{style:{overflow:"hidden"}},f.a.createElement("nav",{className:"navbar sticky-top navbar-light bg-light"},f.a.createElement("a",{className:"navbar-brand",href:"#"},"\u30c0\u30a4\u30a2\u30b0\u30e9\u30e0\u30a8\u30c7\u30a3\u30bf"),this.state.loading?f.a.createElement(N.a,{className:"mr-auto"},f.a.createElement("span",{style:{color:"red"}}," ",this.state.loading," ")):null,this.state.busroutePattern&&this.state.busroutePattern.length>0&&!this.state.loading?f.a.createElement(N.a,{className:"mr-auto"},f.a.createElement("select",{defaultValue:this.state.selectedRoute,onChange:this.onSelectRoute},this.state.busroutePattern.map(function(t,e){return f.a.createElement("option",{key:e,value:e},t.title)})),f.a.createElement("select",{style:{marginLeft:10},defaultValue:this.state.selectedCalendar,onChange:this.onSelectCalendar},this.state.calendarData.map(function(t,e){return f.a.createElement("option",{key:e,value:e},t.title)}))):null,f.a.createElement("div",null,f.a.createElement("a",{href:"https://docs.google.com/presentation/d/1F0RfbHgcRPHgPSxpe61pBMZ8Yf0WGaXe7XT06Y3AWkk/edit?usp=sharing",target:"manual",className:"btn btn-sm btn-outline-secondary",style:{marginRight:10},role:"button"},"\u4f7f\u3044\u65b9"),f.a.createElement("button",{className:"btn btn-sm btn-outline-secondary",style:{marginRight:10},type:"button",onClick:this.openConfigDialog},"\u8aad\u307f\u8fbc\u307f"),f.a.createElement("button",{className:"btn btn-sm btn-outline-secondary",style:{marginRight:10},type:"button",onClick:this.resetScreenPosition},"\u521d\u671f\u4f4d\u7f6e"),f.a.createElement("button",{className:"btn btn-sm btn-outline-secondary",type:"button",onClick:this.openDiagramDataDialog},"\u30c7\u30fc\u30bf"))),f.a.createElement(j,{ref:function(e){return t.diagramView=e},onEditBusStop:this.onEditBusStop,onChangeData:this.onChangeData,onChangeParam:this.onChangeParam,diagramData:this.state.diagramData,params:this.state.params,width:this.state.width-2,height:this.state.height-26-38-10}),f.a.createElement(L,{busStop:this.state.busStop,show:this.state.showBusStopDialog,onClose:this.onCloseBusStop,onEdited:this.onEditedBusStop}),f.a.createElement(R,{show:this.state.showDiagramDataDialog,text:this.state.diagramEditData,onClose:this.onCloseDiagramData,onEdited:this.onEditedDiagramData,height:this.state.height-240}),f.a.createElement(H,{show:this.state.showConfigDialog,consumerKey:this.state.consumerKey,operator:this.state.operator,operators:[{title:"\u4eac\u738b\u30d0\u30b9",key:"KeioBus"},{title:"JR\u30d0\u30b9\u95a2\u6771",key:"JRBusKanto"},{title:"\u95a2\u6771\u30d0\u30b9",key:"KantoBus"},{title:"\u5c0f\u7530\u6025\u30d0\u30b9",key:"OdakyuBus"},{title:"\u897f\u6771\u4eac\u30d0\u30b9",key:"NishiTokyoBus"},{title:"\u897f\u6b66\u30d0\u30b9",key:"SeibuBus"},{title:"\u6771\u90e8\u30d0\u30b9",key:"TobuBus"},{title:"\u6771\u6025\u30d0\u30b9",key:"TokyuBus"}],onClose:this.onCloseConfigDialog,onEdited:this.onEditedConfigDialog}))}}]),e}(h.Component);Y.defaultProps={}}}]);
//# sourceMappingURL=1.32ae6bf8.chunk.js.map